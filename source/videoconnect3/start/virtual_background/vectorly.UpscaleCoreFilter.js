!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.vectorly=t():(e.vectorly=e.vectorly||{},e.vectorly.UpscaleCoreFilter=t())}(self,(function(){return function(){var e={553:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var o=t&&t.prototype instanceof y?t:y,a=Object.create(o.prototype),i=new k(n||[]);return a._invoke=function(e,t,r){var n=l;return function(o,a){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===o)throw a;return P()}for(r.method=o,r.arg=a;;){var i=r.delegate;if(i){var s=R(i,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=f(e,t,r);if("normal"===u.type){if(n=r.done?d:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(e,r,i),a}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l="suspendedStart",h="suspendedYield",p="executing",d="completed",g={};function y(){}function m(){}function v(){}var E={};u(E,a,(function(){return this}));var _=Object.getPrototypeOf,w=_&&_(_(I([])));w&&w!==r&&n.call(w,a)&&(E=w);var T=v.prototype=y.prototype=Object.create(E);function b(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(o,a,i,s){var u=f(e[o],e,a);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(l).then((function(e){c.value=e,i(c)}),(function(e){return r("throw",e,i,s)}))}s(u.arg)}var o;this._invoke=function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}}function R(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,R(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=f(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,g;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function I(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:P}}function P(){return{value:t,done:!0}}return m.prototype=v,u(T,"constructor",v),u(v,"constructor",m),m.displayName=u(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,u(e,s,"GeneratorFunction")),e.prototype=Object.create(T),e},e.awrap=function(e){return{__await:e}},b(x.prototype),u(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new x(c(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},b(T),u(T,s,"Generator"),u(T,a,(function(){return this})),u(T,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=I,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:I(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},757:function(e,t,r){e.exports=r(553)},706:function(e,t,r){"use strict";function n(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function o(){return n()?(self.isWorker=!0,self):(window.isWorker=!1,window)}function a(e){return n()?e instanceof OffscreenCanvasRenderingContext2D:e instanceof CanvasRenderingContext2D}r.d(t,{uL:function(){return u},Th:function(){return s},yb:function(){return i},Hy:function(){return X},ZS:function(){return N}});var i=function(e,t){let r;"string"==typeof e&&(e=document.getElementById(e));let n=1;if("true"===t.use_webgl1?r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}):(r=e.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1}),n=2,r||(n=1,r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}))),r.getExtension("WEBGL_draw_buffers")?r.disable_multi_draw=t.disable_multi_draw||!1:r.disable_multi_draw=!0,r.extensions={},r.getVersion=function(){return n},1===r.getVersion()){if("float32"===t.float_type){if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.FLOAT}else{if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_half_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_half_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.extensions.EXT_FLOAT.HALF_FLOAT_OES}if(!r.disable_multi_draw&&(r.extensions.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),!r.extensions.WEBGL_draw_buffers))throw new Error("Extension not found: WEBGL_draw_buffers")}else{if(r.extensions.EXT_FLOAT=r.getExtension("EXT_color_buffer_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: EXT_color_buffer_float");"float32"===t.float_type?(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.texture_format=r.RGBA32F,r.texture_type=r.FLOAT):(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.texture_format=r.RGBA16F,r.texture_type=r.FLOAT)}return 1===r.getVersion()?(r.getCOLOR_ATTACHMENT=function(e=0){return r.disable_multi_draw?r.COLOR_ATTACHMENT0:r.extensions.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(e)}):(r.getCOLOR_ATTACHMENT=function(e=0){return r.COLOR_ATTACHMENT0+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.drawBuffers(e)}),o().gl=r,r.canvas.w=r.canvas.width,r.canvas.h=r.canvas.height,r.clearCanvas=function(){r.clearColor(0,0,0,1),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)},r.input={h:t.h,w:t.w},r.render_scale={h:1,w:1},r.viewport(0,0,e.width,e.height),r.createAndCompileShader=function(e,t){let n=r.createShader(e);if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(n));return n},r.createAndLinkProgram=function(e,t){let n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,t),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw new Error(r.getProgramInfoLog(n));return n},r.resizeCanvasToDisplaySize=function(t,r){return(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,!0)},r.resizeRenderSize=function(e,t,n){let o=n*r.input.w,a=n*r.input.h;o=e>o?e:o,a=t>a?t:a,r.render_scale={w:e/o,h:t/a},r.resizeCanvasToDisplaySize(o,a)},r.log=function(e){},r},s=class{constructor(e,t,r,n){this.gl=e,this.network=t,this.frameBuffer=r,this.renderSize={w:n.w,h:n.h},this.metrics={"Render Size":this.renderSize,"Original Size":e.input,"Upscale Factor":t.upscaleFactor,FPS:0},this.setProperties(n)}setProperties(e={w:1278,h:720,disableVideoToCanvas:!1}){const t=this;!0!==e.disableVideoToCanvas&&this.frameBuffer.setInputFrameCanvas(),void 0===e.w&&(e.w=this.network.upscaleFactor*this.gl.input.w),void 0===e.h&&(e.h=this.network.upscaleFactor*this.gl.input.h),this.renderSize=e,this.gl.resizeRenderSize(e.w,e.h,this.network.upscaleFactor),null!==this.frameBuffer.inputTex&&setTimeout((()=>{t.network.renderRGB(t.gl.render_scale)})),t.metrics["Render Size"]=e}setInputSize(e={w:426,h:240},t=null){this.gl.input={w:e.w,h:e.h},this.network.resetTextureBuffers(),this.setProperties(t||this.renderSize)}async resetNetwork(e){this.frameBuffer.clearall(),this.network=await async function(e={name:"",version:"",tag:"",token:""},t,r){let n=null,o=null;try{o=await N(e.name,e.tag,e.version,e.token)}catch(e){throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error(e)}if(!o)throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error("");try{const a=X(e.name,e.token);n=await a,n=new n(t,r,o)}catch(e){throw console.error("%cNetwork load failed:","background:black; color: yellow"),new Error(e)}return n}({name:e.name,version:e.version,tag:e.tag},this.gl,this.network.frameBuffer),this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl,this.setProperties(this.renderSize)}changeNetwork(e){this.network=e,this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl}async loadBitmap(e){const t=this.frameBuffer;this.network,t.setInputImage(e),await this.render()}loadImage(e){const t=new Image;t.src=e;const r=this.frameBuffer,n=this,o=this.network;t.onload=async function(){r.setInputImage(t),await n.render(),o.getImageBytes()}}async render(e){const t=this.gl,r=this.network;t.clearColor(0,0,0,1),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),r.initialized&&await r.initialized,await r.feedForward(t.render_scale,e),t.flush()}},u=class{constructor(e){this.gl=e,this.iterations=0,this.textures=[{},{}],this.frame_buffers=[{},{}],this.inputTex=null,this.inputCanvas=null,this.frame_difference=0}drawToCanvas(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}setBuffer(e){const t=this.gl,r=this.iterations%2*this.frame_difference;t.bindFramebuffer(t.FRAMEBUFFER,this.frame_buffers[r][e])}setInputFrameCanvas(){o(),a(this.inputCanvas)||(this.inputCanvas=function(e,t){if(n())return new OffscreenCanvas(e,t);{const r=document.createElement("canvas");return r.width=e,r.height=t,r}}(this.gl.input.w,this.gl.input.h).getContext("2d")),this.inputCanvas.canvas.width=this.gl.input.w,this.inputCanvas.canvas.height=this.gl.input.h}videoToCanvas(e){return this.inputCanvas.drawImage(e,0,0,this.gl.input.w,this.gl.input.h),this.inputCanvas.canvas}getInputTexture(){const e=this.gl;if(null===this.inputTex){let t=e.createTexture();this.inputTex=this._setTextureSize(t,e.input.w,e.input.h)}return this.inputTex}setInputImage(e){this.input=e;const t=this.gl;a(this.inputCanvas)&&1===t.getVersion()&&(e=this.videoToCanvas(e));let r=this.getInputTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.texture_format,t.RGBA,t.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e].INPUT=[r]}setImageAsTexture(e,t){const r=this.gl;let n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.texture_format,r.RGBA,r.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e][t]=[n]}createBufferWithTextures(e,t,r=1,n=null){const o=this.gl;for(let a=0;a<=this.frame_difference;a++){const i=o.createFramebuffer();this.frame_buffers[a][e]=i,o.bindFramebuffer(o.FRAMEBUFFER,i);const s=[];this.textures[a][e]=null;for(let e=0;e<t;++e){let t=this.createAndSetupTexture(n);t=this._setTextureSize(t,o.input.w*r,o.input.h*r),s.push(t),o.bindTexture(o.TEXTURE_2D,t),o.texImage2D(o.TEXTURE_2D,0,o.texture_format,o.input.w*r,o.input.h*r,0,o.RGBA,o.texture_type,null),o.framebufferTexture2D(o.FRAMEBUFFER,o.getCOLOR_ATTACHMENT(e),o.TEXTURE_2D,t,0)}this.textures[a][e]=s}}createBufferWithTextures2(e,t,r,n,o={}){const a=this.gl;if(r<=0||n<=0)throw new Error("Texture width and height must be greater than 0");let i=o.format||a.RGBA,s=o.minFilter||a.NEAREST,u=o.magFilter||a.NEAREST,c=o.type||a.texture_type||a.UNSIGNED_BYTE,f=o.internalFormat||a.texture_format||a.RGBA;for(let o=0;o<=this.frame_difference;o++){const l=a.createFramebuffer();this.frame_buffers[o][e]=l,a.bindFramebuffer(a.FRAMEBUFFER,l);const h=[];this.textures[o][e]=null;for(let e=0;e<t;++e){let t;1===a.getVersion()?t=this.createTexture_webgl1(f,r,n,i,c,s,u):(f===a.RGBA&&(f=a.RGBA8),t=this.createTexture_webgl2(f,r,n,s,u)),a.framebufferTexture2D(a.FRAMEBUFFER,a.getCOLOR_ATTACHMENT(e),a.TEXTURE_2D,t,0),h.push(t)}this.textures[o][e]=h}}getTextureSize(e,t=0,r=0){if(!this.textures[t][e][r])throw new Error(`Failed to get resolution of textures for layer: ${e} at index: ${index}`);return this.textures[t][e][r].size}createTexture_webgl2(e,t,r,n,o){n=n||gl.NEAREST,o=o||gl.NEAREST,e=e||gl.texture_format||gl.RGBA;let a=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,n),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,o),gl.texStorage2D(gl.TEXTURE_2D,1,e,t,r),a=this._setTextureSize(a,t,r),a}createTexture_webgl1(e,t,r,n,o,a,i){n=n||gl.RGBA,a=a||gl.NEAREST,i=i||gl.NEAREST,o=o||gl.texture_type||gl.UNSIGNED_BYTE,e=e||gl.texture_format||gl.RGBA;let s=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,i),gl.texImage2D(gl.TEXTURE_2D,0,e,t,r,0,n,o,null),s=this._setTextureSize(s,t,r),s}createFloatTextureFromArrayBuffer(e,t,r,n,o,a,i,s){a=a||gl.RGBA,i=i||gl.NEAREST,s=s||gl.NEAREST,o=o||gl.texture_type||gl.UNSIGNED_BYTE,t=t||gl.texture_format||gl.RGBA;const u=new Float32Array(e);let c=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,i),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,s),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32F,r,n,0,gl.RGBA,gl.FLOAT,u),c=this._setTextureSize(c,r,n),c}_setTextureSize(e,t,r){return t>0&&r>0&&(e.size={},e.size.width=t,e.size.height=r),e}setBufferForLayer(e,t){for(let r=0;r<=this.frame_difference;r++){const n=gl.createFramebuffer();this.frame_buffers[r][e]=n,gl.bindFramebuffer(gl.FRAMEBUFFER,n);for(let e=0;e<t.length;e++)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.getCOLOR_ATTACHMENT(e),gl.TEXTURE_2D,t[e],0);this.textures[r][e]=t}}getTexture(e){const t=this.iterations%2*this.frame_difference;return this.textures[t][e]}getLastFrameTexture(e){const t=1-this.iterations%2;return this.textures[t][e]}clearall(){Object.keys(this.textures[0]).forEach((e=>{for(let t=0;t<=this.frame_difference;t++){this.gl.deleteFramebuffer(this.frame_buffers[t][e]),this.frame_buffers[t][e]=null;for(let r=0;r<this.textures[t][e].length;++r)this.gl.deleteTexture(this.textures[t][e][r]),this.textures[t][e][r]=null}})),this.gl.deleteTexture(this.inputTex),this.inputTex=null,this.inputCanvas=null,this.frame_buffers=[{},{}],this.textures=[{},{}],this.gl.clearCanvas()}createAndSetupTexture(e=null){const t=this.gl;t.extensions.EXT_FLOAT_LINEAR||(e=null),null===e&&(e=t.NEAREST);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}};r(435);var c=r(618),f=r(443),l=r.n(f),h=r(595),p=r.n(h),d="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==d&&d,g="URLSearchParams"in d,y="Symbol"in d&&"iterator"in Symbol,m="FileReader"in d&&"Blob"in d&&function(){try{return new Blob,!0}catch(e){return!1}}(),v="FormData"in d,E="ArrayBuffer"in d;if(E)var _=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],w=ArrayBuffer.isView||function(e){return e&&_.indexOf(Object.prototype.toString.call(e))>-1};function T(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function b(e){return"string"!=typeof e&&(e=String(e)),e}function x(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return y&&(t[Symbol.iterator]=function(){return t}),t}function R(e){this.map={},e instanceof R?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function A(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function O(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function k(e){var t=new FileReader,r=O(t);return t.readAsArrayBuffer(e),r}function I(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function P(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:m&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:v&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:g&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():E&&m&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=I(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):E&&(ArrayBuffer.prototype.isPrototypeOf(e)||w(e))?this._bodyArrayBuffer=I(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},m&&(this.blob=function(){var e=A(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?A(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(k)}),this.text=function(){var e,t,r,n=A(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=O(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},v&&(this.formData=function(){return this.text().then(U)}),this.json=function(){return this.text().then(JSON.parse)},this}R.prototype.append=function(e,t){e=T(e),t=b(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},R.prototype.delete=function(e){delete this.map[T(e)]},R.prototype.get=function(e){return e=T(e),this.has(e)?this.map[e]:null},R.prototype.has=function(e){return this.map.hasOwnProperty(T(e))},R.prototype.set=function(e,t){this.map[T(e)]=b(t)},R.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},R.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),x(e)},R.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),x(e)},R.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),x(e)},y&&(R.prototype[Symbol.iterator]=R.prototype.entries);var S=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function L(e,t){if(!(this instanceof L))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,o=(t=t||{}).body;if(e instanceof L){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new R(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new R(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),S.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(o),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;a.test(this.url)?this.url=this.url.replace(a,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function U(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function C(e,t){if(!(this instanceof C))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new R(t.headers),this.url=t.url||"",this._initBody(e)}L.prototype.clone=function(){return new L(this,{body:this._bodyInit})},P.call(L.prototype),P.call(C.prototype),C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new R(this.headers),url:this.url})},C.error=function(){var e=new C(null,{status:0,statusText:""});return e.type="error",e};var B=[301,302,303,307,308];C.redirect=function(e,t){if(-1===B.indexOf(t))throw new RangeError("Invalid status code");return new C(null,{status:t,headers:{location:e}})};var F=d.DOMException;try{new F}catch(e){(F=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),F.prototype.constructor=F}function D(e,t){return new Promise((function(r,n){var o=new L(e,t);if(o.signal&&o.signal.aborted)return n(new F("Aborted","AbortError"));var a=new XMLHttpRequest;function i(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new R,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;setTimeout((function(){r(new C(o,n))}),0)},a.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){n(new F("Aborted","AbortError"))}),0)},a.open(o.method,function(e){try{return""===e&&d.location.href?d.location.href:e}catch(t){return e}}(o.url),!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&(m?a.responseType="blob":E&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof R?o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){a.setRequestHeader(e,b(t.headers[e]))})),o.signal&&(o.signal.addEventListener("abort",i),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",i)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}D.polyfill=!0,d.fetch||(d.fetch=D,d.Headers=R,d.Request=L,d.Response=C);const M=o();let X=async(e,t={})=>{let n,o=((t=t||{}).path||r.p)+`models/${e}.js`;var a;return t.token&&(o=o+"?"+t.token),M.vectorlyBasePath=t.path||r.p,"background_selfie"===e&&(n=(async()=>{let e;if(M.tflite)e=M.tflite;else{let t=M.vectorlyBasePath||"";try{if(!0!==c.feature.simd)throw new Error("SIMD feature check is false");e=await l()({basePath:t})}catch(r){e=await p()({basePath:t})}}return e})()),M.isWorker?importScripts(o):await(a=o,new Promise(((e,t)=>{const r="$importModule$"+Math.random().toString(32).slice(2),n=document.createElement("script"),o=()=>{delete window[r],n.onerror=null,n.onload=null,n.remove(),URL.revokeObjectURL(n.src),n.src=""};n.defer="defer",n.type="module",n.onerror=()=>{t(new Error(`Failed to import: ${a}`)),o()},n.onload=()=>{e(window[r]),o()};const i=function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(a),s=new Blob([`import * as m from "${i}"; window.${r} = m;`],{type:"text/javascript"});n.src=URL.createObjectURL(s),document.head.appendChild(n)}))),"background_selfie"===e&&(M.tflite=await n),M.vectorly.models[e]},N=async(e,t,n,o)=>{if(o=o||{},"background_selfie"===e){let a=(o.path||r.p)+`./data/${e}/${t}_v${n}.tflite`;o.token&&(a=a+"?"+o.token);const i=await fetch(a);if(!i.ok)throw Error(`Response fetching "${a}": ${i.statusText}`);return{model:await i.arrayBuffer()}}if("background_webgl2"===e||"background_webgl"===e||"background_webgl_unet"===e){let a=(o.path||r.p)+`./data/${e}/${t}_v${n}.json`,i=(o.path||r.p)+`./data/${e}/${t}_v${n}.weights`;o.token&&(a+="?"+o.token,i+="?"+o.token);const[s,u]=await Promise.all([fetch(a),fetch(i)]),[c,f]=await Promise.all([s.json(),u.arrayBuffer()]),l=JSON.parse(JSON.stringify(c)),h=new Float32Array(f),p=Object.keys(c),d=["weights","biases"];c[p[0]].debugImage&&d.push("debugImage");for(let e of p)for(let t of d){let[r,n]=c[e][t];l[e][t]=h.slice(n,n+r)}return l}{let a=(o.path||r.p)+`./data/${e}/${t}_v${n}.json`;o.token&&(a=a+"?"+o.token);const i=await fetch(a);return await i.json()}}},435:function(e){e.exports=["cnn_demo","residual_3k_3x","residual_4k_2x","residual_5k_2x","residual_5k_3x","denoise_10k_1x","background_selfie","background_webgl_unet","background_webgl","background_webgl2","upscaler_4krgb_2x"]},443:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,o=void 0!==(e=e||{})?e:{};o.ready=new Promise((function(e,t){r=e,n=t}));var a,i={};for(a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var p,d,g="";(s||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var y,m=o.print||console.log.bind(console),v=o.printErr||console.warn.bind(console);for(a in i)i.hasOwnProperty(a)&&(o[a]=i[a]);i=null,o.arguments&&(f=o.arguments),o.thisProgram&&(l=o.thisProgram),o.quit&&(h=o.quit),o.wasmBinary&&(y=o.wasmBinary);var E,_=o.noExitRuntime||!0;"object"!=typeof WebAssembly&&D("no native wasm support detected");var w,T,b,x,R=!1,A="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&A)return A.decode(e.subarray(t,o));for(var a="";t<o;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(i);else{var c=i-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&i)<<6|s)}else a+=String.fromCharCode(i)}return a}function k(e){w=e,o.HEAP8=T=new Int8Array(e),o.HEAP16=new Int16Array(e),o.HEAP32=x=new Int32Array(e),o.HEAPU8=b=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAPU32=new Uint32Array(e),o.HEAPF32=new Float32Array(e),o.HEAPF64=new Float64Array(e)}o.INITIAL_MEMORY;var I,P=[],S=[],L=[],U=[];S.push({func:function(){K()}});var C=0,B=null,F=null;function D(e){o.onAbort&&o.onAbort(e),v(e+=""),R=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function M(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function X(e){return M(e,"data:application/octet-stream;base64,")}function N(e){return M(e,"file://")}o.preloadedImages={},o.preloadedAudios={};var G,W,j="./tflite/tflite-simd.wasm";function H(e){try{if(e==j&&y)return new Uint8Array(y);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function z(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?I.get(r)():I.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(o)}}function $(e){return x[ee()>>2]=e,e}function q(e){try{return E.grow(e-w.byteLength+65535>>>16),k(E.buffer),1}catch(e){}}X(j)||(G=j,j=o.locateFile?o.locateFile(G,g):(g=o.basePath||g)+G),W=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Z={};function V(){if(!V.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in Z)e[t]=Z[t];var r=[];for(var t in e)r.push(t+"="+e[t]);V.strings=r}return V.strings}var Y,J={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=J.buffers[e];0===t||10===t?((1===e?m:v)(O(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return J.varargs+=4,x[J.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?O(b,e,void 0):""}(e);return t},get64:function(e,t){return e}},Q={a:function(){D()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return $(28),-1;r=W()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){D("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){D("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){b.copyWithin(e,t,t+r)},m:function(e){var t,r=b.length,n=2147483648;if(e>n)return!1;for(var o=1;o<=4;o*=2){var a=r*(1+.2/o);if(a=Math.min(a,e+100663296),q(Math.min(n,((t=Math.max(e,a))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=W();W()-t<e;);},p:function(e,t){var r=0;return V().forEach((function(n,o){var a=t+r;x[e+4*o>>2]=a,function(e,t,r){for(var n=0;n<e.length;++n)T[t++>>0]=e.charCodeAt(n);T[t>>0]=0}(n,a),r+=n.length+1})),0},g:function(e,t){var r=V();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){_||(o.onExit&&o.onExit(e),R=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,o){},c:function(e,t,r,n){for(var o=0,a=0;a<r;a++){for(var i=x[t+8*a>>2],s=x[t+(8*a+4)>>2],u=0;u<s;u++)J.printChar(e,b[i+u]);o+=s}return x[n>>2]=o,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return $(28),-1}},K=(function(){var e={a:Q};function t(e,t){var r=e.exports;o.asm=r,k((E=o.asm.q).buffer),I=o.asm.D,function(e){if(C--,o.monitorRunDependencies&&o.monitorRunDependencies(C),0==C&&(null!==B&&(clearInterval(B),B=null),F)){var t=F;F=null,t()}}()}function r(e){t(e.instance)}function a(t){return function(){if(!y&&(s||u)){if("function"==typeof fetch&&!N(j))return fetch(j,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+j+"'";return e.arrayBuffer()})).catch((function(){return H(j)}));if(p)return new Promise((function(e,t){p(j,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return H(j)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){v("failed to asynchronously prepare wasm: "+e),D(e)}))}if(C++,o.monitorRunDependencies&&o.monitorRunDependencies(C),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){return v("Module.instantiateWasm callback failed with error: "+e),!1}(y||"function"!=typeof WebAssembly.instantiateStreaming||X(j)||N(j)||"function"!=typeof fetch?a(r):fetch(j,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),a(r)}))}))).catch(n)}(),o.___wasm_call_ctors=function(){return(K=o.___wasm_call_ctors=o.asm.r).apply(null,arguments)}),ee=(o._getModelBufferMemoryOffset=function(){return(o._getModelBufferMemoryOffset=o.asm.s).apply(null,arguments)},o._getInputMemoryOffset=function(){return(o._getInputMemoryOffset=o.asm.t).apply(null,arguments)},o._getInputHeight=function(){return(o._getInputHeight=o.asm.u).apply(null,arguments)},o._getInputWidth=function(){return(o._getInputWidth=o.asm.v).apply(null,arguments)},o._getInputChannelCount=function(){return(o._getInputChannelCount=o.asm.w).apply(null,arguments)},o._getOutputMemoryOffset=function(){return(o._getOutputMemoryOffset=o.asm.x).apply(null,arguments)},o._getOutputHeight=function(){return(o._getOutputHeight=o.asm.y).apply(null,arguments)},o._getOutputWidth=function(){return(o._getOutputWidth=o.asm.z).apply(null,arguments)},o._getOutputChannelCount=function(){return(o._getOutputChannelCount=o.asm.A).apply(null,arguments)},o._loadModel=function(){return(o._loadModel=o.asm.B).apply(null,arguments)},o._runInference=function(){return(o._runInference=o.asm.C).apply(null,arguments)},o.___errno_location=function(){return(ee=o.___errno_location=o.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,o.calledRun=!0,R||(z(S),z(L),r(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),U.unshift(e);var e;z(U)}()))}e=e||f,C>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),P.unshift(e);var e;z(P)}(),C>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),t()}),1)):t()))}if(F=function e(){Y||re(),Y||(F=e)},o.run=re,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return re(),e.ready});e.exports=r},595:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,o=void 0!==(e=e||{})?e:{};o.ready=new Promise((function(e,t){r=e,n=t}));var a,i={};for(a in o)o.hasOwnProperty(a)&&(i[a]=o[a]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var p,d,g="";(s||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var y,m=o.print||console.log.bind(console),v=o.printErr||console.warn.bind(console);for(a in i)i.hasOwnProperty(a)&&(o[a]=i[a]);i=null,o.arguments&&(f=o.arguments),o.thisProgram&&(l=o.thisProgram),o.quit&&(h=o.quit),o.wasmBinary&&(y=o.wasmBinary);var E,_=o.noExitRuntime||!0;"object"!=typeof WebAssembly&&D("no native wasm support detected");var w,T,b,x,R=!1,A="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,r){for(var n=t+r,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&A)return A.decode(e.subarray(t,o));for(var a="";t<o;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(i);else{var c=i-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&i)<<6|s)}else a+=String.fromCharCode(i)}return a}function k(e){w=e,o.HEAP8=T=new Int8Array(e),o.HEAP16=new Int16Array(e),o.HEAP32=x=new Int32Array(e),o.HEAPU8=b=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAPU32=new Uint32Array(e),o.HEAPF32=new Float32Array(e),o.HEAPF64=new Float64Array(e)}o.INITIAL_MEMORY;var I,P=[],S=[],L=[],U=[];S.push({func:function(){K()}});var C=0,B=null,F=null;function D(e){o.onAbort&&o.onAbort(e),v(e+=""),R=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function M(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function X(e){return M(e,"data:application/octet-stream;base64,")}function N(e){return M(e,"file://")}o.preloadedImages={},o.preloadedAudios={};var G,W,j="./tflite/tflite.wasm";function H(e){try{if(e==j&&y)return new Uint8Array(y);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function z(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?I.get(r)():I.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(o)}}function $(e){return x[ee()>>2]=e,e}function q(e){try{return E.grow(e-w.byteLength+65535>>>16),k(E.buffer),1}catch(e){}}X(j)||(G=j,j=o.locateFile?o.locateFile(G,g):(g=o.basePath||g)+G),W=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Z={};function V(){if(!V.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in Z)e[t]=Z[t];var r=[];for(var t in e)r.push(t+"="+e[t]);V.strings=r}return V.strings}var Y,J={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=J.buffers[e];0===t||10===t?((1===e?m:v)(O(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return J.varargs+=4,x[J.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?O(b,e,void 0):""}(e);return t},get64:function(e,t){return e}},Q={a:function(){D()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return $(28),-1;r=W()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){D("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){D("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){b.copyWithin(e,t,t+r)},m:function(e){var t,r=b.length,n=2147483648;if(e>n)return!1;for(var o=1;o<=4;o*=2){var a=r*(1+.2/o);if(a=Math.min(a,e+100663296),q(Math.min(n,((t=Math.max(e,a))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=W();W()-t<e;);},p:function(e,t){var r=0;return V().forEach((function(n,o){var a=t+r;x[e+4*o>>2]=a,function(e,t,r){for(var n=0;n<e.length;++n)T[t++>>0]=e.charCodeAt(n);T[t>>0]=0}(n,a),r+=n.length+1})),0},g:function(e,t){var r=V();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){_||(o.onExit&&o.onExit(e),R=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,o){},c:function(e,t,r,n){for(var o=0,a=0;a<r;a++){for(var i=x[t+8*a>>2],s=x[t+(8*a+4)>>2],u=0;u<s;u++)J.printChar(e,b[i+u]);o+=s}return x[n>>2]=o,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return $(28),-1}},K=(function(){var e={a:Q};function t(e,t){var r=e.exports;o.asm=r,k((E=o.asm.q).buffer),I=o.asm.D,function(e){if(C--,o.monitorRunDependencies&&o.monitorRunDependencies(C),0==C&&(null!==B&&(clearInterval(B),B=null),F)){var t=F;F=null,t()}}()}function r(e){t(e.instance)}function a(t){return function(){if(!y&&(s||u)){if("function"==typeof fetch&&!N(j))return fetch(j,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+j+"'";return e.arrayBuffer()})).catch((function(){return H(j)}));if(p)return new Promise((function(e,t){p(j,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return H(j)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){v("failed to asynchronously prepare wasm: "+e),D(e)}))}if(C++,o.monitorRunDependencies&&o.monitorRunDependencies(C),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){return v("Module.instantiateWasm callback failed with error: "+e),!1}(y||"function"!=typeof WebAssembly.instantiateStreaming||X(j)||N(j)||"function"!=typeof fetch?a(r):fetch(j,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return v("wasm streaming compile failed: "+e),v("falling back to ArrayBuffer instantiation"),a(r)}))}))).catch(n)}(),o.___wasm_call_ctors=function(){return(K=o.___wasm_call_ctors=o.asm.r).apply(null,arguments)}),ee=(o._getModelBufferMemoryOffset=function(){return(o._getModelBufferMemoryOffset=o.asm.s).apply(null,arguments)},o._getInputMemoryOffset=function(){return(o._getInputMemoryOffset=o.asm.t).apply(null,arguments)},o._getInputHeight=function(){return(o._getInputHeight=o.asm.u).apply(null,arguments)},o._getInputWidth=function(){return(o._getInputWidth=o.asm.v).apply(null,arguments)},o._getInputChannelCount=function(){return(o._getInputChannelCount=o.asm.w).apply(null,arguments)},o._getOutputMemoryOffset=function(){return(o._getOutputMemoryOffset=o.asm.x).apply(null,arguments)},o._getOutputHeight=function(){return(o._getOutputHeight=o.asm.y).apply(null,arguments)},o._getOutputWidth=function(){return(o._getOutputWidth=o.asm.z).apply(null,arguments)},o._getOutputChannelCount=function(){return(o._getOutputChannelCount=o.asm.A).apply(null,arguments)},o._loadModel=function(){return(o._loadModel=o.asm.B).apply(null,arguments)},o._runInference=function(){return(o._runInference=o.asm.C).apply(null,arguments)},o.___errno_location=function(){return(ee=o.___errno_location=o.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,o.calledRun=!0,R||(z(S),z(L),r(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),U.unshift(e);var e;z(U)}()))}e=e||f,C>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),P.unshift(e);var e;z(P)}(),C>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),t()}),1)):t()))}if(F=function e(){Y||re(),Y||(F=e)},o.run=re,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return re(),e.ready});e.exports=r},55:function(e,t,r){"use strict";r.d(t,{re:function(){return c},Qy:function(){return f}});var n=r(861),o=r(757),a=r.n(o),i=function(e){var t,r=e||"production";switch(r){case"local":t="http://localhost:4000";break;case"staging":t="https://stream-staging.vectorly.io";break;default:t="https://stream.vectorly.io"}return t},s=function(){var e="1.6.10";return"https://cdn.vectorly.io/ai-filters/v1/".concat(e,"/")},u=function(){var e=(0,n.Z)(a().mark((function e(t,r,n){var o,u,c,f,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s(),u="".concat(i(n),"/upscaler/models/").concat(t.name,"?token=").concat(r,"&path=").concat(encodeURI(o),"&version=").concat(t.version,"&tag=").concat(t.tag),e.next=4,fetch(u);case 4:if(!(c=e.sent).ok){e.next=14;break}return e.next=8,c.json();case 8:return f=e.sent,l=f.token,e.abrupt("return",l);case 14:case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),c=function(){var e=(0,n.Z)(a().mark((function e(t,r,n){var o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o={path:s()},!n||"staging"!==n&&"local"!==n){e.next=13;break}return e.prev=2,e.next=5,u(t,r,n);case 5:o.token=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Error while fetching token in staging, defaulting to local files",e.t0);case 11:e.next=16;break;case 13:return e.next=15,u(t,r,n);case 15:o.token=e.sent;case 16:return e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r,n){return e.apply(this,arguments)}}();function f(){var e={};return["load","error","stop","start"].forEach((function(t){e[t]=new Event("vectorly-upscaler-"+t)})),e}},877:function(e,t,r){var n=r(570),o=r(171),a=o;a.v1=n,a.v4=o,e.exports=a},327:function(e){for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0,o=t;return[o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],"-",o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]],o[e[n++]]].join("")}},217:function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},570:function(e,t,r){var n,o,a=r(217),i=r(327),s=0,u=0;e.exports=function(e,t,r){var c=t&&r||0,f=t||[],l=(e=e||{}).node||n,h=void 0!==e.clockseq?e.clockseq:o;if(null==l||null==h){var p=a();null==l&&(l=n=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=o=16383&(p[6]<<8|p[7]))}var d=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:u+1,y=d-s+(g-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||d>s)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=d,u=g,o=h;var m=(1e4*(268435455&(d+=122192928e5))+g)%4294967296;f[c++]=m>>>24&255,f[c++]=m>>>16&255,f[c++]=m>>>8&255,f[c++]=255&m;var v=d/4294967296*1e4&268435455;f[c++]=v>>>8&255,f[c++]=255&v,f[c++]=v>>>24&15|16,f[c++]=v>>>16&255,f[c++]=h>>>8|128,f[c++]=255&h;for(var E=0;E<6;++E)f[c+E]=l[E];return t||i(f)}},171:function(e,t,r){var n=r(217),o=r(327);e.exports=function(e,t,r){var a=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||n)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[a+s]=i[s];return t||o(i)}},618:function(e){"use strict";function t(e,t){if(!c)return!1;const n=e.buffer;let o=l.get(n);if(null==o){if((o=r.validate(n))&&t)try{new r.Instance(new r.Module(n)).exports[0]()}catch(e){o=!1}l.set(n,o)}return o}const r=WebAssembly,n=(...e)=>Uint8Array.of(0,97,115,109,1,0,0,0,...e),o=(...e)=>Uint32Array.of(1836278016,1,...e),a=(...e)=>o(1610679297,33751040,...e,40239360,259),i=(...e)=>n(1,4,1,96,0,0,3,2,1,0,...e,11,0,10,4,110,97,109,101,2,3,1,0,0),s=(...e)=>Uint16Array.of(24832,28019,1,0,1025,24577,0,515,1,...e),u=(...e)=>s(...e,2842,4096,28164,28001,357,260,256,560,259,0),c="object"==typeof r,f=e=>c&&"function"==typeof e,l=new WeakMap,h=o(1610679553,58589440,117440770,805372165,101318656,1107297281,268438272,1835101700,17039717,36700416,259),p=s(773,1,2561,269,11,65,65,65,3068,2816,2560,28164,28001,613,259,0),d=o(1610679297,33751040,134873089,100664833,185276736),g=n(2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1,0,8,4,110,97,109,101,2,1,0),y=Uint16Array.of(24832,28019,1,0,1537,24577,512,32639,515,1,2058,1537,16640,16640,2816,2560,28164,28001,613,259,0),m=u(3082,2561,17152,0,0,252),v=u(2058,1537,16640,49152),E=a(101318657,301990913,268438272,1835101700,17039717),_=i(5,4,1,3,1,1,10,7,1,5,0,254,3,0),w=a(84344833,6357249,17369600,4259847,186257917,1845758464),T=i(10,7,1,5,0,208,112,26);e.exports={support:(e=1)=>c&&t(Uint32Array.of(1836278016,e)),get supportStreaming(){return f(r.instantiateStreaming)},feature:{get bigInt(){return t(h,!0)},get bulk(){return t(p)},get exceptions(){return t(d)},get mutableGlobal(){return t(g)},get multiValue(){return t(y)},get saturateConversions(){return t(m)},get signExtensions(){return t(v)},get tailCall(){return t(E)},get threads(){return t(_)},get simd(){return t(w)},get references(){return t(T)},get typeReflection(){return f(r.Memory.type)},get funcReferences(){return f(r.Function)}}}},861:function(e,t,r){"use strict";function n(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise((function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,u,"next",e)}function u(e){n(i,o,a,s,u,"throw",e)}s(void 0)}))}}r.d(t,{Z:function(){return o}})},671:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{Z:function(){return n}})},144:function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,{Z:function(){return o}})}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var n={};return function(){"use strict";var e=r(861),t=r(671),o=r(144),a=r(757),i=r.n(a),s=r(706),u=r(877),c=r(55),f=function(){function r(){(0,t.Z)(this,r),this.events=(0,c.Qy)()}var n,a,f,l,h,p,d,g;return(0,o.Z)(r,[{key:"load",value:(g=(0,e.Z)(i().mark((function e(t){var r,n,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}throw console.log("load: "),document.dispatchEvent(this.events.error),new Error("Invalid load config");case 4:return this.token=t.token,this.serverType=t.serverType,r=this.initCanvasWebGL(t),n=this.initFrameBufferWebGL(r),e.next=10,this.importNetwork(n,t.networkParams,t.networkOptions);case 10:return o=e.sent,this.networkInstance=o,e.next=14,this.initRenderer(o,n,t.renderSize);case 14:this.renderer=e.sent;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"on",value:function(e,t){return document.addEventListener("vectorly-upscaler-"+e,t),this}},{key:"initCanvasWebGL",value:function(e){try{return e&&e.canvas&&e.w&&e.h,(0,s.yb)(e.canvas,e)}catch(e){throw console.error("Error in initCanvasWebGL: ",e),document.dispatchEvent(this.events.error),e}}},{key:"initFrameBufferWebGL",value:function(e){try{if(!e)throw new Error("WebGLContext not found");return new s.uL(e)}catch(e){throw console.error("Error in initFrameBufferWebGL: ",e),document.dispatchEvent(this.events.error),e}}},{key:"importNetwork",value:(d=(0,e.Z)(i().mark((function e(t,r,n){var o,a,u,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.clearall()&&r.name&&r.tag&&r.version,e.next=4,(0,c.re)(r,this.token,this.serverType);case 4:return o=e.sent,e.next=7,(0,s.ZS)(r.name,r.tag,r.version,o);case 7:return a=e.sent,e.next=10,(0,s.Hy)(r.name,o);case 10:return u=e.sent,n.networkParams=r,f=new u(t.gl,t,a,n),e.abrupt("return",f);case 16:throw e.prev=16,e.t0=e.catch(0),console.error("Error in importNetwork: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 21:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t,r){return d.apply(this,arguments)})},{key:"updateNetworkOptions",value:(p=(0,e.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.renderer,!e.t0){e.next=4;break}return e.next=4,this.renderer;case 4:if(e.t1=this.networkInstance,!e.t1){e.next=8;break}return e.next=8,this.networkInstance.updateOptions(t);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"initRenderer",value:(h=(0,e.Z)(i().mark((function e(t,r,n){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==n&&(n={}),e.next=4,t;case 4:return t=e.sent,o=new s.Th(r.gl,t,r,n),document.dispatchEvent(this.events.load),e.abrupt("return",o);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error in initRenderer: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t,r){return h.apply(this,arguments)})},{key:"render",value:(l=(0,e.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.renderer;case 3:(t=e.sent)&&t.render(),e.next=12;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error in render: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return l.apply(this,arguments)})},{key:"updateInputResolution",value:(f=(0,e.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.w&&t.h||console.warn("warning: Invalid InputSize width and height"),e.next=4,this.renderer;case 4:e.sent.setInputSize(t),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in updateInputResolution: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return f.apply(this,arguments)})},{key:"updateRenderResolution",value:(a=(0,e.Z)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.w&&t.h||console.warn("warning: Invalid renderSize width and height passed"),e.next=4,this.renderer;case 4:e.sent.setProperties(t),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in updateInputResolution: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return a.apply(this,arguments)})},{key:"setInput",value:(n=(0,e.Z)(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.renderer;case 3:(r=e.sent).frameBuffer.setInputImage(t),r.frameBuffer.iterations+=1,e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in setInput: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"createCanvas",value:function(e){try{var t=document.createElement("canvas");return t.id=e.id||"canv-"+(0,u.v4)(),t.width=e.w||100,t.height=e.h||100,t}catch(e){throw console.error("Error in canvasConfig: ",e),document.dispatchEvent(this.events.error),e}}}]),r}();n.default={core:f}}(),n.default.core}()}));