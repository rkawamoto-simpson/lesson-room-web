!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.vectorly=t():(e.vectorly=e.vectorly||{},e.vectorly.BackgroundFilter=t())}(self,(function(){return function(){var e={553:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),s=new S(n||[]);return a._invoke=function(e,t,r){var n=h;return function(i,a){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw a;return O()}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var o=x(s,r);if(o){if(o===g)continue;return o}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=l(e,t,r);if("normal"===u.type){if(n=r.done?p:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,s),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",g={};function m(){}function v(){}function y(){}var w={};u(w,a,(function(){return this}));var b=Object.getPrototypeOf,_=b&&b(b(P([])));_&&_!==r&&n.call(_,a)&&(w=_);var E=y.prototype=m.prototype=Object.create(w);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(i,a,s,o){var u=l(e[i],e,a);if("throw"!==u.type){var c=u.arg,h=c.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,o)}))}o(u.arg)}var i;this._invoke=function(e,n){function a(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(a,a):a()}}function x(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,x(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var i=l(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function P(e){if(e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}return{next:O}}function O(){return{value:t,done:!0}}return v.prototype=y,u(E,"constructor",y),u(y,"constructor",v),v.displayName=u(y,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,o,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},T(k.prototype),u(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,r,n,i,a){void 0===a&&(a=Promise);var s=new k(c(t,r,n,i),a);return e.isGeneratorFunction(r)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},T(E),u(E,o,"Generator"),u(E,a,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=P,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return o.type="throw",o.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var s=this.tryEntries[a],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var u=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(u&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var s=a?a.completion:{};return s.type=e,s.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:P(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},757:function(e,t,r){e.exports=r(553)},706:function(e,t,r){"use strict";function n(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function i(){return n()?(self.isWorker=!0,self):(window.isWorker=!1,window)}function a(e){return n()?e instanceof OffscreenCanvasRenderingContext2D:e instanceof CanvasRenderingContext2D}r.d(t,{uL:function(){return u},Th:function(){return o},yb:function(){return s},Hy:function(){return D},ZS:function(){return N}});var s=function(e,t){let r;"string"==typeof e&&(e=document.getElementById(e));let n=1;if("true"===t.use_webgl1?r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}):(r=e.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1}),n=2,r||(n=1,r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}))),r.getExtension("WEBGL_draw_buffers")?r.disable_multi_draw=t.disable_multi_draw||!1:r.disable_multi_draw=!0,r.extensions={},r.getVersion=function(){return n},1===r.getVersion()){if("float32"===t.float_type){if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.FLOAT}else{if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_half_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_half_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.extensions.EXT_FLOAT.HALF_FLOAT_OES}if(!r.disable_multi_draw&&(r.extensions.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),!r.extensions.WEBGL_draw_buffers))throw new Error("Extension not found: WEBGL_draw_buffers")}else{if(r.extensions.EXT_FLOAT=r.getExtension("EXT_color_buffer_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: EXT_color_buffer_float");"float32"===t.float_type?(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.texture_format=r.RGBA32F,r.texture_type=r.FLOAT):(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.texture_format=r.RGBA16F,r.texture_type=r.FLOAT)}return 1===r.getVersion()?(r.getCOLOR_ATTACHMENT=function(e=0){return r.disable_multi_draw?r.COLOR_ATTACHMENT0:r.extensions.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(e)}):(r.getCOLOR_ATTACHMENT=function(e=0){return r.COLOR_ATTACHMENT0+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.drawBuffers(e)}),i().gl=r,r.canvas.w=r.canvas.width,r.canvas.h=r.canvas.height,r.clearCanvas=function(){r.clearColor(0,0,0,1),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)},r.input={h:t.h,w:t.w},r.render_scale={h:1,w:1},r.viewport(0,0,e.width,e.height),r.createAndCompileShader=function(e,t){let n=r.createShader(e);if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(n));return n},r.createAndLinkProgram=function(e,t){let n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,t),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw new Error(r.getProgramInfoLog(n));return n},r.resizeCanvasToDisplaySize=function(t,r){return(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,!0)},r.resizeRenderSize=function(e,t,n){let i=n*r.input.w,a=n*r.input.h;i=e>i?e:i,a=t>a?t:a,r.render_scale={w:e/i,h:t/a},r.resizeCanvasToDisplaySize(i,a)},r.log=function(e){},r},o=class{constructor(e,t,r,n){this.gl=e,this.network=t,this.frameBuffer=r,this.renderSize={w:n.w,h:n.h},this.metrics={"Render Size":this.renderSize,"Original Size":e.input,"Upscale Factor":t.upscaleFactor,FPS:0},this.setProperties(n)}setProperties(e={w:1278,h:720,disableVideoToCanvas:!1}){const t=this;!0!==e.disableVideoToCanvas&&this.frameBuffer.setInputFrameCanvas(),void 0===e.w&&(e.w=this.network.upscaleFactor*this.gl.input.w),void 0===e.h&&(e.h=this.network.upscaleFactor*this.gl.input.h),this.renderSize=e,this.gl.resizeRenderSize(e.w,e.h,this.network.upscaleFactor),null!==this.frameBuffer.inputTex&&setTimeout((()=>{t.network.renderRGB(t.gl.render_scale)})),t.metrics["Render Size"]=e}setInputSize(e={w:426,h:240},t=null){this.gl.input={w:e.w,h:e.h},this.network.resetTextureBuffers(),this.setProperties(t||this.renderSize)}async resetNetwork(e){this.frameBuffer.clearall(),this.network=await async function(e={name:"",version:"",tag:"",token:""},t,r){let n=null,i=null;try{i=await N(e.name,e.tag,e.version,e.token)}catch(e){throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error(e)}if(!i)throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error("");try{const a=D(e.name,e.token);n=await a,n=new n(t,r,i)}catch(e){throw console.error("%cNetwork load failed:","background:black; color: yellow"),new Error(e)}return n}({name:e.name,version:e.version,tag:e.tag},this.gl,this.network.frameBuffer),this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl,this.setProperties(this.renderSize)}changeNetwork(e){this.network=e,this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl}async loadBitmap(e){const t=this.frameBuffer;this.network,t.setInputImage(e),await this.render()}loadImage(e){const t=new Image;t.src=e;const r=this.frameBuffer,n=this,i=this.network;t.onload=async function(){r.setInputImage(t),await n.render(),i.getImageBytes()}}async render(e){const t=this.gl,r=this.network;t.clearColor(0,0,0,1),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),r.initialized&&await r.initialized,await r.feedForward(t.render_scale,e),t.flush()}},u=class{constructor(e){this.gl=e,this.iterations=0,this.textures=[{},{}],this.frame_buffers=[{},{}],this.inputTex=null,this.inputCanvas=null,this.frame_difference=0}drawToCanvas(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}setBuffer(e){const t=this.gl,r=this.iterations%2*this.frame_difference;t.bindFramebuffer(t.FRAMEBUFFER,this.frame_buffers[r][e])}setInputFrameCanvas(){i(),a(this.inputCanvas)||(this.inputCanvas=function(e,t){if(n())return new OffscreenCanvas(e,t);{const r=document.createElement("canvas");return r.width=e,r.height=t,r}}(this.gl.input.w,this.gl.input.h).getContext("2d")),this.inputCanvas.canvas.width=this.gl.input.w,this.inputCanvas.canvas.height=this.gl.input.h}videoToCanvas(e){return this.inputCanvas.drawImage(e,0,0,this.gl.input.w,this.gl.input.h),this.inputCanvas.canvas}getInputTexture(){const e=this.gl;if(null===this.inputTex){let t=e.createTexture();this.inputTex=this._setTextureSize(t,e.input.w,e.input.h)}return this.inputTex}setInputImage(e){this.input=e;const t=this.gl;a(this.inputCanvas)&&1===t.getVersion()&&(e=this.videoToCanvas(e));let r=this.getInputTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.texture_format,t.RGBA,t.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e].INPUT=[r]}setImageAsTexture(e,t){const r=this.gl;let n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.texture_format,r.RGBA,r.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e][t]=[n]}createBufferWithTextures(e,t,r=1,n=null){const i=this.gl;for(let a=0;a<=this.frame_difference;a++){const s=i.createFramebuffer();this.frame_buffers[a][e]=s,i.bindFramebuffer(i.FRAMEBUFFER,s);const o=[];this.textures[a][e]=null;for(let e=0;e<t;++e){let t=this.createAndSetupTexture(n);t=this._setTextureSize(t,i.input.w*r,i.input.h*r),o.push(t),i.bindTexture(i.TEXTURE_2D,t),i.texImage2D(i.TEXTURE_2D,0,i.texture_format,i.input.w*r,i.input.h*r,0,i.RGBA,i.texture_type,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.getCOLOR_ATTACHMENT(e),i.TEXTURE_2D,t,0)}this.textures[a][e]=o}}createBufferWithTextures2(e,t,r,n,i={}){const a=this.gl;if(r<=0||n<=0)throw new Error("Texture width and height must be greater than 0");let s=i.format||a.RGBA,o=i.minFilter||a.NEAREST,u=i.magFilter||a.NEAREST,c=i.type||a.texture_type||a.UNSIGNED_BYTE,l=i.internalFormat||a.texture_format||a.RGBA;for(let i=0;i<=this.frame_difference;i++){const h=a.createFramebuffer();this.frame_buffers[i][e]=h,a.bindFramebuffer(a.FRAMEBUFFER,h);const f=[];this.textures[i][e]=null;for(let e=0;e<t;++e){let t;1===a.getVersion()?t=this.createTexture_webgl1(l,r,n,s,c,o,u):(l===a.RGBA&&(l=a.RGBA8),t=this.createTexture_webgl2(l,r,n,o,u)),a.framebufferTexture2D(a.FRAMEBUFFER,a.getCOLOR_ATTACHMENT(e),a.TEXTURE_2D,t,0),f.push(t)}this.textures[i][e]=f}}getTextureSize(e,t=0,r=0){if(!this.textures[t][e][r])throw new Error(`Failed to get resolution of textures for layer: ${e} at index: ${index}`);return this.textures[t][e][r].size}createTexture_webgl2(e,t,r,n,i){n=n||gl.NEAREST,i=i||gl.NEAREST,e=e||gl.texture_format||gl.RGBA;let a=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,n),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,i),gl.texStorage2D(gl.TEXTURE_2D,1,e,t,r),a=this._setTextureSize(a,t,r),a}createTexture_webgl1(e,t,r,n,i,a,s){n=n||gl.RGBA,a=a||gl.NEAREST,s=s||gl.NEAREST,i=i||gl.texture_type||gl.UNSIGNED_BYTE,e=e||gl.texture_format||gl.RGBA;let o=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,s),gl.texImage2D(gl.TEXTURE_2D,0,e,t,r,0,n,i,null),o=this._setTextureSize(o,t,r),o}createFloatTextureFromArrayBuffer(e,t,r,n,i,a,s,o){a=a||gl.RGBA,s=s||gl.NEAREST,o=o||gl.NEAREST,i=i||gl.texture_type||gl.UNSIGNED_BYTE,t=t||gl.texture_format||gl.RGBA;const u=new Float32Array(e);let c=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,o),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32F,r,n,0,gl.RGBA,gl.FLOAT,u),c=this._setTextureSize(c,r,n),c}_setTextureSize(e,t,r){return t>0&&r>0&&(e.size={},e.size.width=t,e.size.height=r),e}setBufferForLayer(e,t){for(let r=0;r<=this.frame_difference;r++){const n=gl.createFramebuffer();this.frame_buffers[r][e]=n,gl.bindFramebuffer(gl.FRAMEBUFFER,n);for(let e=0;e<t.length;e++)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.getCOLOR_ATTACHMENT(e),gl.TEXTURE_2D,t[e],0);this.textures[r][e]=t}}getTexture(e){const t=this.iterations%2*this.frame_difference;return this.textures[t][e]}getLastFrameTexture(e){const t=1-this.iterations%2;return this.textures[t][e]}clearall(){Object.keys(this.textures[0]).forEach((e=>{for(let t=0;t<=this.frame_difference;t++){this.gl.deleteFramebuffer(this.frame_buffers[t][e]),this.frame_buffers[t][e]=null;for(let r=0;r<this.textures[t][e].length;++r)this.gl.deleteTexture(this.textures[t][e][r]),this.textures[t][e][r]=null}})),this.gl.deleteTexture(this.inputTex),this.inputTex=null,this.inputCanvas=null,this.frame_buffers=[{},{}],this.textures=[{},{}],this.gl.clearCanvas()}createAndSetupTexture(e=null){const t=this.gl;t.extensions.EXT_FLOAT_LINEAR||(e=null),null===e&&(e=t.NEAREST);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}};r(435);var c=r(618),l=r(443),h=r.n(l),f=r(595),d=r.n(f),p="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==p&&p,g="URLSearchParams"in p,m="Symbol"in p&&"iterator"in Symbol,v="FileReader"in p&&"Blob"in p&&function(){try{return new Blob,!0}catch(e){return!1}}(),y="FormData"in p,w="ArrayBuffer"in p;if(w)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(e){return e&&b.indexOf(Object.prototype.toString.call(e))>-1};function E(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function T(e){return"string"!=typeof e&&(e=String(e)),e}function k(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return m&&(t[Symbol.iterator]=function(){return t}),t}function x(e){this.map={},e instanceof x?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function R(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function A(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function S(e){var t=new FileReader,r=A(t);return t.readAsArrayBuffer(e),r}function P(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function O(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:v&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:y&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:g&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():w&&v&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=P(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):w&&(ArrayBuffer.prototype.isPrototypeOf(e)||_(e))?this._bodyArrayBuffer=P(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v&&(this.blob=function(){var e=R(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?R(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(S)}),this.text=function(){var e,t,r,n=R(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=A(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y&&(this.formData=function(){return this.text().then(C)}),this.json=function(){return this.text().then(JSON.parse)},this}x.prototype.append=function(e,t){e=E(e),t=T(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},x.prototype.delete=function(e){delete this.map[E(e)]},x.prototype.get=function(e){return e=E(e),this.has(e)?this.map[e]:null},x.prototype.has=function(e){return this.map.hasOwnProperty(E(e))},x.prototype.set=function(e,t){this.map[E(e)]=T(t)},x.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},x.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),k(e)},x.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),k(e)},x.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),k(e)},m&&(x.prototype[Symbol.iterator]=x.prototype.entries);var I=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function F(e,t){if(!(this instanceof F))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,i=(t=t||{}).body;if(e instanceof F){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new x(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new x(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),I.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;a.test(this.url)?this.url=this.url.replace(a,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function C(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function L(e,t){if(!(this instanceof L))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new x(t.headers),this.url=t.url||"",this._initBody(e)}F.prototype.clone=function(){return new F(this,{body:this._bodyInit})},O.call(F.prototype),O.call(L.prototype),L.prototype.clone=function(){return new L(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new x(this.headers),url:this.url})},L.error=function(){var e=new L(null,{status:0,statusText:""});return e.type="error",e};var B=[301,302,303,307,308];L.redirect=function(e,t){if(-1===B.indexOf(t))throw new RangeError("Invalid status code");return new L(null,{status:t,headers:{location:e}})};var M=p.DOMException;try{new M}catch(e){(M=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),M.prototype.constructor=M}function U(e,t){return new Promise((function(r,n){var i=new F(e,t);if(i.signal&&i.signal.aborted)return n(new M("Aborted","AbortError"));var a=new XMLHttpRequest;function s(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new x,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;setTimeout((function(){r(new L(i,n))}),0)},a.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){n(new M("Aborted","AbortError"))}),0)},a.open(i.method,function(e){try{return""===e&&p.location.href?p.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&(v?a.responseType="blob":w&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof x?i.headers.forEach((function(e,t){a.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){a.setRequestHeader(e,T(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",s),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",s)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}U.polyfill=!0,p.fetch||(p.fetch=U,p.Headers=x,p.Request=F,p.Response=L);const z=i();let D=async(e,t={})=>{let n,i=((t=t||{}).path||r.p)+`models/${e}.js`;var a;return t.token&&(i=i+"?"+t.token),z.vectorlyBasePath=t.path||r.p,"background_selfie"===e&&(n=(async()=>{let e;if(z.tflite)e=z.tflite;else{let t=z.vectorlyBasePath||"";try{if(!0!==c.feature.simd)throw new Error("SIMD feature check is false");e=await h()({basePath:t})}catch(r){e=await d()({basePath:t})}}return e})()),z.isWorker?importScripts(i):await(a=i,new Promise(((e,t)=>{const r="$importModule$"+Math.random().toString(32).slice(2),n=document.createElement("script"),i=()=>{delete window[r],n.onerror=null,n.onload=null,n.remove(),URL.revokeObjectURL(n.src),n.src=""};n.defer="defer",n.type="module",n.onerror=()=>{t(new Error(`Failed to import: ${a}`)),i()},n.onload=()=>{e(window[r]),i()};const s=function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(a),o=new Blob([`import * as m from "${s}"; window.${r} = m;`],{type:"text/javascript"});n.src=URL.createObjectURL(o),document.head.appendChild(n)}))),"background_selfie"===e&&(z.tflite=await n),z.vectorly.models[e]},N=async(e,t,n,i)=>{if(i=i||{},"background_selfie"===e){let a=(i.path||r.p)+`./data/${e}/${t}_v${n}.tflite`;i.token&&(a=a+"?"+i.token);const s=await fetch(a);if(!s.ok)throw Error(`Response fetching "${a}": ${s.statusText}`);return{model:await s.arrayBuffer()}}if("background_webgl2"===e||"background_webgl"===e||"background_webgl_unet"===e){let a=(i.path||r.p)+`./data/${e}/${t}_v${n}.json`,s=(i.path||r.p)+`./data/${e}/${t}_v${n}.weights`;i.token&&(a+="?"+i.token,s+="?"+i.token);const[o,u]=await Promise.all([fetch(a),fetch(s)]),[c,l]=await Promise.all([o.json(),u.arrayBuffer()]),h=JSON.parse(JSON.stringify(c)),f=new Float32Array(l),d=Object.keys(c),p=["weights","biases"];c[d[0]].debugImage&&p.push("debugImage");for(let e of d)for(let t of p){let[r,n]=c[e][t];h[e][t]=f.slice(n,n+r)}return h}{let a=(i.path||r.p)+`./data/${e}/${t}_v${n}.json`;i.token&&(a=a+"?"+i.token);const s=await fetch(a);return await s.json()}}},435:function(e){e.exports=["cnn_demo","residual_3k_3x","residual_4k_2x","residual_5k_2x","residual_5k_3x","denoise_10k_1x","background_selfie","background_webgl_unet","background_webgl","background_webgl2","upscaler_4krgb_2x"]},443:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,t){r=e,n=t}));var a,s={};for(a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);var o,u,c,l=[],h="./this.program",f=function(e,t){throw t};o="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var d,p,g="";(o||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var m,v=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);s=null,i.arguments&&(l=i.arguments),i.thisProgram&&(h=i.thisProgram),i.quit&&(f=i.quit),i.wasmBinary&&(m=i.wasmBinary);var w,b=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&U("no native wasm support detected");var _,E,T,k,x=!1,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&R)return R.decode(e.subarray(t,i));for(var a="";t<i;){var s=e[t++];if(128&s){var o=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|u:(7&s)<<18|o<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(s);else{var c=s-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&s)<<6|o)}else a+=String.fromCharCode(s)}return a}function S(e){_=e,i.HEAP8=E=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=k=new Int32Array(e),i.HEAPU8=T=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var P,O=[],I=[],F=[],C=[];I.push({func:function(){Q()}});var L=0,B=null,M=null;function U(e){i.onAbort&&i.onAbort(e),y(e+=""),x=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function z(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function D(e){return z(e,"data:application/octet-stream;base64,")}function N(e){return z(e,"file://")}i.preloadedImages={},i.preloadedAudios={};var j,H,W="./tflite/tflite-simd.wasm";function G(e){try{if(e==W&&m)return new Uint8Array(m);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){U(e)}}function X(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?P.get(r)():P.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(i)}}function q(e){return k[ee()>>2]=e,e}function V(e){try{return w.grow(e-_.byteLength+65535>>>16),S(w.buffer),1}catch(e){}}D(W)||(j=W,W=i.locateFile?i.locateFile(j,g):(g=i.basePath||g)+j),H=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Z={};function $(){if(!$.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:h||"./this.program"};for(var t in Z)e[t]=Z[t];var r=[];for(var t in e)r.push(t+"="+e[t]);$.strings=r}return $.strings}var Y,K={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=K.buffers[e];0===t||10===t?((1===e?v:y)(A(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return K.varargs+=4,k[K.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?A(T,e,void 0):""}(e);return t},get64:function(e,t){return e}},J={a:function(){U()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return q(28),-1;r=H()}return k[t>>2]=r/1e3|0,k[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){U("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){U("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){T.copyWithin(e,t,t+r)},m:function(e){var t,r=T.length,n=2147483648;if(e>n)return!1;for(var i=1;i<=4;i*=2){var a=r*(1+.2/i);if(a=Math.min(a,e+100663296),V(Math.min(n,((t=Math.max(e,a))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=H();H()-t<e;);},p:function(e,t){var r=0;return $().forEach((function(n,i){var a=t+r;k[e+4*i>>2]=a,function(e,t,r){for(var n=0;n<e.length;++n)E[t++>>0]=e.charCodeAt(n);E[t>>0]=0}(n,a),r+=n.length+1})),0},g:function(e,t){var r=$();k[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),k[t>>2]=n,0},j:function(e){!function(e,t){b||(i.onExit&&i.onExit(e),x=!0),f(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,i){},c:function(e,t,r,n){for(var i=0,a=0;a<r;a++){for(var s=k[t+8*a>>2],o=k[t+(8*a+4)>>2],u=0;u<o;u++)K.printChar(e,T[s+u]);i+=o}return k[n>>2]=i,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return q(28),-1}},Q=(function(){var e={a:J};function t(e,t){var r=e.exports;i.asm=r,S((w=i.asm.q).buffer),P=i.asm.D,function(e){if(L--,i.monitorRunDependencies&&i.monitorRunDependencies(L),0==L&&(null!==B&&(clearInterval(B),B=null),M)){var t=M;M=null,t()}}()}function r(e){t(e.instance)}function a(t){return function(){if(!m&&(o||u)){if("function"==typeof fetch&&!N(W))return fetch(W,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+W+"'";return e.arrayBuffer()})).catch((function(){return G(W)}));if(d)return new Promise((function(e,t){d(W,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return G(W)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),U(e)}))}if(L++,i.monitorRunDependencies&&i.monitorRunDependencies(L),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}(m||"function"!=typeof WebAssembly.instantiateStreaming||D(W)||N(W)||"function"!=typeof fetch?a(r):fetch(W,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(Q=i.___wasm_call_ctors=i.asm.r).apply(null,arguments)}),ee=(i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getInputHeight=function(){return(i._getInputHeight=i.asm.u).apply(null,arguments)},i._getInputWidth=function(){return(i._getInputWidth=i.asm.v).apply(null,arguments)},i._getInputChannelCount=function(){return(i._getInputChannelCount=i.asm.w).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.x).apply(null,arguments)},i._getOutputHeight=function(){return(i._getOutputHeight=i.asm.y).apply(null,arguments)},i._getOutputWidth=function(){return(i._getOutputWidth=i.asm.z).apply(null,arguments)},i._getOutputChannelCount=function(){return(i._getOutputChannelCount=i.asm.A).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.B).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.C).apply(null,arguments)},i.___errno_location=function(){return(ee=i.___errno_location=i.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,i.calledRun=!0,x||(X(I),X(F),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),C.unshift(e);var e;X(C)}()))}e=e||l,L>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),O.unshift(e);var e;X(O)}(),L>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(M=function e(){Y||re(),Y||(M=e)},i.run=re,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return re(),e.ready});e.exports=r},595:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,t){r=e,n=t}));var a,s={};for(a in i)i.hasOwnProperty(a)&&(s[a]=i[a]);var o,u,c,l=[],h="./this.program",f=function(e,t){throw t};o="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var d,p,g="";(o||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var m,v=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);for(a in s)s.hasOwnProperty(a)&&(i[a]=s[a]);s=null,i.arguments&&(l=i.arguments),i.thisProgram&&(h=i.thisProgram),i.quit&&(f=i.quit),i.wasmBinary&&(m=i.wasmBinary);var w,b=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&U("no native wasm support detected");var _,E,T,k,x=!1,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function A(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&R)return R.decode(e.subarray(t,i));for(var a="";t<i;){var s=e[t++];if(128&s){var o=63&e[t++];if(192!=(224&s)){var u=63&e[t++];if((s=224==(240&s)?(15&s)<<12|o<<6|u:(7&s)<<18|o<<12|u<<6|63&e[t++])<65536)a+=String.fromCharCode(s);else{var c=s-65536;a+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else a+=String.fromCharCode((31&s)<<6|o)}else a+=String.fromCharCode(s)}return a}function S(e){_=e,i.HEAP8=E=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=k=new Int32Array(e),i.HEAPU8=T=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var P,O=[],I=[],F=[],C=[];I.push({func:function(){Q()}});var L=0,B=null,M=null;function U(e){i.onAbort&&i.onAbort(e),y(e+=""),x=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function z(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function D(e){return z(e,"data:application/octet-stream;base64,")}function N(e){return z(e,"file://")}i.preloadedImages={},i.preloadedAudios={};var j,H,W="./tflite/tflite.wasm";function G(e){try{if(e==W&&m)return new Uint8Array(m);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){U(e)}}function X(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?P.get(r)():P.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(i)}}function q(e){return k[ee()>>2]=e,e}function V(e){try{return w.grow(e-_.byteLength+65535>>>16),S(w.buffer),1}catch(e){}}D(W)||(j=W,W=i.locateFile?i.locateFile(j,g):(g=i.basePath||g)+j),H=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Z={};function $(){if(!$.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:h||"./this.program"};for(var t in Z)e[t]=Z[t];var r=[];for(var t in e)r.push(t+"="+e[t]);$.strings=r}return $.strings}var Y,K={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=K.buffers[e];0===t||10===t?((1===e?v:y)(A(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return K.varargs+=4,k[K.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?A(T,e,void 0):""}(e);return t},get64:function(e,t){return e}},J={a:function(){U()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return q(28),-1;r=H()}return k[t>>2]=r/1e3|0,k[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){U("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){U("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){T.copyWithin(e,t,t+r)},m:function(e){var t,r=T.length,n=2147483648;if(e>n)return!1;for(var i=1;i<=4;i*=2){var a=r*(1+.2/i);if(a=Math.min(a,e+100663296),V(Math.min(n,((t=Math.max(e,a))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=H();H()-t<e;);},p:function(e,t){var r=0;return $().forEach((function(n,i){var a=t+r;k[e+4*i>>2]=a,function(e,t,r){for(var n=0;n<e.length;++n)E[t++>>0]=e.charCodeAt(n);E[t>>0]=0}(n,a),r+=n.length+1})),0},g:function(e,t){var r=$();k[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),k[t>>2]=n,0},j:function(e){!function(e,t){b||(i.onExit&&i.onExit(e),x=!0),f(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,i){},c:function(e,t,r,n){for(var i=0,a=0;a<r;a++){for(var s=k[t+8*a>>2],o=k[t+(8*a+4)>>2],u=0;u<o;u++)K.printChar(e,T[s+u]);i+=o}return k[n>>2]=i,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return q(28),-1}},Q=(function(){var e={a:J};function t(e,t){var r=e.exports;i.asm=r,S((w=i.asm.q).buffer),P=i.asm.D,function(e){if(L--,i.monitorRunDependencies&&i.monitorRunDependencies(L),0==L&&(null!==B&&(clearInterval(B),B=null),M)){var t=M;M=null,t()}}()}function r(e){t(e.instance)}function a(t){return function(){if(!m&&(o||u)){if("function"==typeof fetch&&!N(W))return fetch(W,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+W+"'";return e.arrayBuffer()})).catch((function(){return G(W)}));if(d)return new Promise((function(e,t){d(W,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return G(W)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),U(e)}))}if(L++,i.monitorRunDependencies&&i.monitorRunDependencies(L),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}(m||"function"!=typeof WebAssembly.instantiateStreaming||D(W)||N(W)||"function"!=typeof fetch?a(r):fetch(W,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(Q=i.___wasm_call_ctors=i.asm.r).apply(null,arguments)}),ee=(i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getInputHeight=function(){return(i._getInputHeight=i.asm.u).apply(null,arguments)},i._getInputWidth=function(){return(i._getInputWidth=i.asm.v).apply(null,arguments)},i._getInputChannelCount=function(){return(i._getInputChannelCount=i.asm.w).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.x).apply(null,arguments)},i._getOutputHeight=function(){return(i._getOutputHeight=i.asm.y).apply(null,arguments)},i._getOutputWidth=function(){return(i._getOutputWidth=i.asm.z).apply(null,arguments)},i._getOutputChannelCount=function(){return(i._getOutputChannelCount=i.asm.A).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.B).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.C).apply(null,arguments)},i.___errno_location=function(){return(ee=i.___errno_location=i.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,i.calledRun=!0,x||(X(I),X(F),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),C.unshift(e);var e;X(C)}()))}e=e||l,L>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),O.unshift(e);var e;X(O)}(),L>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(M=function e(){Y||re(),Y||(M=e)},i.run=re,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return re(),e.ready});e.exports=r},245:function(e,t,r){"use strict";r.d(t,{$A:function(){return T},$_:function(){return A},PD:function(){return E},EK:function(){return P},Gb:function(){return b},Zq:function(){return y},po:function(){return x}});var n=r(861),i=r(757),a=r.n(i),s=r(877);function o(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(e){a(e)}}function o(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))}const u=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","radeon r9 200","sgx 543","sgx543"],c=e=>e.toLowerCase().replace(/^angle ?\((.+)\)*$/,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,""),l="undefined"==typeof window,h=(()=>{if(l)return;const{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,n=/(iphone|ipod|ipad)/i.test(e),i="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:i,isMobile:/android/i.test(e)||n||i,isSafari12:/Version\/12.+Safari/.test(e)}})(),f=[],d=[],p=(e,t)=>{if(e===t)return 0;const r=e;e.length>t.length&&(e=t,t=r);let n=e.length,i=t.length;for(;n>0&&e.charCodeAt(~-n)===t.charCodeAt(~-i);)n--,i--;let a,s=0;for(;s<n&&e.charCodeAt(s)===t.charCodeAt(s);)s++;if(n-=s,i-=s,0===n)return i;let o,u,c=0,l=0,h=0;for(;l<n;)d[l]=e.charCodeAt(s+l),f[l]=++l;for(;h<i;)for(a=t.charCodeAt(s+h),o=h++,c=h,l=0;l<n;l++)u=a===d[l]?o:o+1,o=f[l],c=f[l]=o>c?u>c?c+1:u:u>o?o+1:u;return c},g=({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:n,failIfMajorPerformanceCaveat:i=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@3.1.27/dist/benchmarks"}={})=>o(void 0,void 0,void 0,(function*(){const s={};if(l)return{tier:0,type:"SSR"};const{isIpad:f=!!(null==h?void 0:h.isIpad),isMobile:d=!!(null==h?void 0:h.isMobile),screenSize:g=window.screen,loadBenchmarks:m=(e=>o(void 0,void 0,void 0,(function*(){const t=yield fetch(`${a}/${e}`).then((e=>e.json()));return t.shift(),t})))}=r;let{renderer:v}=r;const y=(e,t,r,n,i)=>({device:i,fps:n,gpu:r,isMobile:d,tier:e,type:t});let w,b="";if(v)v=c(v),w=[v];else{const e=n||((e,t=!1)=>{const r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;const n=window.document.createElement("canvas"),i=n.getContext("webgl",r)||n.getContext("experimental-webgl",r);return null!=i?i:void 0})(null==h?void 0:h.isSafari12,i);if(!e)return y(0,"WEBGL_UNSUPPORTED");const t=e.getExtension("WEBGL_debug_renderer_info");if(t&&(v=e.getParameter(t.UNMASKED_RENDERER_WEBGL)),!v)return y(1,"FALLBACK");b=v,v=c(v),w=((e,t,r)=>"apple gpu"===t?((e,t,r)=>{let n=[t];if(r){const t="\n      precision highp float;\n      attribute vec3 aPosition;\n      varying float vvv;\n      void main() {\n        vvv = 0.31622776601683794;\n        gl_Position = vec4(aPosition, 1.0);\n      }\n    ",r="\n      precision highp float;\n      varying float vvv;\n      void main() {\n        vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n        enc = fract(enc);\n        enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n        gl_FragColor = enc;\n      }\n    ",i=e.createShader(35633),a=e.createShader(35632),s=e.createProgram();if(a&&i&&s){e.shaderSource(i,t),e.shaderSource(a,r),e.compileShader(i),e.compileShader(a),e.attachShader(s,i),e.attachShader(s,a),e.linkProgram(s),e.detachShader(s,i),e.detachShader(s,a),e.deleteShader(i),e.deleteShader(a),e.useProgram(s);const o=e.createBuffer();e.bindBuffer(34962,o),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);const u=e.getAttribLocation(s,"aPosition");e.vertexAttribPointer(u,3,5126,!1,0,0),e.enableVertexAttribArray(u),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);const c=new Uint8Array(4);e.readPixels(0,0,1,1,6408,5121,c),e.deleteProgram(s),e.deleteBuffer(o),n={801621810:(null==h?void 0:h.isIpad)?["apple a12x gpu"]:["apple a11 gpu","apple a12 gpu","apple a13 gpu","apple a14 gpu"],8016218135:(null==h?void 0:h.isIpad)?["apple a9x gpu","apple a10 gpu","apple a10x gpu"]:["apple a9 gpu","apple a10 gpu"]}[c.join("")]||n}}return n})(e,t,r):[t])(e,v,d)}const _=(yield Promise.all(w.map((e=>o(void 0,void 0,void 0,(function*(){const t=(e=>{const t=d?["adreno","apple","mali-t","mali","nvidia","powervr"]:["intel","amd","radeon","nvidia","geforce"];for(const r of t)if(e.includes(r))return r})(e);if(!t)return;const r=`${d?"m":"d"}-${t}.json`,n=s[r]=s[r]||m(r);let i;try{i=yield n}catch(t){return}const a=(e=>{var t;const r=(e=e.replace(/\([^)]+\)/,"")).match(/\d+/)||e.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g);return null!==(t=null==r?void 0:r.join("").replace(/\W|amd/g,""))&&void 0!==t?t:""})(e),o="apple"===t;let u=i.filter((([,e])=>e===a));u.length||(u=i.filter((([t])=>t.includes(e))));const c=u.length;if(0===c)return;let l,[h,,,v]=c>1?u.map((t=>[t,p(e,t[0])])).sort((([,e],[,t])=>e-t))[0][0]:u[0],y=Number.MAX_VALUE;const{devicePixelRatio:w}=window,b=g.width*w*(g.height*w);o&&d&&(v=v.filter((([,,,e])=>{var t;return(null!==(t=null==e?void 0:e.indexOf(f?"ipad":"iphone"))&&void 0!==t?t:-1)>-1})));for(const e of v){const[t,r]=e,n=t*r,i=Math.abs(b-n);i<y&&(y=i,l=e)}if(!l)return;const[,,_,E]=l;return[y,_,h,E]})))))).filter((e=>!!e));if(!_.length){const e=u.find((e=>v.includes(e)));return e?y(0,"BLOCKLISTED",e):y(1,"FALLBACK",`${v} (${b})`)}const[,E,T,k]=_.sort((([e=Number.MAX_VALUE],[t=Number.MAX_VALUE])=>e-t))[0];if(-1===E)return y(0,"BLOCKLISTED",T,E,k);const x=d?e:t;let R=0;for(let e=0;e<x.length;e++)E>=x[e]&&(R=e);return y(R,"BENCHMARK",T,E,k)}));var m=r(618),v=r(161);function y(e){return w.apply(this,arguments)}function w(){return w=(0,n.Z)(a().mark((function e(t){var n,i=arguments;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==(i.length>1&&void 0!==i[1]&&i[1])){e.next=6;break}return e.next=4,Promise.resolve().then(r.bind(r,841));case 4:return n=e.sent,e.abrupt("return",n.default.core);case 6:if(!0!==t){e.next=13;break}return e.next=9,Promise.resolve().then(r.bind(r,886));case 9:case 15:return n=e.sent,e.abrupt("return",n.default);case 13:return e.next=15,Promise.resolve().then(r.bind(r,296));case 17:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function b(){return _.apply(this,arguments)}function _(){return(_=(0,n.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t={}).wasm=m.support(),t.simd=m.feature.simd,t.webgl=(0,v.HR)(),t.webgl2=(0,v.W8)(),t.offscreen=Boolean(HTMLCanvasElement.prototype.transferControlToOffscreen),e.next=8,g();case 8:if(t.gpu=e.sent,t.gpu.hwaccel=t.gpu.tier>0,t.wasm&&t.webgl){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){if("selfie"===e)return{name:"background_selfie",tag:"general",version:"0"};if("selfie_v2"===e)return{name:"background_selfie",tag:"general",version:"1"};if("webgl_unet"===e)return{name:"background_webgl_unet",tag:"general",version:"2"};if("webgl"===e)return{name:"background_webgl",tag:"general",version:"1"};if("webgl_v2"===e)return{name:"background_webgl2",tag:"general",version:"1"};throw new Error("params.model passed is invalid",e)}function T(e){return k.apply(this,arguments)}function k(){return(k=(0,n.Z)(a().mark((function e(t){var r,n,i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b();case 2:if(r=e.sent,"selfie"!==t&&"selfie_v2"!==t){e.next=8;break}return n=r.wasm&&(r.webgl||r.webgl2),e.abrupt("return",n);case 8:if("webgl_unet"!==t&&"webgl"!==t&&"webgl_v2"!==t){e.next=13;break}return i=r.webgl2,e.abrupt("return",i);case 13:throw new Error("params.model passed is invalid",t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return R.apply(this,arguments)}function R(){return R=(0,n.Z)(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e,t,r){if("string"==typeof r){var n=document.createElement("img");return n.crossOrigin="anonymous",n.addEventListener("load",(function(){e(n)})),n.src&&n.complete?n.complete&&e(n):n.src=r,{img:n,src:r}}if(r instanceof HTMLImageElement){var i=r,a=r.src;return i.addEventListener("load",(function(){e(i)})),i.complete?0===i.naturalWidth?t("Image is empty"):e(i):i.src=r,{img:i,src:a}}},e.abrupt("return",new Promise((function(e,n){r(e,n,t)})));case 2:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}function A(e){return S.apply(this,arguments)}function S(){return S=(0,n.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){function i(e,t){return o.apply(this,arguments)}function o(){return o=(0,n.Z)(a().mark((function e(t,r){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||720,r=r||"https://cdn.vectorly.io/public-demos/videocall-720p.jpg",e.abrupt("return",new Promise((function(e){var n=document.createElement("img");n.display="none",n.crossOrigin="anonymous",n.onload=function(){var r=t*n.naturalWidth/n.naturalHeight;createImageBitmap(n,{resizeWidth:r,resizeHeight:t,resizeQuality:"high"}).then((function(t){e({img:n,imgBmp:t})})).catch((function(t){console.warn(t),createImageBitmap(n).then((function(t){e({img:n,imgBmp:t})}))}))},n.src=r})));case 3:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function u(){return u=(0,n.Z)(a().mark((function n(){var o,u,c,l,h,f,d,p,g,m,v;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=Number(t.timeout)||2e3,u=Number(t.height)||720,c=b(),l=c&&c.offscreen,n.next=6,y(l);case 6:return h=n.sent,n.next=9,i(u);case 9:return f=n.sent,d=f.img,p=f.imgBmp,g=new h(d,{stream:p,token:t.token,id:(0,s.v4)(),networkParams:E(t.model||"selfie"),networkOptions:{background:{type:"blur",radius:5}},renderSize:{w:p.width,h:p.height},debug:!1,debugRender:!1,container:"disable",serverType:t.serverType,enabled:!1,reqHandle:{useRAF:!0}}),n.next=15,g.initialized;case 15:if(n.sent){n.next=20;break}return console.log("Error in initialization"),r(g.error),n.abrupt("return");case 20:g.canvas.style.visibility="hidden",console.log("processor is initialized"),g.on("start",(function(){m=Date.now()})),g.on("stop",(function(){v=Date.now(),console.log("Metrics",g.metrics),console.log("time diff",m,v,v-m),e({inputSize:"".concat(p.width,"x").concat(p.height),frameCount:g.metrics.frameCount,time:v-m,fps:g.metrics.frameCount/(v-m)*1e3})})),g.on("error",(function(e){console.error("error",e),r(e)})),g.enable(),setTimeout((function(){g.disable(),d.style.visibility="hidden"}),o);case 27:case"end":return n.stop()}}),n)}))),u.apply(this,arguments)}t=t||{};try{!function(){u.apply(this,arguments)}()}catch(e){console.log("HIGH LEVEL ERROR",e),r(e)}})));case 1:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}function P(e,t){if(!b())throw new Error("Browser not supported");if(e&&!(e instanceof MediaStream||e instanceof MediaStreamTrack||e instanceof HTMLVideoElement))throw new TypeError("Input is not a MediaStream, MediaStreamTrack or HTML5 Video Element. See https://cdn.vectorly.io/ai-filters/docs/latest/BackgroundFilter.html for proper setup instructions");if(!t.token)throw new Error("Vectorly token not defined. Please check https://cdn.vectorly.io/ai-filters/docs/latest/BackgroundFilter.html for proper setup instructions");if("string"!=typeof t.token)throw new Error("Token parameter is not a string. Please check https://cdn.vectorly.io/ai-filters/docs/latest/BackgroundFilter.html for proper setup instructions");if(void 0!==t.background&&"string"!=typeof t.background&&![HTMLImageElement,HTMLVideoElement,ImageBitmap,ImageData,HTMLCanvasElement].some((function(e){return t.background instanceof e})))throw new TypeError("Background is not a valid type (Image / Video / Bitmap / Canvas etc...) See https://cdn.vectorly.io/ai-filters/docs/latest/BackgroundFilter.html for proper setup instructions")}},886:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return T}});var n=r(861),i=r(942),a=r(671),s=r(144),o=r(757),u=r.n(o),c=r(885),l=r(877),h=r(55),f=r(477),d=r.n(f);function p(){return d()('!function(){var e={553:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var a=t&&t.prototype instanceof m?t:m,o=Object.create(a.prototype),i=new I(n||[]);return o._invoke=function(e,t,r){var n=l;return function(a,o){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===a)throw o;return P()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var s=A(i,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=f(e,t,r);if("normal"===u.type){if(n=r.done?d:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(e,r,i),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l="suspendedStart",h="suspendedYield",p="executing",d="completed",g={};function m(){}function y(){}function _(){}var w={};u(w,o,(function(){return this}));var E=Object.getPrototypeOf,T=E&&E(E(S([])));T&&T!==r&&n.call(T,o)&&(w=T);var b=_.prototype=m.prototype=Object.create(w);function v(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(a,o,i,s){var u=f(e[a],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,i,s)}),(function(e){r("throw",e,i,s)})):t.resolve(l).then((function(e){c.value=e,i(c)}),(function(e){return r("throw",e,i,s)}))}s(u.arg)}var a;this._invoke=function(e,n){function o(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(o,o):o()}}function A(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method))return g;r.method="throw",r.arg=new TypeError("The iterator does not provide a \'throw\' method")}return g}var a=f(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function S(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function r(){for(;++a<e.length;)if(n.call(e,a))return r.value=e[a],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}return{next:P}}function P(){return{value:t,done:!0}}return y.prototype=_,u(b,"constructor",_),u(_,"constructor",y),y.displayName=u(_,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u(e,s,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},v(x.prototype),u(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,a,o){void 0===o&&(o=Promise);var i=new x(c(t,r,n,a),o);return e.isGeneratorFunction(r)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},v(b),u(b,s,"Generator"),u(b,o,(function(){return this})),u(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=S,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(n,a){return s.type="throw",s.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),O(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;O(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:S(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},757:function(e,t,r){r(553)},435:function(e){e.exports=["cnn_demo","residual_3k_3x","residual_4k_2x","residual_5k_2x","residual_5k_3x","denoise_10k_1x","background_selfie","background_webgl_unet","background_webgl","background_webgl2","upscaler_4krgb_2x"]},443:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,a=void 0!==(e=e||{})?e:{};a.ready=new Promise((function(e,t){r=e,n=t}));var o,i={};for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var p,d,g="";(s||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var m,y=a.print||console.log.bind(console),_=a.printErr||console.warn.bind(console);for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);i=null,a.arguments&&(f=a.arguments),a.thisProgram&&(l=a.thisProgram),a.quit&&(h=a.quit),a.wasmBinary&&(m=a.wasmBinary);var w,E=a.noExitRuntime||!0;"object"!=typeof WebAssembly&&D("no native wasm support detected");var T,b,v,x,A=!1,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&R)return R.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function I(e){T=e,a.HEAP8=b=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=x=new Int32Array(e),a.HEAPU8=v=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var S,P=[],k=[],B=[],L=[];k.push({func:function(){Z()}});var U=0,C=null,F=null;function D(e){a.onAbort&&a.onAbort(e),_(e+=""),A=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function M(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function N(e){return M(e,"data:application/octet-stream;base64,")}function X(e){return M(e,"file://")}a.preloadedImages={},a.preloadedAudios={};var G,W,j="./tflite/tflite-simd.wasm";function H(e){try{if(e==j&&m)return new Uint8Array(m);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function z(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?S.get(r)():S.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(a)}}function $(e){return x[ee()>>2]=e,e}function q(e){try{return w.grow(e-T.byteLength+65535>>>16),I(w.buffer),1}catch(e){}}N(j)||(G=j,j=a.locateFile?a.locateFile(G,g):(g=a.basePath||g)+G),W=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var V={};function Y(){if(!Y.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in V)e[t]=V[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Y.strings=r}return Y.strings}var J,K={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=K.buffers[e];0===t||10===t?((1===e?y:_)(O(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return K.varargs+=4,x[K.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?O(v,e,void 0):""}(e);return t},get64:function(e,t){return e}},Q={a:function(){D()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return $(28),-1;r=W()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){D("To use dlopen, you need to use Emscripten\'s linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){D("To use dlopen, you need to use Emscripten\'s linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){v.copyWithin(e,t,t+r)},m:function(e){var t,r=v.length,n=2147483648;if(e>n)return!1;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);if(o=Math.min(o,e+100663296),q(Math.min(n,((t=Math.max(e,o))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=W();W()-t<e;);},p:function(e,t){var r=0;return Y().forEach((function(n,a){var o=t+r;x[e+4*a>>2]=o,function(e,t,r){for(var n=0;n<e.length;++n)b[t++>>0]=e.charCodeAt(n);b[t>>0]=0}(n,o),r+=n.length+1})),0},g:function(e,t){var r=Y();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){E||(a.onExit&&a.onExit(e),A=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,a){},c:function(e,t,r,n){for(var a=0,o=0;o<r;o++){for(var i=x[t+8*o>>2],s=x[t+(8*o+4)>>2],u=0;u<s;u++)K.printChar(e,v[i+u]);a+=s}return x[n>>2]=a,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return $(28),-1}},Z=(function(){var e={a:Q};function t(e,t){var r=e.exports;a.asm=r,I((w=a.asm.q).buffer),S=a.asm.D,function(e){if(U--,a.monitorRunDependencies&&a.monitorRunDependencies(U),0==U&&(null!==C&&(clearInterval(C),C=null),F)){var t=F;F=null,t()}}()}function r(e){t(e.instance)}function o(t){return function(){if(!m&&(s||u)){if("function"==typeof fetch&&!X(j))return fetch(j,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+j+"\'";return e.arrayBuffer()})).catch((function(){return H(j)}));if(p)return new Promise((function(e,t){p(j,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return H(j)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),D(e)}))}if(U++,a.monitorRunDependencies&&a.monitorRunDependencies(U),a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(m||"function"!=typeof WebAssembly.instantiateStreaming||N(j)||X(j)||"function"!=typeof fetch?o(r):fetch(j,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),a.___wasm_call_ctors=function(){return(Z=a.___wasm_call_ctors=a.asm.r).apply(null,arguments)}),ee=(a._getModelBufferMemoryOffset=function(){return(a._getModelBufferMemoryOffset=a.asm.s).apply(null,arguments)},a._getInputMemoryOffset=function(){return(a._getInputMemoryOffset=a.asm.t).apply(null,arguments)},a._getInputHeight=function(){return(a._getInputHeight=a.asm.u).apply(null,arguments)},a._getInputWidth=function(){return(a._getInputWidth=a.asm.v).apply(null,arguments)},a._getInputChannelCount=function(){return(a._getInputChannelCount=a.asm.w).apply(null,arguments)},a._getOutputMemoryOffset=function(){return(a._getOutputMemoryOffset=a.asm.x).apply(null,arguments)},a._getOutputHeight=function(){return(a._getOutputHeight=a.asm.y).apply(null,arguments)},a._getOutputWidth=function(){return(a._getOutputWidth=a.asm.z).apply(null,arguments)},a._getOutputChannelCount=function(){return(a._getOutputChannelCount=a.asm.A).apply(null,arguments)},a._loadModel=function(){return(a._loadModel=a.asm.B).apply(null,arguments)},a._runInference=function(){return(a._runInference=a.asm.C).apply(null,arguments)},a.___errno_location=function(){return(ee=a.___errno_location=a.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){J||(J=!0,a.calledRun=!0,A||(z(k),z(B),r(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),L.unshift(e);var e;z(L)}()))}e=e||f,U>0||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),P.unshift(e);var e;z(P)}(),U>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),t()}),1)):t()))}if(F=function e(){J||re(),J||(F=e)},a.run=re,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return re(),e.ready});e.exports=r},595:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,a=void 0!==(e=e||{})?e:{};a.ready=new Promise((function(e,t){r=e,n=t}));var o,i={};for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var p,d,g="";(s||u)&&(u?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",u&&(d=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),p=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var m,y=a.print||console.log.bind(console),_=a.printErr||console.warn.bind(console);for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);i=null,a.arguments&&(f=a.arguments),a.thisProgram&&(l=a.thisProgram),a.quit&&(h=a.quit),a.wasmBinary&&(m=a.wasmBinary);var w,E=a.noExitRuntime||!0;"object"!=typeof WebAssembly&&D("no native wasm support detected");var T,b,v,x,A=!1,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,r){for(var n=t+r,a=t;e[a]&&!(a>=n);)++a;if(a-t>16&&e.subarray&&R)return R.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function I(e){T=e,a.HEAP8=b=new Int8Array(e),a.HEAP16=new Int16Array(e),a.HEAP32=x=new Int32Array(e),a.HEAPU8=v=new Uint8Array(e),a.HEAPU16=new Uint16Array(e),a.HEAPU32=new Uint32Array(e),a.HEAPF32=new Float32Array(e),a.HEAPF64=new Float64Array(e)}a.INITIAL_MEMORY;var S,P=[],k=[],B=[],L=[];k.push({func:function(){Z()}});var U=0,C=null,F=null;function D(e){a.onAbort&&a.onAbort(e),_(e+=""),A=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function M(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function N(e){return M(e,"data:application/octet-stream;base64,")}function X(e){return M(e,"file://")}a.preloadedImages={},a.preloadedAudios={};var G,W,j="./tflite/tflite.wasm";function H(e){try{if(e==j&&m)return new Uint8Array(m);if(d)return d(e);throw"both async and sync fetching of the wasm failed"}catch(e){D(e)}}function z(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?S.get(r)():S.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(a)}}function $(e){return x[ee()>>2]=e,e}function q(e){try{return w.grow(e-T.byteLength+65535>>>16),I(w.buffer),1}catch(e){}}N(j)||(G=j,j=a.locateFile?a.locateFile(G,g):(g=a.basePath||g)+G),W=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var V={};function Y(){if(!Y.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in V)e[t]=V[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Y.strings=r}return Y.strings}var J,K={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=K.buffers[e];0===t||10===t?((1===e?y:_)(O(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return K.varargs+=4,x[K.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?O(v,e,void 0):""}(e);return t},get64:function(e,t){return e}},Q={a:function(){D()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return $(28),-1;r=W()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){D("To use dlopen, you need to use Emscripten\'s linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){D("To use dlopen, you need to use Emscripten\'s linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){v.copyWithin(e,t,t+r)},m:function(e){var t,r=v.length,n=2147483648;if(e>n)return!1;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);if(o=Math.min(o,e+100663296),q(Math.min(n,((t=Math.max(e,o))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=W();W()-t<e;);},p:function(e,t){var r=0;return Y().forEach((function(n,a){var o=t+r;x[e+4*a>>2]=o,function(e,t,r){for(var n=0;n<e.length;++n)b[t++>>0]=e.charCodeAt(n);b[t>>0]=0}(n,o),r+=n.length+1})),0},g:function(e,t){var r=Y();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){E||(a.onExit&&a.onExit(e),A=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,a){},c:function(e,t,r,n){for(var a=0,o=0;o<r;o++){for(var i=x[t+8*o>>2],s=x[t+(8*o+4)>>2],u=0;u<s;u++)K.printChar(e,v[i+u]);a+=s}return x[n>>2]=a,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return $(28),-1}},Z=(function(){var e={a:Q};function t(e,t){var r=e.exports;a.asm=r,I((w=a.asm.q).buffer),S=a.asm.D,function(e){if(U--,a.monitorRunDependencies&&a.monitorRunDependencies(U),0==U&&(null!==C&&(clearInterval(C),C=null),F)){var t=F;F=null,t()}}()}function r(e){t(e.instance)}function o(t){return function(){if(!m&&(s||u)){if("function"==typeof fetch&&!X(j))return fetch(j,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at \'"+j+"\'";return e.arrayBuffer()})).catch((function(){return H(j)}));if(p)return new Promise((function(e,t){p(j,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return H(j)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){_("failed to asynchronously prepare wasm: "+e),D(e)}))}if(U++,a.monitorRunDependencies&&a.monitorRunDependencies(U),a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(e){return _("Module.instantiateWasm callback failed with error: "+e),!1}(m||"function"!=typeof WebAssembly.instantiateStreaming||N(j)||X(j)||"function"!=typeof fetch?o(r):fetch(j,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return _("wasm streaming compile failed: "+e),_("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),a.___wasm_call_ctors=function(){return(Z=a.___wasm_call_ctors=a.asm.r).apply(null,arguments)}),ee=(a._getModelBufferMemoryOffset=function(){return(a._getModelBufferMemoryOffset=a.asm.s).apply(null,arguments)},a._getInputMemoryOffset=function(){return(a._getInputMemoryOffset=a.asm.t).apply(null,arguments)},a._getInputHeight=function(){return(a._getInputHeight=a.asm.u).apply(null,arguments)},a._getInputWidth=function(){return(a._getInputWidth=a.asm.v).apply(null,arguments)},a._getInputChannelCount=function(){return(a._getInputChannelCount=a.asm.w).apply(null,arguments)},a._getOutputMemoryOffset=function(){return(a._getOutputMemoryOffset=a.asm.x).apply(null,arguments)},a._getOutputHeight=function(){return(a._getOutputHeight=a.asm.y).apply(null,arguments)},a._getOutputWidth=function(){return(a._getOutputWidth=a.asm.z).apply(null,arguments)},a._getOutputChannelCount=function(){return(a._getOutputChannelCount=a.asm.A).apply(null,arguments)},a._loadModel=function(){return(a._loadModel=a.asm.B).apply(null,arguments)},a._runInference=function(){return(a._runInference=a.asm.C).apply(null,arguments)},a.___errno_location=function(){return(ee=a.___errno_location=a.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){J||(J=!0,a.calledRun=!0,A||(z(k),z(B),r(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)e=a.postRun.shift(),L.unshift(e);var e;z(L)}()))}e=e||f,U>0||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)e=a.preRun.shift(),P.unshift(e);var e;z(P)}(),U>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),t()}),1)):t()))}if(F=function e(){J||re(),J||(F=e)},a.run=re,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return re(),e.ready});e.exports=r},618:function(e){"use strict";function t(e,t){if(!c)return!1;const n=e.buffer;let a=l.get(n);if(null==a){if((a=r.validate(n))&&t)try{new r.Instance(new r.Module(n)).exports[0]()}catch(e){a=!1}l.set(n,a)}return a}const r=WebAssembly,n=(...e)=>Uint8Array.of(0,97,115,109,1,0,0,0,...e),a=(...e)=>Uint32Array.of(1836278016,1,...e),o=(...e)=>a(1610679297,33751040,...e,40239360,259),i=(...e)=>n(1,4,1,96,0,0,3,2,1,0,...e,11,0,10,4,110,97,109,101,2,3,1,0,0),s=(...e)=>Uint16Array.of(24832,28019,1,0,1025,24577,0,515,1,...e),u=(...e)=>s(...e,2842,4096,28164,28001,357,260,256,560,259,0),c="object"==typeof r,f=e=>c&&"function"==typeof e,l=new WeakMap,h=a(1610679553,58589440,117440770,805372165,101318656,1107297281,268438272,1835101700,17039717,36700416,259),p=s(773,1,2561,269,11,65,65,65,3068,2816,2560,28164,28001,613,259,0),d=a(1610679297,33751040,134873089,100664833,185276736),g=n(2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1,0,8,4,110,97,109,101,2,1,0),m=Uint16Array.of(24832,28019,1,0,1537,24577,512,32639,515,1,2058,1537,16640,16640,2816,2560,28164,28001,613,259,0),y=u(3082,2561,17152,0,0,252),_=u(2058,1537,16640,49152),w=o(101318657,301990913,268438272,1835101700,17039717),E=i(5,4,1,3,1,1,10,7,1,5,0,254,3,0),T=o(84344833,6357249,17369600,4259847,186257917,1845758464),b=i(10,7,1,5,0,208,112,26);e.exports={support:(e=1)=>c&&t(Uint32Array.of(1836278016,e)),get supportStreaming(){return f(r.instantiateStreaming)},feature:{get bigInt(){return t(h,!0)},get bulk(){return t(p)},get exceptions(){return t(d)},get mutableGlobal(){return t(g)},get multiValue(){return t(m)},get saturateConversions(){return t(y)},get signExtensions(){return t(_)},get tailCall(){return t(w)},get threads(){return t(E)},get simd(){return t(T)},get references(){return t(b)},get typeReflection(){return f(r.Memory.type)},get funcReferences(){return f(r.Function)}}}}},t={};function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",function(){"use strict";function e(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function t(){return e()?(self.isWorker=!0,self):(window.isWorker=!1,window)}function n(t){return e()?t instanceof OffscreenCanvasRenderingContext2D:t instanceof CanvasRenderingContext2D}var a=function(e,r){let n;"string"==typeof e&&(e=document.getElementById(e));let a=1;if("true"===r.use_webgl1?n=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}):(n=e.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1}),a=2,n||(a=1,n=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}))),n.getExtension("WEBGL_draw_buffers")?n.disable_multi_draw=r.disable_multi_draw||!1:n.disable_multi_draw=!0,n.extensions={},n.getVersion=function(){return a},1===n.getVersion()){if("float32"===r.float_type){if(n.extensions.EXT_FLOAT=n.getExtension("OES_texture_float"),!n.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_float");n.extensions.EXT_FLOAT_LINEAR=n.getExtension("OES_texture_float_linear"),n.extensions.EXT_FLOAT_LINEAR,n.texture_format=n.RGBA,n.texture_type=n.FLOAT}else{if(n.extensions.EXT_FLOAT=n.getExtension("OES_texture_half_float"),!n.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_half_float");n.extensions.EXT_FLOAT_LINEAR=n.getExtension("OES_texture_half_float_linear"),n.extensions.EXT_FLOAT_LINEAR,n.texture_format=n.RGBA,n.texture_type=n.extensions.EXT_FLOAT.HALF_FLOAT_OES}if(!n.disable_multi_draw&&(n.extensions.WEBGL_draw_buffers=n.getExtension("WEBGL_draw_buffers"),!n.extensions.WEBGL_draw_buffers))throw new Error("Extension not found: WEBGL_draw_buffers")}else{if(n.extensions.EXT_FLOAT=n.getExtension("EXT_color_buffer_float"),!n.extensions.EXT_FLOAT)throw new Error("Extension not found: EXT_color_buffer_float");"float32"===r.float_type?(n.extensions.EXT_FLOAT_LINEAR=n.getExtension("OES_texture_float_linear"),n.texture_format=n.RGBA32F,n.texture_type=n.FLOAT):(n.extensions.EXT_FLOAT_LINEAR=n.getExtension("OES_texture_half_float_linear"),n.texture_format=n.RGBA16F,n.texture_type=n.FLOAT)}return 1===n.getVersion()?(n.getCOLOR_ATTACHMENT=function(e=0){return n.disable_multi_draw?n.COLOR_ATTACHMENT0:n.extensions.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+e},n.getDrawBuffers=function(e=[n.getCOLOR_ATTACHMENT(0)]){n.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(e)}):(n.getCOLOR_ATTACHMENT=function(e=0){return n.COLOR_ATTACHMENT0+e},n.getDrawBuffers=function(e=[n.getCOLOR_ATTACHMENT(0)]){n.drawBuffers(e)}),t().gl=n,n.canvas.w=n.canvas.width,n.canvas.h=n.canvas.height,n.clearCanvas=function(){n.clearColor(0,0,0,1),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT)},n.input={h:r.h,w:r.w},n.render_scale={h:1,w:1},n.viewport(0,0,e.width,e.height),n.createAndCompileShader=function(e,t){let r=n.createShader(e);if(n.shaderSource(r,t),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw new Error(n.getShaderInfoLog(r));return r},n.createAndLinkProgram=function(e,t){let r=n.createProgram();if(n.attachShader(r,e),n.attachShader(r,t),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))throw new Error(n.getProgramInfoLog(r));return r},n.resizeCanvasToDisplaySize=function(t,r){return(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,!0)},n.resizeRenderSize=function(e,t,r){let a=r*n.input.w,o=r*n.input.h;a=e>a?e:a,o=t>o?t:o,n.render_scale={w:e/a,h:t/o},n.resizeCanvasToDisplaySize(a,o)},n.log=function(e){},n};r(435);var o=r(618),i=r(443),s=r.n(i),u=r(595),c=r.n(u),f="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==f&&f,l="URLSearchParams"in f,h="Symbol"in f&&"iterator"in Symbol,p="FileReader"in f&&"Blob"in f&&function(){try{return new Blob,!0}catch(e){return!1}}(),d="FormData"in f,g="ArrayBuffer"in f;if(g)var m=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=ArrayBuffer.isView||function(e){return e&&m.indexOf(Object.prototype.toString.call(e))>-1};function _(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\\-#$%&\'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError(\'Invalid character in header field name: "\'+e+\'"\');return e.toLowerCase()}function w(e){return"string"!=typeof e&&(e=String(e)),e}function E(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return h&&(t[Symbol.iterator]=function(){return t}),t}function T(e){this.map={},e instanceof T?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function b(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function v(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function x(e){var t=new FileReader,r=v(t);return t.readAsArrayBuffer(e),r}function A(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function R(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:p&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:d&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:l&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():g&&p&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=A(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):g&&(ArrayBuffer.prototype.isPrototypeOf(e)||y(e))?this._bodyArrayBuffer=A(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):l&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},p&&(this.blob=function(){var e=b(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?b(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(x)}),this.text=function(){var e,t,r,n=b(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=v(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},d&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}T.prototype.append=function(e,t){e=_(e),t=w(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},T.prototype.delete=function(e){delete this.map[_(e)]},T.prototype.get=function(e){return e=_(e),this.has(e)?this.map[e]:null},T.prototype.has=function(e){return this.map.hasOwnProperty(_(e))},T.prototype.set=function(e,t){this.map[_(e)]=w(t)},T.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},T.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),E(e)},T.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),E(e)},T.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),E(e)},h&&(T.prototype[Symbol.iterator]=T.prototype.entries);var O=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function I(e,t){if(!(this instanceof I))throw new TypeError(\'Please use the "new" operator, this DOM object constructor cannot be called as a function.\');var r,n,a=(t=t||{}).body;if(e instanceof I){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new T(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,a||null==e._bodyInit||(a=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new T(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),O.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&a)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(a),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\\+/g," "),a=r.join("=").replace(/\\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(a))}})),t}function P(e,t){if(!(this instanceof P))throw new TypeError(\'Please use the "new" operator, this DOM object constructor cannot be called as a function.\');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new T(t.headers),this.url=t.url||"",this._initBody(e)}I.prototype.clone=function(){return new I(this,{body:this._bodyInit})},R.call(I.prototype),R.call(P.prototype),P.prototype.clone=function(){return new P(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new T(this.headers),url:this.url})},P.error=function(){var e=new P(null,{status:0,statusText:""});return e.type="error",e};var k=[301,302,303,307,308];P.redirect=function(e,t){if(-1===k.indexOf(t))throw new RangeError("Invalid status code");return new P(null,{status:t,headers:{location:e}})};var B=f.DOMException;try{new B}catch(e){(B=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),B.prototype.constructor=B}function L(e,t){return new Promise((function(r,n){var a=new I(e,t);if(a.signal&&a.signal.aborted)return n(new B("Aborted","AbortError"));var o=new XMLHttpRequest;function i(){o.abort()}o.onload=function(){var e,t,n={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new T,e.replace(/\\r?\\n[\\t ]+/g," ").split("\\r").map((function(e){return 0===e.indexOf("\\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var a=r.join(":").trim();t.append(n,a)}})),t)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var a="response"in o?o.response:o.responseText;setTimeout((function(){r(new P(a,n))}),0)},o.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){n(new B("Aborted","AbortError"))}),0)},o.open(a.method,function(e){try{return""===e&&f.location.href?f.location.href:e}catch(t){return e}}(a.url),!0),"include"===a.credentials?o.withCredentials=!0:"omit"===a.credentials&&(o.withCredentials=!1),"responseType"in o&&(p?o.responseType="blob":g&&a.headers.get("Content-Type")&&-1!==a.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof T?a.headers.forEach((function(e,t){o.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){o.setRequestHeader(e,w(t.headers[e]))})),a.signal&&(a.signal.addEventListener("abort",i),o.onreadystatechange=function(){4===o.readyState&&a.signal.removeEventListener("abort",i)}),o.send(void 0===a._bodyInit?null:a._bodyInit)}))}L.polyfill=!0,f.fetch||(f.fetch=L,f.Headers=T,f.Request=I,f.Response=P);const U=t();let C=async(e,t={})=>{let n,a=((t=t||{}).path||r.p)+`models/${e}.js`;var i;return t.token&&(a=a+"?"+t.token),U.vectorlyBasePath=t.path||r.p,"background_selfie"===e&&(n=(async()=>{let e;if(U.tflite)e=U.tflite;else{let t=U.vectorlyBasePath||"";try{if(!0!==o.feature.simd)throw new Error("SIMD feature check is false");e=await s()({basePath:t})}catch(r){e=await c()({basePath:t})}}return e})()),U.isWorker?importScripts(a):await(i=a,new Promise(((e,t)=>{const r="$importModule$"+Math.random().toString(32).slice(2),n=document.createElement("script"),a=()=>{delete window[r],n.onerror=null,n.onload=null,n.remove(),URL.revokeObjectURL(n.src),n.src=""};n.defer="defer",n.type="module",n.onerror=()=>{t(new Error(`Failed to import: ${i}`)),a()},n.onload=()=>{e(window[r]),a()};const o=function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(i),s=new Blob([`import * as m from "${o}"; window.${r} = m;`],{type:"text/javascript"});n.src=URL.createObjectURL(s),document.head.appendChild(n)}))),"background_selfie"===e&&(U.tflite=await n),U.vectorly.models[e]},F=async(e,t,n,a)=>{if(a=a||{},"background_selfie"===e){let o=(a.path||r.p)+`./data/${e}/${t}_v${n}.tflite`;a.token&&(o=o+"?"+a.token);const i=await fetch(o);if(!i.ok)throw Error(`Response fetching "${o}": ${i.statusText}`);return{model:await i.arrayBuffer()}}if("background_webgl2"===e||"background_webgl"===e||"background_webgl_unet"===e){let o=(a.path||r.p)+`./data/${e}/${t}_v${n}.json`,i=(a.path||r.p)+`./data/${e}/${t}_v${n}.weights`;a.token&&(o+="?"+a.token,i+="?"+a.token);const[s,u]=await Promise.all([fetch(o),fetch(i)]),[c,f]=await Promise.all([s.json(),u.arrayBuffer()]),l=JSON.parse(JSON.stringify(c)),h=new Float32Array(f),p=Object.keys(c),d=["weights","biases"];c[p[0]].debugImage&&d.push("debugImage");for(let e of p)for(let t of d){let[r,n]=c[e][t];l[e][t]=h.slice(n,n+r)}return l}{let o=(a.path||r.p)+`./data/${e}/${t}_v${n}.json`;a.token&&(o=o+"?"+a.token);const i=await fetch(o);return await i.json()}};function D(e,t){const{cmd:r,msgId:n}=e,a="w-"+r;"render"===r?(self.postMessage({cmd:a,msgId:n,ret:t},[t.bitmap]),t.bitmap.close()):self.postMessage({cmd:a,msgId:n,ret:t})}r(757),self.glWorker=new class{constructor(){}async preloadBackground(e){if("string"==typeof e.background)try{let t=await fetch(e.background);return self.preloadedBackground=await t.blob(),!0}catch(t){return console.warn(`Vectorly: unable to load ${e.background} as a background image`),!1}else if(e.background instanceof ImageBitmap)return self.preloadedBackground=e.background,!0}async getNetwork(e){const{name:t,token:r}=e;this.NetworkClass=await C(t,r)}async getParameters(e){const{name:t,tag:r,version:n,token:a}=e;this.networkParams={name:t,tag:r,version:n},this.networkParameters=await F(t,r,n,a)}async initWebGLContext(e){const{canvas:t,options:r}=e;return this.gl=new a(t,r),!0}async render(e){const{inputImage:t}=e;return this.frameBuffer&&this.frameBuffer.setInputImage(t),this.renderer&&await this.renderer.render(),t.close(),{bitmap:await createImageBitmap(this.gl.canvas)}}async instantiateNetwork(r){if(this.networkOptions=r.networkOptions,this.gl)return this.frameBuffer=new class{constructor(e){this.gl=e,this.iterations=0,this.textures=[{},{}],this.frame_buffers=[{},{}],this.inputTex=null,this.inputCanvas=null,this.frame_difference=0}drawToCanvas(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}setBuffer(e){const t=this.gl,r=this.iterations%2*this.frame_difference;t.bindFramebuffer(t.FRAMEBUFFER,this.frame_buffers[r][e])}setInputFrameCanvas(){t(),n(this.inputCanvas)||(this.inputCanvas=function(t,r){if(e())return new OffscreenCanvas(t,r);{const e=document.createElement("canvas");return e.width=t,e.height=r,e}}(this.gl.input.w,this.gl.input.h).getContext("2d")),this.inputCanvas.canvas.width=this.gl.input.w,this.inputCanvas.canvas.height=this.gl.input.h}videoToCanvas(e){return this.inputCanvas.drawImage(e,0,0,this.gl.input.w,this.gl.input.h),this.inputCanvas.canvas}getInputTexture(){const e=this.gl;if(null===this.inputTex){let t=e.createTexture();this.inputTex=this._setTextureSize(t,e.input.w,e.input.h)}return this.inputTex}setInputImage(e){this.input=e;const t=this.gl;n(this.inputCanvas)&&1===t.getVersion()&&(e=this.videoToCanvas(e));let r=this.getInputTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.texture_format,t.RGBA,t.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e].INPUT=[r]}setImageAsTexture(e,t){const r=this.gl;let n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.texture_format,r.RGBA,r.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e][t]=[n]}createBufferWithTextures(e,t,r=1,n=null){const a=this.gl;for(let o=0;o<=this.frame_difference;o++){const i=a.createFramebuffer();this.frame_buffers[o][e]=i,a.bindFramebuffer(a.FRAMEBUFFER,i);const s=[];this.textures[o][e]=null;for(let e=0;e<t;++e){let t=this.createAndSetupTexture(n);t=this._setTextureSize(t,a.input.w*r,a.input.h*r),s.push(t),a.bindTexture(a.TEXTURE_2D,t),a.texImage2D(a.TEXTURE_2D,0,a.texture_format,a.input.w*r,a.input.h*r,0,a.RGBA,a.texture_type,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.getCOLOR_ATTACHMENT(e),a.TEXTURE_2D,t,0)}this.textures[o][e]=s}}createBufferWithTextures2(e,t,r,n,a={}){const o=this.gl;if(r<=0||n<=0)throw new Error("Texture width and height must be greater than 0");let i=a.format||o.RGBA,s=a.minFilter||o.NEAREST,u=a.magFilter||o.NEAREST,c=a.type||o.texture_type||o.UNSIGNED_BYTE,f=a.internalFormat||o.texture_format||o.RGBA;for(let a=0;a<=this.frame_difference;a++){const l=o.createFramebuffer();this.frame_buffers[a][e]=l,o.bindFramebuffer(o.FRAMEBUFFER,l);const h=[];this.textures[a][e]=null;for(let e=0;e<t;++e){let t;1===o.getVersion()?t=this.createTexture_webgl1(f,r,n,i,c,s,u):(f===o.RGBA&&(f=o.RGBA8),t=this.createTexture_webgl2(f,r,n,s,u)),o.framebufferTexture2D(o.FRAMEBUFFER,o.getCOLOR_ATTACHMENT(e),o.TEXTURE_2D,t,0),h.push(t)}this.textures[a][e]=h}}getTextureSize(e,t=0,r=0){if(!this.textures[t][e][r])throw new Error(`Failed to get resolution of textures for layer: ${e} at index: ${index}`);return this.textures[t][e][r].size}createTexture_webgl2(e,t,r,n,a){n=n||gl.NEAREST,a=a||gl.NEAREST,e=e||gl.texture_format||gl.RGBA;let o=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,n),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,a),gl.texStorage2D(gl.TEXTURE_2D,1,e,t,r),o=this._setTextureSize(o,t,r),o}createTexture_webgl1(e,t,r,n,a,o,i){n=n||gl.RGBA,o=o||gl.NEAREST,i=i||gl.NEAREST,a=a||gl.texture_type||gl.UNSIGNED_BYTE,e=e||gl.texture_format||gl.RGBA;let s=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,i),gl.texImage2D(gl.TEXTURE_2D,0,e,t,r,0,n,a,null),s=this._setTextureSize(s,t,r),s}createFloatTextureFromArrayBuffer(e,t,r,n,a,o,i,s){o=o||gl.RGBA,i=i||gl.NEAREST,s=s||gl.NEAREST,a=a||gl.texture_type||gl.UNSIGNED_BYTE,t=t||gl.texture_format||gl.RGBA;const u=new Float32Array(e);let c=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,i),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,s),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32F,r,n,0,gl.RGBA,gl.FLOAT,u),c=this._setTextureSize(c,r,n),c}_setTextureSize(e,t,r){return t>0&&r>0&&(e.size={},e.size.width=t,e.size.height=r),e}setBufferForLayer(e,t){for(let r=0;r<=this.frame_difference;r++){const n=gl.createFramebuffer();this.frame_buffers[r][e]=n,gl.bindFramebuffer(gl.FRAMEBUFFER,n);for(let e=0;e<t.length;e++)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.getCOLOR_ATTACHMENT(e),gl.TEXTURE_2D,t[e],0);this.textures[r][e]=t}}getTexture(e){const t=this.iterations%2*this.frame_difference;return this.textures[t][e]}getLastFrameTexture(e){const t=1-this.iterations%2;return this.textures[t][e]}clearall(){Object.keys(this.textures[0]).forEach((e=>{for(let t=0;t<=this.frame_difference;t++){this.gl.deleteFramebuffer(this.frame_buffers[t][e]),this.frame_buffers[t][e]=null;for(let r=0;r<this.textures[t][e].length;++r)this.gl.deleteTexture(this.textures[t][e][r]),this.textures[t][e][r]=null}})),this.gl.deleteTexture(this.inputTex),this.inputTex=null,this.inputCanvas=null,this.frame_buffers=[{},{}],this.textures=[{},{}],this.gl.clearCanvas()}createAndSetupTexture(e=null){const t=this.gl;t.extensions.EXT_FLOAT_LINEAR||(e=null),null===e&&(e=t.NEAREST);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}}(this.gl),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.initialized=this.networkInstance.initialized,await this.initialized,!0;throw Error(`this.gl is ${this.gl}: maybe called instantiateNetwork without calling initWebGLContext?`)}async initRenderer(e){return this.renderInputSize=e.renderInputSize,this.renderer=new class{constructor(e,t,r,n){this.gl=e,this.network=t,this.frameBuffer=r,this.renderSize={w:n.w,h:n.h},this.metrics={"Render Size":this.renderSize,"Original Size":e.input,"Upscale Factor":t.upscaleFactor,FPS:0},this.setProperties(n)}setProperties(e={w:1278,h:720,disableVideoToCanvas:!1}){const t=this;!0!==e.disableVideoToCanvas&&this.frameBuffer.setInputFrameCanvas(),void 0===e.w&&(e.w=this.network.upscaleFactor*this.gl.input.w),void 0===e.h&&(e.h=this.network.upscaleFactor*this.gl.input.h),this.renderSize=e,this.gl.resizeRenderSize(e.w,e.h,this.network.upscaleFactor),null!==this.frameBuffer.inputTex&&setTimeout((()=>{t.network.renderRGB(t.gl.render_scale)})),t.metrics["Render Size"]=e}setInputSize(e={w:426,h:240},t=null){this.gl.input={w:e.w,h:e.h},this.network.resetTextureBuffers(),this.setProperties(t||this.renderSize)}async resetNetwork(e){this.frameBuffer.clearall(),this.network=await async function(e={name:"",version:"",tag:"",token:""},t,r){let n=null,a=null;try{a=await F(e.name,e.tag,e.version,e.token)}catch(e){throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error(e)}if(!a)throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error("");try{const o=C(e.name,e.token);n=await o,n=new n(t,r,a)}catch(e){throw console.error("%cNetwork load failed:","background:black; color: yellow"),new Error(e)}return n}({name:e.name,version:e.version,tag:e.tag},this.gl,this.network.frameBuffer),this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl,this.setProperties(this.renderSize)}changeNetwork(e){this.network=e,this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl}async loadBitmap(e){const t=this.frameBuffer;this.network,t.setInputImage(e),await this.render()}loadImage(e){const t=new Image;t.src=e;const r=this.frameBuffer,n=this,a=this.network;t.onload=async function(){r.setInputImage(t),await n.render(),a.getImageBytes()}}async render(e){const t=this.gl,r=this.network;t.clearColor(0,0,0,1),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),r.initialized&&await r.initialized,await r.feedForward(t.render_scale,e),t.flush()}}(this.gl,this.networkInstance,this.frameBuffer,this.renderInputSize),!0}async setRenderSize(e){this.renderInputSize=e.renderInputSize,this.renderer&&this.renderer.setProperties(this.renderInputSize)}async setInputSize(e){this.inputSize=e.inputSize,this.renderer&&this.renderer.setInputSize(this.inputSize)}async changeNetwork(e){this.networkOptions=e.networkOptions,this.gl&&(this.frameBuffer&&this.frameBuffer.clearall(),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.renderer.changeNetwork(this.networkInstance))}async updateOptions(e){const{update:t}=e;await this.networkInstance.updateOptions(t)}},self.onmessage=async function(e){const{cmd:t,params:r}=e.data;if(self.glWorker[t]&&"function"==typeof self.glWorker[t])try{const n=await self.glWorker[t](r);D(e.data,n)}catch(t){console.error("Caught error",t),D(e.data,{error:t.toString()})}else console.error(`No function ${t} for glWorker`),D(e.data,{error:`No function ${t} for glWorker`})}}()}();',"Worker",void 0,void 0)}var g=function(){function e(t){(0,a.Z)(this,e),this.worker=new p,this.id=t.id||(0,l.v4)(),this.framerate=t.framerate}var t,r,i;return(0,s.Z)(e,[{key:"destroy",value:function(){this.worker&&this.worker.terminate()}},{key:"preloadBackground",value:(i=(0,n.Z)(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return"string"==typeof t?r=this.sendMessageToWorker("preloadBackground",{background:t}).retValP:(this.preloaded=t,r=this.sendMessageToWorker("preloadBackground",{background:t},[t]).retValP),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getParameters",value:function(e,t,r,n){return this.sendMessageToWorker("getParameters",{name:e,tag:t,version:r,token:n}).retValP}},{key:"getNetwork",value:function(e,t){return this.sendMessageToWorker("getNetwork",{name:e,token:t}).retValP}},{key:"initWebGLContext",value:function(e,t){return this.sendMessageToWorker("initWebGLContext",{canvas:e,options:t},[e]).retValP}},{key:"initRenderer",value:function(e){return this.sendMessageToWorker("initRenderer",{renderInputSize:e}).retValP}},{key:"setRenderSize",value:function(e){return this.sendMessageToWorker("setRenderSize",{renderInputSize:e}).retValP}},{key:"setInputSize",value:function(e){return this.sendMessageToWorker("setInputSize",{inputSize:e}).retValP}},{key:"instantiateNetwork",value:function(e){return"string"!=typeof e.background.image&&delete e.background.image,this.sendMessageToWorker("instantiateNetwork",{networkOptions:e}).retValP}},{key:"changeNetwork",value:function(e){return this.sendMessageToWorker("changeNetwork",{networkOptions:e}).retValP}},{key:"updateOptions",value:function(e){return e.framerate&&(this.framerate=Math.min(e.framerate||24,this.trackFrameRate)),e.background&&e.background.image instanceof ImageBitmap?this.sendMessageToWorker("updateOptions",{update:e},[e.background.image]):this.sendMessageToWorker("updateOptions",{update:e})}},{key:"_getImageCapture",value:function(e){var t;if(e instanceof MediaStream)t=e;else{if(!(e instanceof HTMLVideoElement))throw new Error("input in _getImageCapture is neither MediaStream nor HTMLVideoElement: ".concat(e));t=e.captureStream()}var r=t.getVideoTracks(),n=(0,c.Z)(r,1)[0];(0,h.ok)()&&console.log("In _getImageCapture",n);var i=document.createElement("video");return i.width=n.getSettings().width,i.height=n.getSettings().height,i.srcObject=t,i.play(),this.video=i,this.trackFrameRate=n.getSettings().frameRate,this.framerate=Math.min(this.framerate||24,this.trackFrameRate),this.lastRenderTime=Date.now(),i}},{key:"_setInput",value:function(e){(0,h.ok)()&&console.log("imageCapInstance",this.imageCapInstance),e instanceof ImageBitmap?this.imageBitmap=e:this.imageCapInstance=this._getImageCapture(e)}},{key:"render",value:(r=(0,n.Z)(u().mark((function e(t){var r,n,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.imageCapInstance&&!this.imageBitmap){e.next=27;break}if(e.prev=1,e.t0=this.imageBitmap,e.t0){e.next=7;break}return e.next=6,createImageBitmap(this.video);case 6:e.t0=e.sent;case 7:if(r=e.t0,(0,h.ok)()&&console.log("grabFrame.then",this,r),!((n=Math.round(1e3/this.framerate)-(Date.now()-this.lastRenderTime))>0)){e.next=13;break}return e.next=13,new Promise((function(e){setTimeout(e,n)}));case 13:if(this.lastRenderTime=Date.now(),!t.passthrough){e.next=16;break}return e.abrupt("return",new Promise((function(e){e({bitmap:r})})));case 16:return i=this.sendMessageToWorker("render",{inputImage:r},[r]),a=i.retValP,r.close(),e.abrupt("return",a);case 21:return e.prev=21,e.t1=e.catch(1),(0,h.ok)()&&console.error("in render",e.t1),e.abrupt("return",!1);case 25:e.next=29;break;case 27:return(0,h.ok)()&&console.error("this.imageCapInstance",this.imageCapInstance),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,this,[[1,21]])}))),function(e){return r.apply(this,arguments)})},{key:"sendMessageToWorker",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];(0,h.ok)()&&"render"!==e&&console.log("sendMessageToWorker",e,t,r);var n=(0,l.v4)(),i=this.getWorkerMessage(e,n);return this.worker.postMessage({cmd:e,msgId:n,params:t},r),{msgId:n,retValP:i}}},{key:"getWorkerMessage",value:(t=(0,n.Z)(u().mark((function e(t,r){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.worker,e.abrupt("return",new Promise((function(e,i){var a="w-"+t,s=new AbortController;n.addEventListener("message",(function(n){if((0,h.ok)()&&"render"!==t&&console.log("Message event",n),n.data.cmd===a&&n.data.msgId===r){if((0,h.ok)()&&"render"!==t&&console.log("Aborting",n.data),n.data.ret&&n.data.ret.error)i(n.data.ret.error);else{var o=void 0===n.data.ret||n.data.ret;(0,h.ok)()&&"render"!==t&&console.log("resolving",n.data,o),e(o)}s.abort()}}),{signal:s.signal})})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),e}(),m=g,v=r(33),y=r(820);function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var E=function(){function e(t,r){(0,a.Z)(this,e),(0,h.ok)()&&console.log("Initialized upscaler with",t);var n=r;this.video=t,this.stream=n.stream,this.id=n.id||(0,l.v4)(),this.videoParent=t.parentNode,this.token=n.token,this.serverType=n.serverType,this.webgl,this.framerate=n.framerate,this.fixaspectratio=n.fixaspectratio||!0,this.passthrough=!1,this.inputChangePreHook=n.inputChangePreHook||function(){return!0},this.renderSize=n.renderSize,"disable"===n.container?this.container=null:this.container=n.container||t.parentNode,(0,h.ok)()&&console.log("Container is",this.container),this.container&&(this.container.style.background="black",this.container.style.resize="both",this.container.style.overflow="hidden",this.ro=this.getResizeObserver(this.setRenderSize.bind(this)),this.ro.observe(this.container)),this.margin={top:0,left:0},this.use_webgl1=n.use_webgl1||"false",this.float_type=n.float_type||"float16",this.scale=n.scale||3,n.networkParams=n.networkParams||{},this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"},this.networkParams=Object.assign(this.networkParams,n.networkParams),this.networkOptions=n.networkOptions||{},(n.network||n.tag||n.version)&&(this.networkParams.name=n.network||this.networkParams.name,this.networkParams.tag=n.tag||this.networkParams.tag,"residual_3k_3x"===this.networkParams.name?this.networkParams.version=n.version||n.networkParams.version||"2.1":this.networkParams.version=n.version||n.networkParams.version||"0"),"residual_3k"===n.network?this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"}:"residual_5k"===n.network&&(this.networkParams={name:"residual_5k_3x",tag:"general",version:"0"}),(0,h.ok)()&&console.log("Loading Upscaling network ".concat(this.networkParams.name," - tag - ").concat(this.networkParams.tag,"  - version ").concat(this.networkParams.version)),this.glHandle=new m({id:this.id,framerate:this.framerate});var i=this.initCanvas(),s=i.canvas,o=i.offscreen;this.canvas=s,this.offscreen=o,this.instantiateP=this.instantiateNetwork(),this.setupMetrics(),this.initEvents(),this.reqHandle={noDelay:!1,useRAF:!("requestVideoFrameCallback"in HTMLVideoElement.prototype)},this.reqHandle.noDelay=!0,n.reqHandle=n.reqHandle||{},this.reqHandle=_(_({},this.reqHandle),n.reqHandle),this.enabled=void 0===n.enabled||Boolean(n.enabled),this.enabled?this.enable():this.disable(),this.isPlaying=!1,this.playerInitTime=Date.now(),this.initialized=this.initializeNetwork(t),this.error=null,this.analyticsEnabled=!1,this.updateInterval=n.updateInterval||5e3,this.debug=!0===n.debug,this.debugRender=!0===n.debugRender,this.initAnalytics()}var t,r,i,o,c,f,d,p;return(0,s.Z)(e,[{key:"initAnalytics",value:(p=(0,n.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"trackEventListener",value:function(e){var t=this;return function(){t.debug&&console.log("TrackEventListener",e),t.trackAnalytics(e+" Event",{upscale:t.enabled,type:t.events[e].type,currentTime:t.video.currentTime})}}},{key:"trackAnalytics",value:function(e,t){this.debug&&console.log("Tracking",e,t)}},{key:"updateStream",value:function(e){this.stream=e,this.glHandle._setInput(this.stream)}},{key:"setupMetrics",value:function(){this.prv=performance.now(),this.frames={rendered:{sinceTimestamp:0,total:0},video:{total:0}},this.metrics={renderSize:{w:1278,h:720},originalSize:{w:this.video.videoWidth,h:this.video.videoHeight},upscaleFactor:this.scale,droppedFrames:0,fps:0,upscaledFrames:0,videoFrames:0}}},{key:"changeNetwork",value:(d=(0,n.Z)(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("Changing network from",this.networkParams,"to",t),this.networkParams.name=t.name||this.networkParams.name,this.networkParams.tag=t.tag||this.networkParams.tag,this.networkParams.version=t.version||this.networkParams.version,e.next=6,(0,h.re)(this.networkParams,this.token,this.serverType);case 6:return r=e.sent,e.prev=7,n=this.glHandle.getParameters(this.networkParams.name,this.networkParams.tag,this.networkParams.version,r),e.next=11,this.glHandle.getNetwork(this.networkParams.name,r);case 11:return this.NetworkClass=e.sent,e.next=14,n;case 14:return this.networkParameters=e.sent,e.next=17,this.glHandle.changeNetwork(this.networkOptions);case 17:this.renderSize&&this.setRenderSize(this.renderSize),this.render(),e.next=26;break;case 21:e.prev=21,e.t0=e.catch(7),console.error("Error fetching network parameters and model or changing model",e.t0),document.dispatchEvent(this.events.error),this.disable();case 26:case"end":return e.stop()}}),e,this,[[7,21]])}))),function(e){return d.apply(this,arguments)})},{key:"instantiateNetwork",value:(f=(0,n.Z)(u().mark((function e(){var t,r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.re)(this.networkParams,this.token,this.serverType);case 2:return t=e.sent,e.prev=3,r=this.glHandle.preloadBackground(this.networkOptions.background.image),n=this.glHandle.getParameters(this.networkParams.name,this.networkParams.tag,this.networkParams.version,t),e.next=8,this.glHandle.getNetwork(this.networkParams.name,t);case 8:return this.NetworkClass=e.sent,e.next=11,n;case 11:return this.networkParameters=e.sent,e.next=14,r;case 14:e.sent||"virtual"!==this.networkOptions.background.type||console.warn("Unable to load ".concat(this.networkOptions.background.image," as background image")),this.container?this.container.insertBefore(this.canvas,this.video.nextSibling):document.body.appendChild(this.canvas),e.next=27;break;case 19:throw e.prev=19,e.t0=e.catch(3),console.error("Error in instantiateNetwork",e.t0),document.dispatchEvent(this.events.error),this.initialized=!1,this.error=e.t0,this.disable(),e.t0;case 27:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(){return f.apply(this,arguments)})},{key:"disable",value:function(){var e=this.video;e.style.height="100%",e.style.width="100%",this.canvas.style.visibility="hidden",e.style.visibility="visible",this.enabled=!1,this.trackAnalytics("Disabled",{upscale:this.enabled})}},{key:"enable",value:function(){this.video.style.visibility="hidden",this.canvas.style.visibility="hidden",this.enabled=!0,this.debug&&console.log("isPlaying",(0,h.yA)(this.video)),this.metrics.frameCount=0,(0,h.yA)(this.video)&&this.render(),this.trackAnalytics("Enabled",{upscale:this.enabled})}},{key:"initEvents",value:function(){var e={};this.eventList=["load","error","stop","start"],this.eventList.forEach((function(t){e[t]=new Event("vectorly-upscaler-"+t)})),this.events=e}},{key:"on",value:function(e,t){return document.addEventListener("vectorly-upscaler-"+e,t),this}},{key:"getResizeObserver",value:function(e){return new v.Z((function(t){var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}(t);try{for(n.s();!(r=n.n()).done;){var i=r.value.contentRect,a=i.width,s=i.height;e({w:a,h:s})}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"setRenderSize",value:function(e){var t=this.renderSize;this.debug&&console.log("Setting renderSize","w",e.w,"h",e.h),this.renderSize=e;var r=this.canvas;if(this.videoSize&&this.fixaspectratio){this.debug&&console.log("video",this.videoSize,"size",e);var n=this.videoSize.width/this.videoSize.height,i={},a={top:0,left:0,w:e.w,h:e.h};i.w=Math.round(e.h*n),i.h=Math.round(e.w/n),this.debug&&console.log("Expected w h",{w:i.w,h:e.h},{w:e.w,h:i.h}),i.w>e.w?(a.w=e.w,a.h=i.h,a.top=(e.h-a.h)/2):i.h>e.h&&(a.w=i.w,a.h=e.h,a.left=(e.w-a.w)/2),this.margin={left:Math.round(a.left),top:Math.round(a.top)},this.renderInputSize={w:a.w,h:a.h},this.metrics.renderSize=this.renderInputSize,this.debug&&console.log("this.margin",this.margin)}else this.renderInputSize=this.renderSize;this.debug&&console.log("===== IN setRenderSize",this.renderInputSize,this.renderSize,this.renderer),this.renderCanvas&&(this.renderCanvas.width=this.renderInputSize.w,this.renderCanvas.height=this.renderInputSize.h),this.renderer&&(this.glHandle.setRenderSize(this.renderInputSize),r.style.left="".concat(this.margin.left,"px"),r.style.top="".concat(this.margin.top,"px"),this.initialRender(),this.initRenderLoop(),this.trackAnalytics("Render Resize",{renderSize:this.metrics.renderSize,previousRenderSize:t}))}},{key:"setVideoSize",value:function(e){this.debug&&console.log("Setting videoSize to",e,"from",this.videoSize);var t=!1;if(this.videoSize){var r={currentSrc:this.video.currentSrc!==this.videoSrc.currentSrc,srcObject:this.video.srcObject!==this.videoSrc.srcObject};r.currentSrc||r.srcObject?(this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF=!0,t=!0):t=e.width!==this.videoSize.width||e.height!==this.videoSize.height}else this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},t=!0;if(t){var n=this.inputChangePreHook({before:this.videoSize,after:e},this);this.videoSize=e,this.trackAnalytics("Video Resize",{videoSize:e,previousVideoSize:this.videoSize,resizedProcessed:n}),n?(this.inputSize={w:e.width,h:e.height},this.renderer&&this.glHandle.setInputSize(this.inputSize),this.renderSize&&this.setRenderSize(this.renderSize)):(this.debug&&console.log("not changing as Prehook for inputChange returned",n),this.disable())}}},{key:"initializeNetwork",value:(c=(0,n.Z)(u().mark((function e(t){var r,n,i,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.debug&&console.log("Waiting for",this.canvas.id),r=(0,h.br)("canvas#"+this.canvas.id),n=(0,h.uF)(t),e.next=6,Promise.all([r,n,this.instantiateP]);case 6:return this.debug&&console.log("Found canvas ",this.canvas.id),e.next=9,n;case 9:return i=e.sent,this.setVideoSize(i),t.addEventListener("resize",(function(){a.setVideoSize({width:t.videoWidth,height:t.videoHeight}),a.metrics.originalSize={w:t.videoWidth,h:t.videoHeight},t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){this.renderAFrame()}.bind(a))})),this.renderSize=this.renderSize||{w:1278,h:720},this.setRenderSize(this.renderSize),e.next=16,this.initializeWebGL();case 16:return e.abrupt("return",!0);case 19:return e.prev=19,e.t0=e.catch(0),this.error=e.t0,e.abrupt("return",!1);case 23:case"end":return e.stop()}}),e,this,[[0,19]])}))),function(e){return c.apply(this,arguments)})},{key:"renderAFrame",value:(o=(0,n.Z)(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.debugRender&&(this.lastTime=this.lastTime||Date.now(),this.currentTime=Date.now(),console.log("renderAFrame",t,this.currentTime-this.lastTime),this.lastTime=this.currentTime),e.next=3,this.glHandle.render({passthrough:this.passthrough});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return this.renderContext&&this.renderContext.transferFromImageBitmap(r.bitmap),r.bitmap.close(),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"initializeWebGL",value:(i=(0,n.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("Initializing WebGL context and network",this.inputSize,this.renderInputSize),e.prev=1,e.next=4,this.glHandle.initWebGLContext(this.offscreen,{h:this.inputSize.h,w:this.inputSize.w,use_webgl1:this.use_webgl1,float_type:this.float_type});case 4:this.gl=e.sent,this.debug&&console.log("this.gl initialized",this.gl.input),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.gl=null;case 11:if(!this.gl){e.next=29;break}return this.initialized=this.glHandle.instantiateNetwork(this.networkOptions),e.next=15,this.initialized;case 15:return this.frameBuffer=e.sent,e.next=18,this.glHandle.initRenderer(this.renderInputSize);case 18:this.renderer=e.sent,this.debug&&console.log("this.renderer",this.renderer),this.canvas.style.left="".concat(this.margin.left,"px"),this.canvas.style.top="".concat(this.margin.top,"px"),this.debug&&console.log("this.stream",this.stream),this.glHandle._setInput(this.stream),this.initialRender(),this.initVideoEventRender(),this.initRenderLoop(),e.next=31;break;case 29:document.dispatchEvent(this.events.error),this.disable();case 31:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return i.apply(this,arguments)})},{key:"initRenderLoop",value:function(){var e=this.video;(0,h.yA)(this.video)&&this.render(),e.addEventListener("play",function(){this.render()}.bind(this)),document.dispatchEvent(this.events.load)}},{key:"initialRender",value:function(){var e=this,t=this.video;this.debug&&console.log("Calling Initial Render"),4===t.readyState&&setTimeout((function(){e.renderAFrame()}),100),t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){if((0,h.yA)(t))return null;this.renderAFrame()}.bind(this))}},{key:"initVideoEventRender",value:function(){var e=this.video;e.oncanplaythrough=function(){this.renderAFrame()}.bind(this),e.onloadeddata=function(){this.renderAFrame()}.bind(this)}},{key:"updateFrameMetrics",value:function(){var e=this.updateInterval||5e3;if(this.frames.rendered.total++,this.frames.rendered.sinceTimestamp++,this.metrics.upscaledFrames++,performance.now()-this.prv>e){this.metrics.fps=JSON.parse(JSON.stringify(this.frames.rendered.sinceTimestamp))/(e/1e3),this.prv=performance.now(),this.frames.rendered.sinceTimestamp=0;var t=this.video,r=t.webkitDecodedFrameCount||t.mozPresentedFrames||t.decodedFrames||t.presentedFrames;r&&(this.frames.video.total=r,this.metrics.videoFrames=r,this.metrics.droppedFrames=this.metrics.videoFrames-this.metrics.upscaledFrames,this.debug&&this.debug&&console.log("currentTime: ".concat(this.video.currentTime,", FPS: ").concat(this.metrics.fps,", Dropped frames: ").concat(this.metrics.droppedFrames,", Video Frame: ").concat(this.metrics.videoFrames,", Rendered frames: ").concat(this.metrics.upscaledFrames)),this.trackAnalytics("Playback Metrics",{FPS:this.metrics.fps,droppedFrames:this.metrics.droppedFrames,videoFrames:this.metrics.videoFrames,upscaledFrames:this.metrics.upscaledFrames,currentTime:this.video.currentTime}))}}},{key:"renderVideoFrame",value:(r=(0,n.Z)(u().mark((function e(t){var r,n,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.debugRender&&console.log("Calling renderVideoFrame in a loop",t),!this.cancelledRenderers){e.next=7;break}if(!((r=this.cancelledRenderers.indexOf(t))>-1)){e.next=7;break}return delete this.cancelledRenderers[r],e.abrupt("return");case 7:if(!(this.video&&this.frameBuffer&&this.renderer)){e.next=27;break}return e.next=10,this.renderAFrame(t);case 10:if(n=e.sent,this.debug&&console.log("===========Updated",n),n&&(this.updateFrameMetrics(),this.metrics.frameCount+=1),!this.reqHandle.noDelay){e.next=27;break}if(!this.enabled){e.next=25;break}if(!n){e.next=21;break}return e.next=18,this.renderVideoFrame(t);case 18:return e.abrupt("return");case 21:return setTimeout((function(){return i.renderVideoFrame(t)}),16),e.abrupt("return");case 23:e.next=27;break;case 25:return document.dispatchEvent(this.events.stop),e.abrupt("return");case 27:(0,h.yA)(this.video)&&this.enabled?(this.debugRender&&console.log("calling requestFrame"),this.requestFrame(this.video,this.renderVideoFrame.bind(this)),this.isPlaying=!0):(this.debugRender&&console.log("STOPPED playing"),document.dispatchEvent(this.events.stop),this.isPlaying=!1),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),console.error("Error in renderVideoFrame",e.t0);case 33:case"end":return e.stop()}}),e,this,[[0,30]])}))),function(e){return r.apply(this,arguments)})},{key:"requestFrame",value:function(e,t){if(this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF){var r=(0,y.U7)(t);this.reqHandle.raf=r}else{var n=e.requestVideoFrameCallback(t);this.reqHandle.video=e,this.reqHandle.rfvc=n}}},{key:"updateNetworkOptions",value:(t=(0,n.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.glHandle.updateOptions(t);case 2:void 0!==t.passthrough&&(this.passthrough=t.passthrough);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"cancelLastRender",value:function(){if(this.debugRender&&console.log("Canceling last render"),this.reqHandle=this.reqHandle||{},this.reqHandle.noDelay&&this.previousRenderCaller&&(this.cancelledRenderers=this.cancelledRenderers||[],this.cancelledRenderers.push("my-render-".concat(this.previousRenderCaller))),this.reqHandle.rfvc){var e=this.reqHandle,t=e.video,r=e.rfvc;t.cancelVideoFrameCallback(r),this.reqHandle.rfvc=null}if(this.reqHandle.raf){var n=this.reqHandle.raf;(0,y.Wx)(n),this.reqHandle.raf=null}}},{key:"render",value:function(){this.previousRenderCaller=this.renderCaller,this.renderCaller=(this.renderCaller||0)+1,this.debugRender&&console.log("Starting render call with isPlaying",this.isPlaying),this.prv=performance.now(),this.cancelLastRender(),this.renderVideoFrame("my-render-".concat(this.renderCaller)),document.dispatchEvent(this.events.start)}},{key:"initCanvas",value:function(){var e=document.createElement("canvas");e.id="canv-"+this.id,e.style.position="absolute",e.style.left=this.margin.left,e.style.top=this.margin.top;var t=document.createElement("canvas");this.renderContext=t.getContext("bitmaprenderer"),this.renderCanvas=t,window.upscalers=window.upscalers||{},window.upscalers[e.id]=this;var r=e.transferControlToOffscreen();return{canvas:e,offscreen:r}}}]),e}(),T=E},296:function(e,t,r){"use strict";r.r(t);var n=r(861),i=r(671),a=r(144),s=r(757),o=r.n(s),u=r(706),c=r(33),l=r(55),h=r(877),f=r(820);function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var p=function(){function e(t,r){(0,i.Z)(this,e),(0,l.ok)()&&console.log("Initialized upscaler with",t);var n=r;switch(this.video=t,this.id=n.id||(0,h.v4)(),this.videoParent=t.parentNode,this.token=n.token,this.serverType=n.serverType,this.fixaspectratio=n.fixaspectratio||!0,this.inputChangePreHook=n.inputChangePreHook||function(){return!0},this.renderSize=n.renderSize,"disable"===n.container?this.container=null:this.container=n.container||t.parentNode,(0,l.ok)()&&console.log("Container is",this.container),this.container&&(this.container.style.background="black",this.container.style.resize="both",this.container.style.overflow="hidden",this.ro=this.getResizeObserver(this.setRenderSize.bind(this)),this.ro.observe(this.container)),this.margin={top:0,left:0},this.use_webgl1=n.use_webgl1||"false",this.float_type=n.float_type||"float16",this.scale=n.scale||3,n.networkParams=n.networkParams||{},this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"},this.networkParams=Object.assign(this.networkParams,n.networkParams),this.networkOptions=n.networkOptions||{},(n.network||n.tag||n.version)&&(this.networkParams.name=n.network||this.networkParams.name,this.networkParams.tag=n.tag||this.networkParams.tag,"residual_3k_3x"===this.networkParams.name?this.networkParams.version=n.version||n.networkParams.version||"2.1":this.networkParams.version=n.version||n.networkParams.version||"0"),"residual_3k"===n.network?this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"}:"residual_5k"===n.network&&(this.networkParams={name:"residual_5k_3x",tag:"general",version:"0"}),this.networkParams.name){case"residual_3k_3x":case"residual_5k_3x":case"residual_4k_3x":case"residual_4k_2x":case"residual_10k_1x":case"cnn_demo":this.networkType="upscaler";break;case"background_selfie":case"background_webgl":case"background_webgl2":case"background_webgl_unet":this.networkType="background";break;default:console.warning("INVALID networkType for network with params",this.networkParams),this.networkType="INVALID"}this.canvas=this.initCanvas(),this.instantiateP=this.instantiateNetwork(),this.setupMetrics(),this.initEvents(),this.reqHandle={useRAF:!("requestVideoFrameCallback"in HTMLVideoElement.prototype)},this.enable(),this.isPlaying=!1,this.playerInitTime=Date.now(),this.initialized=this.initializeNetwork(t),this.error=null,this.analyticsEnabled=!1,this.debug=!0===n.debug,this.debugRender=!0===n.debugRender,this.initAnalytics()}var t,r,s,p,g,m,v;return(0,a.Z)(e,[{key:"initAnalytics",value:(v=(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)})},{key:"trackEventListener",value:function(e){var t=this;return function(){t.debug&&console.log("TrackEventListener",e),t.trackAnalytics(e+" Event",{upscale:t.enabled,type:t.events[e].type,currentTime:t.video.currentTime})}}},{key:"trackAnalytics",value:function(e,t){this.debug&&console.log("Tracking",e,t)}},{key:"setupMetrics",value:function(){this.prv=performance.now(),this.frames={rendered:{sinceTimestamp:0,total:0},video:{total:0}},this.metrics={renderSize:{w:1278,h:720},originalSize:{w:this.video.videoWidth,h:this.video.videoHeight},upscaleFactor:this.scale,droppedFrames:0,fps:0,upscaledFrames:0,videoFrames:0}}},{key:"changeNetwork",value:(m=(0,n.Z)(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("Changing network from",this.networkParams,"to",t),this.networkParams.name=t.name||this.networkParams.name,this.networkParams.tag=t.tag||this.networkParams.tag,this.networkParams.version=t.version||this.networkParams.version,e.next=6,(0,l.re)(this.networkParams,this.token,this.serverType);case 6:return r=e.sent,e.prev=7,n=(0,u.ZS)(this.networkParams.name,this.networkParams.tag,this.networkParams.version,r),e.next=11,(0,u.Hy)(this.networkParams.name,r);case 11:return this.NetworkClass=e.sent,e.next=14,n;case 14:this.networkParameters=e.sent,this.frameBuffer.clearall(),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.renderer.changeNetwork(this.networkInstance),this.renderSize&&this.setRenderSize(this.renderSize),this.render(),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(7),console.error("Error fetching network parameters and model or changing model",e.t0),document.dispatchEvent(this.events.error),this.disable();case 28:case"end":return e.stop()}}),e,this,[[7,23]])}))),function(e){return m.apply(this,arguments)})},{key:"instantiateNetwork",value:(g=(0,n.Z)(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.re)(this.networkParams,this.token,this.serverType);case 2:return t=e.sent,e.prev=3,"background"===this.networkType&&this.networkOptions.background&&(r=this.preloadBackground(this.networkOptions.background.image)),n=(0,u.ZS)(this.networkParams.name,this.networkParams.tag,this.networkParams.version,t),e.next=8,(0,u.Hy)(this.networkParams.name,t);case 8:return this.NetworkClass=e.sent,e.next=11,n;case 11:if(this.networkParameters=e.sent,!r){e.next=15;break}return e.next=15,r;case 15:this.container?this.container.insertBefore(this.canvas,this.video.nextSibling):document.body.appendChild(this.canvas),e.next=26;break;case 18:throw e.prev=18,e.t0=e.catch(3),console.error("Error in instantiateNetwork",e.t0),document.dispatchEvent(this.events.error),this.initialized=!1,this.error=e.t0,this.disable(),e.t0;case 26:case"end":return e.stop()}}),e,this,[[3,18]])}))),function(){return g.apply(this,arguments)})},{key:"disable",value:function(){var e=this.video;e.style.height="100%",e.style.width="100%",this.canvas.style.visibility="hidden",e.style.visibility="visible",this.enabled=!1,this.trackAnalytics("Disabled",{upscale:this.enabled})}},{key:"enable",value:function(){this.video.style.visibility="hidden",this.canvas.style.visibility="visible",this.enabled=!0,(0,l.yA)(this.video)&&this.render(),this.trackAnalytics("Enabled",{upscale:this.enabled})}},{key:"initEvents",value:function(){var e={};this.eventList=["load","error","stop","start"],this.eventList.forEach((function(t){e[t]=new Event("vectorly-upscaler-"+t)})),this.events=e}},{key:"on",value:function(e,t){return document.addEventListener("vectorly-upscaler-"+e,t),this}},{key:"getResizeObserver",value:function(e){return new c.Z((function(t){var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}(t);try{for(n.s();!(r=n.n()).done;){var i=r.value.contentRect,a=i.width,s=i.height;e({w:a,h:s})}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"setRenderSize",value:function(e){var t=this.renderSize;this.debug&&console.log("Setting renderSize","w",e.w,"h",e.h),this.renderSize=e;var r=this.canvas;if(this.videoSize&&this.fixaspectratio){this.debug&&console.log("video",this.videoSize,"size",e);var n=this.videoSize.width/this.videoSize.height,i={},a={top:0,left:0,w:e.w,h:e.h};i.w=Math.round(e.h*n),i.h=Math.round(e.w/n),this.debug&&console.log("Expected w h",{w:i.w,h:e.h},{w:e.w,h:i.h}),i.w>e.w?(a.w=e.w,a.h=i.h,a.top=(e.h-a.h)/2):i.h>e.h&&(a.w=i.w,a.h=e.h,a.left=(e.w-a.w)/2),this.margin={left:Math.round(a.left),top:Math.round(a.top)},this.renderInputSize={w:a.w,h:a.h},this.metrics.renderSize=this.renderInputSize,this.debug&&console.log("this.margin",this.margin)}else this.renderInputSize=this.renderSize;this.debug&&console.log("===== IN setRenderSize",this.renderInputSize,this.renderSize,this.renderer),this.renderer&&(this.renderer.setProperties(this.renderInputSize),r.style.left="".concat(this.margin.left,"px"),r.style.top="".concat(this.margin.top,"px"),this.initialRender(),this.initRenderLoop(),this.trackAnalytics("Render Resize",{renderSize:this.metrics.renderSize,previousRenderSize:t}))}},{key:"setVideoSize",value:function(e){this.debug&&console.log("Setting videoSize to",e,"from",this.videoSize);var t=!1;if(this.videoSize){var r={currentSrc:this.video.currentSrc!==this.videoSrc.currentSrc,srcObject:this.video.srcObject!==this.videoSrc.srcObject};r.currentSrc||r.srcObject?(this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF=!0,t=!0):t=e.width!==this.videoSize.width||e.height!==this.videoSize.height}else this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},t=!0;if(t){var n=this.inputChangePreHook({before:this.videoSize,after:e},this);this.videoSize=e,this.trackAnalytics("Video Resize",{videoSize:e,previousVideoSize:this.videoSize,resizedProcessed:n}),n?(this.inputSize={w:e.width,h:e.height},this.renderer&&this.renderer.setInputSize(this.inputSize),this.renderSize&&this.setRenderSize(this.renderSize)):(this.debug&&console.log("not changing as Prehook for inputChange returned",n),this.disable())}}},{key:"initializeNetwork",value:(p=(0,n.Z)(o().mark((function e(t){var r,n,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.debug&&console.log("Waiting for",this.canvas.id),r=(0,l.br)("canvas#"+this.canvas.id),n=(0,l.uF)(t),e.next=6,Promise.all([r,n,this.instantiateP]);case 6:return this.debug&&console.log("Found canvas ",this.canvas.id),e.next=9,n;case 9:return i=e.sent,this.setVideoSize(i),t.addEventListener("resize",(function(){a.setVideoSize({width:t.videoWidth,height:t.videoHeight}),a.metrics.originalSize={w:t.videoWidth,h:t.videoHeight},t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){this.renderAFrame()}.bind(a))})),this.renderSize=this.renderSize||{w:1278,h:720},this.setRenderSize(this.renderSize),this.initializeWebGL(),e.abrupt("return",!0);case 18:return e.prev=18,e.t0=e.catch(0),this.error=e.t0,e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return p.apply(this,arguments)})},{key:"renderAFrame",value:function(){this.frameBuffer&&this.frameBuffer.setInputImage(this.video),this.renderer&&this.renderer.render()}},{key:"initializeWebGL",value:(s=(0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.debug&&console.log("Initializing WebGL context and network",this.inputSize,this.renderInputSize);try{this.gl=new u.yb(this.canvas.id,{h:this.inputSize.h,w:this.inputSize.w,use_webgl1:this.use_webgl1,float_type:this.float_type}),this.debug&&console.log("this.gl initialized",this.gl.input)}catch(e){console.warn("Error in intializing WebGLContext",e),this.gl=null}if(!this.gl){e.next=17;break}return this.frameBuffer=new u.uL(this.gl),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.initialized=this.networkInstance.initialized,e.next=9,this.initialized;case 9:this.renderer=new u.Th(this.gl,this.networkInstance,this.frameBuffer,this.renderInputSize),this.canvas.style.left="".concat(this.margin.left,"px"),this.canvas.style.top="".concat(this.margin.top,"px"),this.initialRender(),this.initVideoEventRender(),this.initRenderLoop(),e.next=19;break;case 17:document.dispatchEvent(this.events.error),this.disable();case 19:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"initRenderLoop",value:function(){var e=this.video;(0,l.yA)(this.video)&&this.render(),e.addEventListener("play",function(){this.render()}.bind(this)),document.dispatchEvent(this.events.load)}},{key:"initialRender",value:function(){var e=this,t=this.video;this.debug&&console.log("Calling Initial Render"),4===t.readyState&&setTimeout((function(){e.renderAFrame()}),100),t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){if((0,l.yA)(t))return null;this.renderAFrame()}.bind(this))}},{key:"initVideoEventRender",value:function(){var e=this.video;e.oncanplaythrough=function(){this.renderAFrame()}.bind(this),e.onloadeddata=function(){this.renderAFrame()}.bind(this)}},{key:"updateFrameMetrics",value:function(){if(this.frames.rendered.total++,this.frames.rendered.sinceTimestamp++,this.metrics.upscaledFrames++,performance.now()-this.prv>1e4){this.metrics.fps=JSON.parse(JSON.stringify(this.frames.rendered.sinceTimestamp)),this.prv=performance.now(),this.frames.rendered.sinceTimestamp=0;var e=this.video,t=e.webkitDecodedFrameCount||e.mozPresentedFrames||e.decodedFrames||e.presentedFrames;t&&(this.frames.video.total=t,this.metrics.videoFrames=t,this.metrics.droppedFrames=this.metrics.videoFrames-this.metrics.upscaledFrames,this.debug&&console.log("currentTime: ".concat(this.video.currentTime,", FPS: ").concat(this.metrics.fps,", Dropped frames: ").concat(this.metrics.droppedFrames,", Video Frame: ").concat(this.metrics.videoFrames,", Rendered frames: ").concat(this.metrics.upscaledFrames)),this.trackAnalytics("Playback Metrics",{FPS:this.metrics.fps,droppedFrames:this.metrics.droppedFrames,videoFrames:this.metrics.videoFrames,upscaledFrames:this.metrics.upscaledFrames,currentTime:this.video.currentTime}))}}},{key:"renderVideoFrame",value:function(e){try{this.debugRender&&console.log("Calling renderVideoFrame in a loop",e),this.video&&this.frameBuffer&&this.renderer&&(this.renderAFrame(),this.updateFrameMetrics()),(0,l.yA)(this.video)&&this.enabled?(this.debugRender&&console.log("calling requestFrame"),this.requestFrame(this.video,this.renderVideoFrame.bind(this)),this.isPlaying=!0):(this.debugRender&&console.log("STOPPED playing"),document.dispatchEvent(this.events.stop),this.isPlaying=!1)}catch(e){console.error("Error in renderVideoFrame",e)}}},{key:"requestFrame",value:function(e,t){if(this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF){var r=(0,f.U7)(t);this.reqHandle.raf=r}else{var n=e.requestVideoFrameCallback(t);this.reqHandle.video=e,this.reqHandle.rfvc=n}}},{key:"updateNetworkOptions",value:(r=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.networkInstance.updateOptions(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"cancelLastRender",value:function(){if(this.debugRender&&console.log("Canceling last render"),this.reqHandle=this.reqHandle||{},this.reqHandle.rfvc){var e=this.reqHandle,t=e.video,r=e.rfvc;t.cancelVideoFrameCallback(r),this.reqHandle.rfvc=null}if(this.reqHandle.raf){var n=this.reqHandle.raf;(0,f.Wx)(n),this.reqHandle.raf=null}}},{key:"preloadBackground",value:(t=(0,n.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!=typeof t){e.next=9;break}return e.next=4,fetch(t);case 4:return r=e.sent,e.next=7,r.blob();case 7:return self.preloadedBackground=e.sent,e.abrupt("return",!0);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),console.warn("Vectorly: unable to load ".concat(t," as a background image")),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e){return t.apply(this,arguments)})},{key:"render",value:function(){this.renderCaller=(this.renderCaller||0)+1,this.debugRender&&console.log("Starting render call with isPlaying",this.isPlaying),this.prv=performance.now(),this.cancelLastRender(),this.renderVideoFrame("my-render-".concat(this.renderCaller)),document.dispatchEvent(this.events.start)}},{key:"initCanvas",value:function(){var e=document.createElement("canvas");return e.id="canv-"+this.id,e.style.position="absolute",e.style.left=this.margin.left,e.style.top=this.margin.top,window.upscalers=window.upscalers||{},window.upscalers[e.id]=this,e}}]),e}();t.default=p},55:function(e,t,r){"use strict";r.d(t,{br:function(){return s},uF:function(){return o},yA:function(){return u},re:function(){return f},Qy:function(){return d},ok:function(){return p}});var n=r(861),i=r(757),a=r.n(i);function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;return new Promise((function(r,n){var i=document.querySelector(e),a=setTimeout((function(){n("waitForElement failed for"+e)}),t);if(i)r(i);else{var s=new MutationObserver((function(t){t.forEach((function(t){for(var n=0,i=Array.from(t.addedNodes);n<i.length;n++){var o=i[n];if(o.matches&&o.matches(e))return s.disconnect(),r(o),void clearTimeout(a)}}))}));s.observe(document.documentElement,{childList:!0,subtree:!0})}}))}function o(e){return new Promise((function(t,r){if(e instanceof HTMLVideoElement){if(e.videoWidth*e.videoHeight>0)return void t({width:e.videoWidth,height:e.videoHeight});e.onloadedmetadata=function(){t({width:e.videoWidth,height:e.videoHeight})},e.onerror=function(){r()}}else e instanceof HTMLImageElement&&t({width:e.naturalWidth,height:e.naturalHeight})}))}var u=function(e){return e instanceof HTMLMediaElement?!(e.paused||e.ended):e instanceof HTMLImageElement||void 0},c=function(e){var t,r=e||"production";switch(r){case"local":t="http://localhost:4000";break;case"staging":t="https://stream-staging.vectorly.io";break;default:t="https://stream.vectorly.io"}return t},l=function(){var e="1.6.10";return"https://cdn.vectorly.io/ai-filters/v1/".concat(e,"/")},h=function(){var e=(0,n.Z)(a().mark((function e(t,r,n){var i,s,o,u,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l(),s="".concat(c(n),"/upscaler/models/").concat(t.name,"?token=").concat(r,"&path=").concat(encodeURI(i),"&version=").concat(t.version,"&tag=").concat(t.tag),e.next=4,fetch(s);case 4:if(!(o=e.sent).ok){e.next=14;break}return e.next=8,o.json();case 8:return u=e.sent,h=u.token,e.abrupt("return",h);case 14:case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),f=function(){var e=(0,n.Z)(a().mark((function e(t,r,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={path:l()},!n||"staging"!==n&&"local"!==n){e.next=13;break}return e.prev=2,e.next=5,h(t,r,n);case 5:i.token=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Error while fetching token in staging, defaulting to local files",e.t0);case 11:e.next=16;break;case 13:return e.next=15,h(t,r,n);case 15:i.token=e.sent;case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r,n){return e.apply(this,arguments)}}();function d(){var e={};return["load","error","stop","start"].forEach((function(t){e[t]=new Event("vectorly-upscaler-"+t)})),e}function p(){return!1}},841:function(e,t,r){"use strict";r.r(t);var n=r(861),i=r(671),a=r(144),s=r(757),o=r.n(s),u=r(706),c=r(877),l=r(55),h=function(){function e(){(0,i.Z)(this,e),this.events=(0,l.Qy)()}var t,r,s,h,f,d,p,g;return(0,a.Z)(e,[{key:"load",value:(g=(0,n.Z)(o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}throw console.log("load: "),document.dispatchEvent(this.events.error),new Error("Invalid load config");case 4:return this.token=t.token,this.serverType=t.serverType,r=this.initCanvasWebGL(t),n=this.initFrameBufferWebGL(r),e.next=10,this.importNetwork(n,t.networkParams,t.networkOptions);case 10:return i=e.sent,this.networkInstance=i,e.next=14,this.initRenderer(i,n,t.renderSize);case 14:this.renderer=e.sent;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"on",value:function(e,t){return document.addEventListener("vectorly-upscaler-"+e,t),this}},{key:"initCanvasWebGL",value:function(e){try{return e&&e.canvas&&e.w&&e.h,(0,u.yb)(e.canvas,e)}catch(e){throw console.error("Error in initCanvasWebGL: ",e),document.dispatchEvent(this.events.error),e}}},{key:"initFrameBufferWebGL",value:function(e){try{if(!e)throw new Error("WebGLContext not found");return new u.uL(e)}catch(e){throw console.error("Error in initFrameBufferWebGL: ",e),document.dispatchEvent(this.events.error),e}}},{key:"importNetwork",value:(p=(0,n.Z)(o().mark((function e(t,r,n){var i,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.clearall()&&r.name&&r.tag&&r.version,e.next=4,(0,l.re)(r,this.token,this.serverType);case 4:return i=e.sent,e.next=7,(0,u.ZS)(r.name,r.tag,r.version,i);case 7:return a=e.sent,e.next=10,(0,u.Hy)(r.name,i);case 10:return s=e.sent,n.networkParams=r,c=new s(t.gl,t,a,n),e.abrupt("return",c);case 16:throw e.prev=16,e.t0=e.catch(0),console.error("Error in importNetwork: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 21:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t,r){return p.apply(this,arguments)})},{key:"updateNetworkOptions",value:(d=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.renderer,!e.t0){e.next=4;break}return e.next=4,this.renderer;case 4:if(e.t1=this.networkInstance,!e.t1){e.next=8;break}return e.next=8,this.networkInstance.updateOptions(t);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"initRenderer",value:(f=(0,n.Z)(o().mark((function e(t,r,n){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,null==n&&(n={}),e.next=4,t;case 4:return t=e.sent,i=new u.Th(r.gl,t,r,n),document.dispatchEvent(this.events.load),e.abrupt("return",i);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error in initRenderer: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t,r){return f.apply(this,arguments)})},{key:"render",value:(h=(0,n.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.renderer;case 3:(t=e.sent)&&t.render(),e.next=12;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.error("Error in render: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return h.apply(this,arguments)})},{key:"updateInputResolution",value:(s=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.w&&t.h||console.warn("warning: Invalid InputSize width and height"),e.next=4,this.renderer;case 4:e.sent.setInputSize(t),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in updateInputResolution: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return s.apply(this,arguments)})},{key:"updateRenderResolution",value:(r=(0,n.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.w&&t.h||console.warn("warning: Invalid renderSize width and height passed"),e.next=4,this.renderer;case 4:e.sent.setProperties(t),e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in updateInputResolution: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"setInput",value:(t=(0,n.Z)(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.renderer;case 3:(r=e.sent).frameBuffer.setInputImage(t),r.frameBuffer.iterations+=1,e.next=13;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("Error in setInput: ",e.t0),document.dispatchEvent(this.events.error),e.t0;case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return t.apply(this,arguments)})},{key:"createCanvas",value:function(e){try{var t=document.createElement("canvas");return t.id=e.id||"canv-"+(0,c.v4)(),t.width=e.w||100,t.height=e.h||100,t}catch(e){throw console.error("Error in canvasConfig: ",e),document.dispatchEvent(this.events.error),e}}}]),e}();t.default={core:h}},444:function(e){"use strict";e.exports=e=>{if("string"!=typeof e)throw new TypeError(`Expected a \`string\`, got \`${typeof e}\``);return!/^[a-zA-Z]:\\/.test(e)&&/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e)}},190:function(e,t,r){"use strict";const n=r(444);e.exports=e=>!n(e)},820:function(e,t,r){"use strict";r.d(t,{Wx:function(){return f},U7:function(){return h}}),e=r.hmd(e);let n=1;const i="object"==typeof self&&self.self==self?self:"object"==typeof r.g&&r.g.global==r.g?r.g:{},a=Date.now();let s={},o=Date.now();const u=e=>{if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=Date.now(),r=t-o,u=r>16?0:16-r,c=n++;return s[c]=e,Object.keys(s).length>1||setTimeout((()=>{o=t;const e=s;s={},Object.keys(e).forEach((t=>e[t](i.performance&&"function"==typeof i.performance.now?i.performance.now():Date.now()-a)))}),u),c},c=e=>"string"!=typeof e?u:""===e?i.requestAnimationFrame:i[e+"RequestAnimationFrame"],l=((e,t)=>{let r=0;for(;void 0!==e[r];){if(t(e[r]))return e[r];r+=1}})(["","webkit","moz","ms","o"],(e=>!!c(e))),h=c(l),f="string"!=typeof(d=l)?e=>{delete s[e]}:""===d?i.cancelAnimationFrame:i[d+"CancelAnimationFrame"]||i[d+"CancelRequestAnimationFrame"];var d;i.requestAnimationFrame=h,i.cancelAnimationFrame=f,e.exports&&(e.exports={requestAnimationFrame:h,cancelAnimationFrame:f})},33:function(e,t,r){"use strict";var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var r=-1;return e.some((function(e,n){return e[0]===t&&(r=n,!0)})),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var r=e(this.__entries__,t),n=this.__entries__[r];return n&&n[1]},t.prototype.set=function(t,r){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=r:this.__entries__.push([t,r])},t.prototype.delete=function(t){var r=this.__entries__,n=e(r,t);~n&&r.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var r=0,n=this.__entries__;r<n.length;r++){var i=n[r];e.call(t,i[1],i[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,a=void 0!==r.g&&r.g.Math===Math?r.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(a):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)},o=["top","right","bottom","left","width","height","size","weight"],u="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var r=!1,n=!1,i=0;function a(){r&&(r=!1,e()),n&&u()}function o(){s(a)}function u(){var e=Date.now();if(r){if(e-i<2)return;n=!0}else r=!0,n=!1,setTimeout(o,20);i=e}return u}(this.refresh.bind(this))}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,r=t.indexOf(e);~r&&t.splice(r,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),u?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,r=void 0===t?"":t;o.some((function(e){return!!~r.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),l=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},h=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||a},f=v(0,0,0,0);function d(e){return parseFloat(e)||0}function p(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce((function(t,r){return t+d(e["border-"+r+"-width"])}),0)}var g="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof h(e).SVGGraphicsElement}:function(e){return e instanceof h(e).SVGElement&&"function"==typeof e.getBBox};function m(e){return i?g(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):function(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return f;var n=h(e).getComputedStyle(e),i=function(e){for(var t={},r=0,n=["top","right","bottom","left"];r<n.length;r++){var i=n[r],a=e["padding-"+i];t[i]=d(a)}return t}(n),a=i.left+i.right,s=i.top+i.bottom,o=d(n.width),u=d(n.height);if("border-box"===n.boxSizing&&(Math.round(o+a)!==t&&(o-=p(n,"left","right")+a),Math.round(u+s)!==r&&(u-=p(n,"top","bottom")+s)),!function(e){return e===h(e).document.documentElement}(e)){var c=Math.round(o+a)-t,l=Math.round(u+s)-r;1!==Math.abs(c)&&(o-=c),1!==Math.abs(l)&&(u-=l)}return v(i.left,i.top,o,u)}(e):f}function v(e,t,r,n){return{x:e,y:t,width:r,height:n}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=m(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),w=function(e,t){var r,n,i,a,s,o,u,c=(n=(r=t).x,i=r.y,a=r.width,s=r.height,o="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(o.prototype),l(u,{x:n,y:i,width:a,height:s,top:i,right:n+a,bottom:s+i,left:n}),u);l(this,{target:e,contentRect:c})},b=function(){function e(e,t,r){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=r}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof h(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof h(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new w(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),_="undefined"!=typeof WeakMap?new WeakMap:new n,E=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=c.getInstance(),n=new b(t,r,this);_.set(this,n)};["observe","unobserve","disconnect"].forEach((function(e){E.prototype[e]=function(){var t;return(t=_.get(this))[e].apply(t,arguments)}}));var T=void 0!==a.ResizeObserver?a.ResizeObserver:E;t.Z=T},877:function(e,t,r){var n=r(570),i=r(171),a=i;a.v1=n,a.v4=i,e.exports=a},327:function(e){for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0,i=t;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},217:function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},570:function(e,t,r){var n,i,a=r(217),s=r(327),o=0,u=0;e.exports=function(e,t,r){var c=t&&r||0,l=t||[],h=(e=e||{}).node||n,f=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==f){var d=a();null==h&&(h=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==f&&(f=i=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:u+1,m=p-o+(g-u)/1e4;if(m<0&&void 0===e.clockseq&&(f=f+1&16383),(m<0||p>o)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=g,i=f;var v=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var y=p/4294967296*1e4&268435455;l[c++]=y>>>8&255,l[c++]=255&y,l[c++]=y>>>24&15|16,l[c++]=y>>>16&255,l[c++]=f>>>8|128,l[c++]=255&f;for(var w=0;w<6;++w)l[c+w]=h[w];return t||s(l)}},171:function(e,t,r){var n=r(217),i=r(327);e.exports=function(e,t,r){var a=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||n)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[a+o]=s[o];return t||i(s)}},618:function(e){"use strict";function t(e,t){if(!c)return!1;const n=e.buffer;let i=h.get(n);if(null==i){if((i=r.validate(n))&&t)try{new r.Instance(new r.Module(n)).exports[0]()}catch(e){i=!1}h.set(n,i)}return i}const r=WebAssembly,n=(...e)=>Uint8Array.of(0,97,115,109,1,0,0,0,...e),i=(...e)=>Uint32Array.of(1836278016,1,...e),a=(...e)=>i(1610679297,33751040,...e,40239360,259),s=(...e)=>n(1,4,1,96,0,0,3,2,1,0,...e,11,0,10,4,110,97,109,101,2,3,1,0,0),o=(...e)=>Uint16Array.of(24832,28019,1,0,1025,24577,0,515,1,...e),u=(...e)=>o(...e,2842,4096,28164,28001,357,260,256,560,259,0),c="object"==typeof r,l=e=>c&&"function"==typeof e,h=new WeakMap,f=i(1610679553,58589440,117440770,805372165,101318656,1107297281,268438272,1835101700,17039717,36700416,259),d=o(773,1,2561,269,11,65,65,65,3068,2816,2560,28164,28001,613,259,0),p=i(1610679297,33751040,134873089,100664833,185276736),g=n(2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1,0,8,4,110,97,109,101,2,1,0),m=Uint16Array.of(24832,28019,1,0,1537,24577,512,32639,515,1,2058,1537,16640,16640,2816,2560,28164,28001,613,259,0),v=u(3082,2561,17152,0,0,252),y=u(2058,1537,16640,49152),w=a(101318657,301990913,268438272,1835101700,17039717),b=s(5,4,1,3,1,1,10,7,1,5,0,254,3,0),_=a(84344833,6357249,17369600,4259847,186257917,1845758464),E=s(10,7,1,5,0,208,112,26);e.exports={support:(e=1)=>c&&t(Uint32Array.of(1836278016,e)),get supportStreaming(){return l(r.instantiateStreaming)},feature:{get bigInt(){return t(f,!0)},get bulk(){return t(d)},get exceptions(){return t(p)},get mutableGlobal(){return t(g)},get multiValue(){return t(m)},get saturateConversions(){return t(v)},get signExtensions(){return t(y)},get tailCall(){return t(w)},get threads(){return t(b)},get simd(){return t(_)},get references(){return t(E)},get typeReflection(){return l(r.Memory.type)},get funcReferences(){return l(r.Function)}}}},161:function(e,t){"use strict";t.HR=function(){if(void 0!==(null===window||void 0===window?void 0:window.WebGLRenderingContext)){var e=document.createElement("canvas");return null!=e.getContext("webgl")||null!=e.getContext("experimental-webgl")}return!1},t.W8=function(){return void 0!==(null===window||void 0===window?void 0:window.WebGLRenderingContext)&&null!=document.createElement("canvas").getContext("webgl2")}},477:function(e){"use strict";e.exports=function(e,t,r,n){var i=self||window;try{try{var a;try{a=new i.Blob([e])}catch(t){(a=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),a=a.getBlob()}var s=i.URL||i.webkitURL,o=s.createObjectURL(a),u=new i[t](o,r);return s.revokeObjectURL(o),u}catch(n){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),r)}}catch(e){if(!n)throw Error("Inline worker is not supported");return new i[t](n,r)}}},907:function(e,t,r){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}r.d(t,{Z:function(){return n}})},861:function(e,t,r){"use strict";function n(e,t,r,n,i,a,s){try{var o=e[a](s),u=o.value}catch(e){return void r(e)}o.done?t(u):Promise.resolve(u).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,a){var s=e.apply(t,r);function o(e){n(s,i,a,o,u,"next",e)}function u(e){n(s,i,a,o,u,"throw",e)}o(void 0)}))}}r.d(t,{Z:function(){return i}})},671:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{Z:function(){return n}})},144:function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,{Z:function(){return i}})},942:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{Z:function(){return n}})},885:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(181);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],s=!0,o=!1;try{for(r=r.call(e);!(s=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);s=!0);}catch(e){o=!0,i=e}finally{try{s||null==r.return||r.return()}finally{if(o)throw i}}return a}}(e,t)||(0,n.Z)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},181:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(907);function i(e,t){if(e){if("string"==typeof e)return(0,n.Z)(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?(0,n.Z)(e,t):void 0}}},147:function(e){"use strict";e.exports={i8:"1.6.10"}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={id:n,loaded:!1,exports:{}};return e[n](a,a.exports,r),a.loaded=!0,a.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var n={};return function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}r.d(n,{default:function(){return w}});var t=r(861),i=r(671),a=r(144),s=r(942),o=r(757),u=r.n(o),c=r(877),l=r(147),h=r(55),f=r(245),d=r(618),p=r(190),g=r.n(p);function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var v=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){(0,s.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},d.feature);(0,h.ok)()&&console.log(v),(0,h.ok)()&&console.log("SIMD",d.feature.simd);var y=function(){function r(e,t){(0,i.Z)(this,r),this.times={ref:Date.now()},this.times.init=Date.now()-this.times.ref,this.type="background",this.params=t||{},this.model=t.model||"selfie",this.model_version=t.version,this.enableOffscreen=this.checkSupport(t.offscreen),this.debug=this.params.debug||(0,h.ok)(),this.id=t.id||(0,c.v4)(),this.version=l.i8,this.serverType=this.params.serverType||"",this.defaults={},this.defaults.frameRate=30,this.defaults.segmentationFrameRate=15,this.frameRate=t.frameRate||this.defaults.frameRate,this.segmentationFrameRate=t.segmentationFrameRate||this.defaults.segmentationFrameRate,this.passthrough=t.passthrough||!1,"production"!==this.serverType&&""!==this.serverType||(0,f.EK)(e,t),this.defaultBackground="https://files.vectorly.io/demo/background-filter/images/virtual-background-1.jpg",this.defaultBlurRadius=5,this.background=this.params.background||this.defaultBackground,this.blurRadius=this.params.blurRadius||this.defaultBlurRadius,this.error=null,this.loadP=this.loadCore(this.enableOffscreen);try{this.input=this._getInput(e),this.inputClone=this.input?this.input.clone():null,this.registerInputListeners(),this.log("Input to BackgroundFilter is",this.input),this.video=this.video||this._initVideo(),this.video.id="vid-"+this.id,this.processorP=this._initializeCoreNetwork(),this.outputP=this._createNewStream()}catch(e){throw this.error=e,e}}var n,s,o,d,p,m,v,y,w,b,_,E,T,k;return(0,a.Z)(r,[{key:"loadCore",value:(k=(0,t.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.times.load_core_start=Date.now()-this.times.ref,e.next=3,(0,f.Zq)(t);case 3:return this.vectorlyCore=e.sent,e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"checkSupport",value:function(e){var t=Boolean(HTMLCanvasElement.prototype.transferControlToOffscreen);return null==e?t:!0===e||"true"===e?(t||console.warn("transferControlToOffscreen is not supported but params.offscreen is set to ".concat(e,"; Set params.offscreen to null to default to offscreen if supported")),!0):(this.log("params.offscreen is ".concat(e,"; running on main thread")),!1)}},{key:"registerInputListeners",value:function(){var e,t=this,r=this.input,n=this.originalInput;if(r instanceof MediaStream){n instanceof MediaStream?e=n.getVideoTracks():n instanceof MediaStreamTrack&&(e=[n]);var i=[];this.log("Input tracks in registerInputListeners",e,n);for(var a=0;a<e.length;a++){var s=e[a];this.log(a,"tracks",s.id),i.push(s.id),s.addEventListener("ended",(function(){t.log("In listener",t.stop),t.stop()}))}var o=this;MediaStreamTrack.prototype._stop=MediaStreamTrack.prototype._stop||MediaStreamTrack.prototype.stop,MediaStreamTrack.prototype._iter=(MediaStreamTrack.prototype._iter||-1)+1;var u=MediaStreamTrack.prototype._stop,c=MediaStreamTrack.prototype._inputFilterMap||{};i.forEach((function(e){c[e]=c[e]||[],c[e].push(o)})),MediaStreamTrack.prototype._inputFilterMap=c,0===MediaStreamTrack.prototype._iter&&(MediaStreamTrack.prototype.stop=function(){var e=arguments;o.log("in proto",e,this,o,i),u.call(this);var t=MediaStreamTrack.prototype._inputFilterMap[this.id];t&&t.forEach((function(e){e.stop()}))})}}},{key:"_getInput",value:function(t){if(this.log("_getInput",t),t instanceof MediaStream){this.originalInput=t;var r=this.originalInput.getVideoTracks()[0];this.frameRate=(this.params.frameRate?Math.min(this.params.frameRate,r.getSettings().frameRate):r.getSettings().frameRate)||this.defaults.frameRate,this.segmentationFrameRate=Math.min(this.frameRate,this.params.segmentationFrameRate||this.defaults.segmentationFrameRate);var n=Math.ceil(this.frameRate/this.segmentationFrameRate);return this.segmentationFrameRate=this.frameRate/n,this.log("_getInput ======= Original input fps is",r.getSettings().frameRate,r.getSettings()),t.clone()}if(t instanceof MediaStreamTrack){if("video"===t.kind){this.originalInput=t;var i=this.originalInput;this.frameRate=(this.params.frameRate?Math.min(this.params.frameRate,i.getSettings().frameRate):i.getSettings().frameRate)||this.defaults.frameRate,this.segmentationFrameRate=Math.min(this.frameRate,this.params.segmentationFrameRate||this.defaults.segmentationFrameRate);var a=Math.ceil(this.frameRate/this.segmentationFrameRate);return this.segmentationFrameRate=this.frameRate/a,this.log("_getInput ======= Original input fps is",i.getSettings().frameRate,i.getSettings()),new MediaStream([t.clone()])}var s="Input to BackgroundFilter is: ".concat(t,"; Expected input.kind to be video but it is ").concat(t.kind);throw console.error(s),new Error(s)}if(t instanceof HTMLMediaElement)return t.captureStream?t.captureStream():t.mozCaptureStream?t.mozCaptureStream():(this.video=t,null);var o;try{o=t.constructor.name}catch(r){o=e(t)}var u="In _getInput; input is of invalid type: type ".concat(o," - ").concat(t);throw console.error(u),new Error(u)}},{key:"_initializeCoreNetwork",value:(T=(0,t.Z)(u().mark((function e(){var t,r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.times.init_core_start=Date.now()-this.times.ref,e.next=3,(0,h.uF)(this.video);case 3:return t=e.sent,e.next=6,this.loadP;case 6:return this.times.load_core_done=Date.now()-this.times.ref,e.next=9,(0,f.$A)(this.model);case 9:if(e.sent){e.next=12;break}throw new Error("model ".concat(this.model," is not supported"));case 12:return e.t0=this.vectorlyCore,e.t1=this.video,e.t2=this.input,e.t3=this.params.token,e.t4=this.id,e.t5=(0,f.PD)(this.model),e.t6=Math.ceil(this.frameRate/this.segmentationFrameRate),e.next=21,this._getBackground(this.background);case 21:return e.t7=e.sent,e.t8={passthrough:!1,skipFactor:e.t6,background:e.t7},e.t9={w:t.width,h:t.height},e.t10=this.debug,e.t11=this.frameRate,e.t12=this.serverType,e.t13={stream:e.t2,token:e.t3,id:e.t4,networkParams:e.t5,networkOptions:e.t8,renderSize:e.t9,debug:e.t10,framerate:e.t11,debugRender:!1,container:"disable",serverType:e.t12,analyticsEnabled:!1},r=new e.t0(e.t1,e.t13),this.log(r,r.initialized),e.next=32,r.initialized;case 32:if(n=e.sent,this.log("In _initializeCoreNetwork",n,r),this.times.init_core_end=Date.now()-this.times.ref,!1!==n){e.next=38;break}throw this.log("Initialized is",this.initialized,r.error),new Error(r.error);case 38:return r.canvas.style.visibility="hidden",e.abrupt("return",{canvas:r.renderCanvas||r.canvas,processor:r});case 40:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"_getBackground",value:(E=(0,t.Z)(u().mark((function e(t){var r,n,i,a,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("blur"!==t){e.next=4;break}return e.abrupt("return",{type:"blur",radius:this.blurRadius});case 4:if("binary"!==t&&"transparent"!==t){e.next=8;break}return e.abrupt("return",{type:t});case 8:if(t&&"string"!=typeof t){e.next=18;break}return t?(n=t,g()(n)&&(n=document.URL.substr(0,document.URL.lastIndexOf("/"))+"/"+n)):(n=this.defaultBackground,console.warn("in background is not given; Setting to defaultBackground",this.defaultBackground)),e.next=12,(0,f.po)(n);case 12:return i=e.sent,e.next=15,createImageBitmap(i);case 15:r=e.sent,e.next=31;break;case 18:if(!(t instanceof HTMLImageElement)){e.next=27;break}return e.next=21,(0,f.po)(t);case 21:return e.next=23,createImageBitmap(t);case 23:return a=e.sent,e.abrupt("return",{type:"virtual",image:a});case 27:return e.next=29,createImageBitmap(t);case 29:return s=e.sent,e.abrupt("return",{type:"virtual",image:s});case 31:return e.abrupt("return",{type:"virtual",image:r});case 32:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"_getBlurRadius",value:function(e){return(!e||e<1)&&(console.warn("in blurRadius:",e,"should be greater than equal to 1; Setting to defaultBlurRadius",this.defaultBlurRadius),e=this.defaultBlurRadius),{type:"blur",radius:e}}},{key:"changeBackground",value:(_=(0,t.Z)(u().mark((function e(t){var r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("Change background to",t,"from",this.background),e.prev=1,e.next=4,this.processorP;case 4:return r=e.sent,n=r.processor,e.next=8,this._getBackground(t);case 8:return i=e.sent,e.next=11,n.updateNetworkOptions({background:i});case 11:this.background=t,e.next=18;break;case 14:throw e.prev=14,e.t0=e.catch(1),console.error(e.t0),e.t0;case 18:case"end":return e.stop()}}),e,this,[[1,14]])}))),function(e){return _.apply(this,arguments)})},{key:"requestFrameRate",value:(b=(0,t.Z)(u().mark((function e(t){var r,n,i,a,s,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.frameRate,n=t.segmentationFrameRate,this.log("Change frameRate to",r,"from",this.frameRate),e.prev=2,e.next=5,this.processorP;case 5:return i=e.sent,a=i.processor,this.frameRate=r||this.frameRate||this.defaults.frameRate,this.segmentationFrameRate=Math.min(this.frameRate,n||this.segmentationFrameRate||this.defaults.segmentationFrameRate),s=Math.ceil(this.frameRate/this.segmentationFrameRate),this.segmentationFrameRate=this.frameRate/s,e.next=13,a.updateNetworkOptions({framerate:this.frameRate,skipFactor:s});case 13:if(!a.glHandle||a.glHandle.framerate===this.frameRate){e.next=20;break}return this.log(a.glHandle.framerate,this.frameRate),this.frameRate=a.glHandle.framerate,o=Math.ceil(this.frameRate/this.segmentationFrameRate),this.segmentationFrameRate=this.frameRate/o,e.next=20,a.updateNetworkOptions({framerate:this.frameRate,skipFactor:o});case 20:return e.abrupt("return",{frameRate:this.frameRate,segmentationFrameRate:this.segmentationFrameRate});case 23:throw e.prev=23,e.t0=e.catch(2),console.error(e.t0),e.t0;case 27:case"end":return e.stop()}}),e,this,[[2,23]])}))),function(e){return b.apply(this,arguments)})},{key:"changeBlurRadius",value:(w=(0,t.Z)(u().mark((function e(t){var r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processorP;case 3:return r=e.sent,n=r.processor,this.log("Change blur radius to",t,"from",this.blurRadius),e.next=8,n.updateNetworkOptions({background:this._getBlurRadius(t)});case 8:this.blurRadius=t,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(0),console.error(e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e){return w.apply(this,arguments)})},{key:"_createNewStream",value:(y=(0,t.Z)(u().mark((function e(){var t,r,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processorP;case 3:return t=e.sent,r=t.canvas,n=t.processor,this.canvas=r,this.processor=n,this.processOutput=r.captureStream(),this.output=this.processOutput,e.abrupt("return",this.output);case 13:throw e.prev=13,e.t0=e.catch(0),console.error("ERROR in createNewStream",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(){return y.apply(this,arguments)})},{key:"_getOrCreateOutput",value:(v=(0,t.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.outputP;case 2:if("ended"!==(t=e.sent).getVideoTracks()[0].readyState){e.next=9;break}return this.outputP=this._createNewStream(),e.next=8,this.outputP;case 8:t=e.sent;case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getOutput",value:(m=(0,t.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getOrCreateOutput();case 3:return t=e.sent,e.abrupt("return",t);case 7:throw e.prev=7,e.t0=e.catch(0),console.error(this.error),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return m.apply(this,arguments)})},{key:"getOutputTrack",value:(p=(0,t.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._getOrCreateOutput();case 3:return t=e.sent,e.abrupt("return",t.getVideoTracks()[0]);case 7:throw e.prev=7,e.t0=e.catch(0),console.error(this.error),e.t0;case 11:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return p.apply(this,arguments)})},{key:"disable",value:(d=(0,t.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.processorP;case 2:if(!this.passthrough||!this.input.active){e.next=7;break}return e.next=5,this.processor.updateNetworkOptions({passthrough:!0});case 5:e.next=9;break;case 7:this.processor.disable(),this.output=this.inputClone;case 9:return this.video.style.visibility="hidden",e.abrupt("return",this.output);case 11:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"enable",value:(o=(0,t.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.processorP;case 2:if(!this.passthrough||!this.input.active){e.next=7;break}return e.next=5,this.processor.updateNetworkOptions({passthrough:!1});case 5:e.next=8;break;case 7:this.processor.enable();case 8:return this.output=this.processOutput,this.canvas.style.visibility="hidden",e.abrupt("return",this.output);case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_initVideo",value:function(){var e=document.createElement("video");return e.style.visibility="hidden",e.style.display="none",e.id="vid-"+this.id,e.setAttribute("playsinline",null),e.setAttribute("autoplay",null),e.srcObject=this.input,document.body.appendChild(e),(0,h.yA)(e)||e.play(),e}},{key:"_getVideoTrack",value:function(e){return e instanceof MediaStream?e.getVideoTracks()[0]:e instanceof MediaStreamTrack?"video"===e.kind?e:void console.warn("Error in _getVideoTrack; input.kind expected to be video but is",e.kind):void 0}},{key:"_isSameTrack",value:function(e,t){var r=this._getVideoTrack(e),n=this._getVideoTrack(t);return r&&n&&r.id===n.id}},{key:"changeInput",value:(s=(0,t.Z)(u().mark((function e(t){var r,n,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]&&i[1],!this._isSameTrack(t,this.originalInput)){e.next=4;break}return console.warn("changeInput called with same input as the one current filter is using; returning without changing"),e.abrupt("return");case 4:return r&&this.stop(),this.input=this._getInput(t),e.next=8,this.processorP;case 8:return this.input&&(this.inputClone=this.input?this.input.clone():null,this.video.srcObject=this.input,this.processor.updateStream&&this.processor.updateStream(this.input)),this.registerInputListeners(),e.next=12,(0,h.uF)(this.video);case 12:n=e.sent,this.processor.setRenderSize({w:n.width,h:n.height});case 14:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"stop",value:function(){var e=this.input.getVideoTracks();this.log("Stopping input tracks",this.input,e);for(var t=0;t<e.length;++t)e[t]._stop();if(this.originalInput)if(this.log("Original Input",this.originalInput),this.originalInput instanceof MediaStreamTrack)this.originalInput._stop();else if(this.originalInput instanceof MediaStream){e=this.originalInput.getTracks(),this.log("Stopping originalInput",this.originalInput,e);for(var r=0;r<e.length;++r)e[r]._stop()}e=this.inputClone.getVideoTracks(),this.log("Stopping",this.inputClone,e,this.inputClone.getTracks());for(var n=0;n<e.length;++n)e[n]._stop()}},{key:"destroy",value:(n=(0,t.Z)(u().mark((function e(){var t,r,n,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.processorP;case 2:t=e.sent,(r=t.processor).glHandle&&r.glHandle.destroy(),(n=document.getElementById("canv-"+r.id))&&n.remove(),(i=document.getElementById("vid-"+this.id))&&i.remove();case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"log",value:function(){this.debug&&console.log.apply(null,arguments)}}]),r}();y.isSupported=(0,t.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.Gb)();case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),y.isModelSupported=function(){var e=(0,t.Z)(u().mark((function e(t){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.$A)(t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y.checkPerformance=f.$_;var w=y}(),n.default}()}));