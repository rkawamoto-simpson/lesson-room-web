!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.vectorly=t():(e.vectorly=e.vectorly||{},e.vectorly.UpscaleFilter=t())}(self,(function(){return function(){var e={553:function(e){var t=function(e){"use strict";var t,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function c(e,t,r,n){var i=t&&t.prototype instanceof g?t:g,o=Object.create(i.prototype),a=new S(n||[]);return o._invoke=function(e,t,r){var n=l;return function(i,o){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=A(a,r);if(s){if(s===m)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=f(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,a),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l="suspendedStart",h="suspendedYield",d="executing",p="completed",m={};function g(){}function v(){}function y(){}var w={};u(w,o,(function(){return this}));var b=Object.getPrototypeOf,_=b&&b(b(O([])));_&&_!==r&&n.call(_,o)&&(w=_);var E=y.prototype=g.prototype=Object.create(w);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,o,a,s){var u=f(e[i],e,o);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(l).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,s)}))}s(u.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function A(e,r){var n=e.iterator[r.method];if(n===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,A(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=f(n,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(e){if(e){var r=e[o];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function r(){for(;++i<e.length;)if(n.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}return{next:P}}function P(){return{value:t,done:!0}}return v.prototype=y,u(E,"constructor",y),u(y,"constructor",v),v.displayName=u(y,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,s,"GeneratorFunction")),e.prototype=Object.create(E),e},e.awrap=function(e){return{__await:e}},T(x.prototype),u(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new x(c(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},T(E),u(E,s,"Generator"),u(E,o,(function(){return this})),u(E,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},e.values=O,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),R(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;R(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:O(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},757:function(e,t,r){e.exports=r(553)},706:function(e,t,r){"use strict";function n(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}function i(){return n()?(self.isWorker=!0,self):(window.isWorker=!1,window)}function o(e){return n()?e instanceof OffscreenCanvasRenderingContext2D:e instanceof CanvasRenderingContext2D}r.d(t,{uL:function(){return u},Th:function(){return s},yb:function(){return a},Hy:function(){return z},ZS:function(){return N}});var a=function(e,t){let r;"string"==typeof e&&(e=document.getElementById(e));let n=1;if("true"===t.use_webgl1?r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}):(r=e.getContext("webgl2",{antialias:!1,premultipliedAlpha:!1}),n=2,r||(n=1,r=e.getContext("webgl",{antialias:!1,premultipliedAlpha:!1}))),r.getExtension("WEBGL_draw_buffers")?r.disable_multi_draw=t.disable_multi_draw||!1:r.disable_multi_draw=!0,r.extensions={},r.getVersion=function(){return n},1===r.getVersion()){if("float32"===t.float_type){if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.FLOAT}else{if(r.extensions.EXT_FLOAT=r.getExtension("OES_texture_half_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: OES_texture_half_float");r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.extensions.EXT_FLOAT_LINEAR,r.texture_format=r.RGBA,r.texture_type=r.extensions.EXT_FLOAT.HALF_FLOAT_OES}if(!r.disable_multi_draw&&(r.extensions.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),!r.extensions.WEBGL_draw_buffers))throw new Error("Extension not found: WEBGL_draw_buffers")}else{if(r.extensions.EXT_FLOAT=r.getExtension("EXT_color_buffer_float"),!r.extensions.EXT_FLOAT)throw new Error("Extension not found: EXT_color_buffer_float");"float32"===t.float_type?(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_float_linear"),r.texture_format=r.RGBA32F,r.texture_type=r.FLOAT):(r.extensions.EXT_FLOAT_LINEAR=r.getExtension("OES_texture_half_float_linear"),r.texture_format=r.RGBA16F,r.texture_type=r.FLOAT)}return 1===r.getVersion()?(r.getCOLOR_ATTACHMENT=function(e=0){return r.disable_multi_draw?r.COLOR_ATTACHMENT0:r.extensions.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(e)}):(r.getCOLOR_ATTACHMENT=function(e=0){return r.COLOR_ATTACHMENT0+e},r.getDrawBuffers=function(e=[r.getCOLOR_ATTACHMENT(0)]){r.drawBuffers(e)}),i().gl=r,r.canvas.w=r.canvas.width,r.canvas.h=r.canvas.height,r.clearCanvas=function(){r.clearColor(0,0,0,1),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)},r.input={h:t.h,w:t.w},r.render_scale={h:1,w:1},r.viewport(0,0,e.width,e.height),r.createAndCompileShader=function(e,t){let n=r.createShader(e);if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw new Error(r.getShaderInfoLog(n));return n},r.createAndLinkProgram=function(e,t){let n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,t),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw new Error(r.getProgramInfoLog(n));return n},r.resizeCanvasToDisplaySize=function(t,r){return(e.width!==t||e.height!==r)&&(e.width=t,e.height=r,!0)},r.resizeRenderSize=function(e,t,n){let i=n*r.input.w,o=n*r.input.h;i=e>i?e:i,o=t>o?t:o,r.render_scale={w:e/i,h:t/o},r.resizeCanvasToDisplaySize(i,o)},r.log=function(e){},r},s=class{constructor(e,t,r,n){this.gl=e,this.network=t,this.frameBuffer=r,this.renderSize={w:n.w,h:n.h},this.metrics={"Render Size":this.renderSize,"Original Size":e.input,"Upscale Factor":t.upscaleFactor,FPS:0},this.setProperties(n)}setProperties(e={w:1278,h:720,disableVideoToCanvas:!1}){const t=this;!0!==e.disableVideoToCanvas&&this.frameBuffer.setInputFrameCanvas(),void 0===e.w&&(e.w=this.network.upscaleFactor*this.gl.input.w),void 0===e.h&&(e.h=this.network.upscaleFactor*this.gl.input.h),this.renderSize=e,this.gl.resizeRenderSize(e.w,e.h,this.network.upscaleFactor),null!==this.frameBuffer.inputTex&&setTimeout((()=>{t.network.renderRGB(t.gl.render_scale)})),t.metrics["Render Size"]=e}setInputSize(e={w:426,h:240},t=null){this.gl.input={w:e.w,h:e.h},this.network.resetTextureBuffers(),this.setProperties(t||this.renderSize)}async resetNetwork(e){this.frameBuffer.clearall(),this.network=await async function(e={name:"",version:"",tag:"",token:""},t,r){let n=null,i=null;try{i=await N(e.name,e.tag,e.version,e.token)}catch(e){throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error(e)}if(!i)throw console.error("%cParameter load failed:","background:black; color: yellow"),new Error("");try{const o=z(e.name,e.token);n=await o,n=new n(t,r,i)}catch(e){throw console.error("%cNetwork load failed:","background:black; color: yellow"),new Error(e)}return n}({name:e.name,version:e.version,tag:e.tag},this.gl,this.network.frameBuffer),this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl,this.setProperties(this.renderSize)}changeNetwork(e){this.network=e,this.frameBuffer=this.network.frameBuffer,this.gl=this.network.gl}async loadBitmap(e){const t=this.frameBuffer;this.network,t.setInputImage(e),await this.render()}loadImage(e){const t=new Image;t.src=e;const r=this.frameBuffer,n=this,i=this.network;t.onload=async function(){r.setInputImage(t),await n.render(),i.getImageBytes()}}async render(e){const t=this.gl,r=this.network;t.clearColor(0,0,0,1),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),r.initialized&&await r.initialized,await r.feedForward(t.render_scale,e),t.flush()}},u=class{constructor(e){this.gl=e,this.iterations=0,this.textures=[{},{}],this.frame_buffers=[{},{}],this.inputTex=null,this.inputCanvas=null,this.frame_difference=0}drawToCanvas(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null)}setBuffer(e){const t=this.gl,r=this.iterations%2*this.frame_difference;t.bindFramebuffer(t.FRAMEBUFFER,this.frame_buffers[r][e])}setInputFrameCanvas(){i(),o(this.inputCanvas)||(this.inputCanvas=function(e,t){if(n())return new OffscreenCanvas(e,t);{const r=document.createElement("canvas");return r.width=e,r.height=t,r}}(this.gl.input.w,this.gl.input.h).getContext("2d")),this.inputCanvas.canvas.width=this.gl.input.w,this.inputCanvas.canvas.height=this.gl.input.h}videoToCanvas(e){return this.inputCanvas.drawImage(e,0,0,this.gl.input.w,this.gl.input.h),this.inputCanvas.canvas}getInputTexture(){const e=this.gl;if(null===this.inputTex){let t=e.createTexture();this.inputTex=this._setTextureSize(t,e.input.w,e.input.h)}return this.inputTex}setInputImage(e){this.input=e;const t=this.gl;o(this.inputCanvas)&&1===t.getVersion()&&(e=this.videoToCanvas(e));let r=this.getInputTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.texture_format,t.RGBA,t.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e].INPUT=[r]}setImageAsTexture(e,t){const r=this.gl;let n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texImage2D(r.TEXTURE_2D,0,r.texture_format,r.RGBA,r.texture_type,e);for(let e=0;e<=this.frame_difference;e++)this.textures[e][t]=[n]}createBufferWithTextures(e,t,r=1,n=null){const i=this.gl;for(let o=0;o<=this.frame_difference;o++){const a=i.createFramebuffer();this.frame_buffers[o][e]=a,i.bindFramebuffer(i.FRAMEBUFFER,a);const s=[];this.textures[o][e]=null;for(let e=0;e<t;++e){let t=this.createAndSetupTexture(n);t=this._setTextureSize(t,i.input.w*r,i.input.h*r),s.push(t),i.bindTexture(i.TEXTURE_2D,t),i.texImage2D(i.TEXTURE_2D,0,i.texture_format,i.input.w*r,i.input.h*r,0,i.RGBA,i.texture_type,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.getCOLOR_ATTACHMENT(e),i.TEXTURE_2D,t,0)}this.textures[o][e]=s}}createBufferWithTextures2(e,t,r,n,i={}){const o=this.gl;if(r<=0||n<=0)throw new Error("Texture width and height must be greater than 0");let a=i.format||o.RGBA,s=i.minFilter||o.NEAREST,u=i.magFilter||o.NEAREST,c=i.type||o.texture_type||o.UNSIGNED_BYTE,f=i.internalFormat||o.texture_format||o.RGBA;for(let i=0;i<=this.frame_difference;i++){const l=o.createFramebuffer();this.frame_buffers[i][e]=l,o.bindFramebuffer(o.FRAMEBUFFER,l);const h=[];this.textures[i][e]=null;for(let e=0;e<t;++e){let t;1===o.getVersion()?t=this.createTexture_webgl1(f,r,n,a,c,s,u):(f===o.RGBA&&(f=o.RGBA8),t=this.createTexture_webgl2(f,r,n,s,u)),o.framebufferTexture2D(o.FRAMEBUFFER,o.getCOLOR_ATTACHMENT(e),o.TEXTURE_2D,t,0),h.push(t)}this.textures[i][e]=h}}getTextureSize(e,t=0,r=0){if(!this.textures[t][e][r])throw new Error(`Failed to get resolution of textures for layer: ${e} at index: ${index}`);return this.textures[t][e][r].size}createTexture_webgl2(e,t,r,n,i){n=n||gl.NEAREST,i=i||gl.NEAREST,e=e||gl.texture_format||gl.RGBA;let o=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,n),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,i),gl.texStorage2D(gl.TEXTURE_2D,1,e,t,r),o=this._setTextureSize(o,t,r),o}createTexture_webgl1(e,t,r,n,i,o,a){n=n||gl.RGBA,o=o||gl.NEAREST,a=a||gl.NEAREST,i=i||gl.texture_type||gl.UNSIGNED_BYTE,e=e||gl.texture_format||gl.RGBA;let s=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,s),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,o),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,a),gl.texImage2D(gl.TEXTURE_2D,0,e,t,r,0,n,i,null),s=this._setTextureSize(s,t,r),s}createFloatTextureFromArrayBuffer(e,t,r,n,i,o,a,s){o=o||gl.RGBA,a=a||gl.NEAREST,s=s||gl.NEAREST,i=i||gl.texture_type||gl.UNSIGNED_BYTE,t=t||gl.texture_format||gl.RGBA;const u=new Float32Array(e);let c=gl.createTexture();return gl.bindTexture(gl.TEXTURE_2D,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,a),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,s),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA32F,r,n,0,gl.RGBA,gl.FLOAT,u),c=this._setTextureSize(c,r,n),c}_setTextureSize(e,t,r){return t>0&&r>0&&(e.size={},e.size.width=t,e.size.height=r),e}setBufferForLayer(e,t){for(let r=0;r<=this.frame_difference;r++){const n=gl.createFramebuffer();this.frame_buffers[r][e]=n,gl.bindFramebuffer(gl.FRAMEBUFFER,n);for(let e=0;e<t.length;e++)gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.getCOLOR_ATTACHMENT(e),gl.TEXTURE_2D,t[e],0);this.textures[r][e]=t}}getTexture(e){const t=this.iterations%2*this.frame_difference;return this.textures[t][e]}getLastFrameTexture(e){const t=1-this.iterations%2;return this.textures[t][e]}clearall(){Object.keys(this.textures[0]).forEach((e=>{for(let t=0;t<=this.frame_difference;t++){this.gl.deleteFramebuffer(this.frame_buffers[t][e]),this.frame_buffers[t][e]=null;for(let r=0;r<this.textures[t][e].length;++r)this.gl.deleteTexture(this.textures[t][e][r]),this.textures[t][e][r]=null}})),this.gl.deleteTexture(this.inputTex),this.inputTex=null,this.inputCanvas=null,this.frame_buffers=[{},{}],this.textures=[{},{}],this.gl.clearCanvas()}createAndSetupTexture(e=null){const t=this.gl;t.extensions.EXT_FLOAT_LINEAR||(e=null),null===e&&(e=t.NEAREST);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),r}};r(435);var c=r(618),f=r(443),l=r.n(f),h=r(595),d=r.n(h),p="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==p&&p,m="URLSearchParams"in p,g="Symbol"in p&&"iterator"in Symbol,v="FileReader"in p&&"Blob"in p&&function(){try{return new Blob,!0}catch(e){return!1}}(),y="FormData"in p,w="ArrayBuffer"in p;if(w)var b=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],_=ArrayBuffer.isView||function(e){return e&&b.indexOf(Object.prototype.toString.call(e))>-1};function E(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function T(e){return"string"!=typeof e&&(e=String(e)),e}function x(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return g&&(t[Symbol.iterator]=function(){return t}),t}function A(e){this.map={},e instanceof A?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function k(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function R(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function S(e){var t=new FileReader,r=R(t);return t.readAsArrayBuffer(e),r}function O(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function P(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:v&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:y&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:m&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():w&&v&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=O(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):w&&(ArrayBuffer.prototype.isPrototypeOf(e)||_(e))?this._bodyArrayBuffer=O(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):m&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v&&(this.blob=function(){var e=k(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?k(this)||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer)):this.blob().then(S)}),this.text=function(){var e,t,r,n=k(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=R(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y&&(this.formData=function(){return this.text().then(I)}),this.json=function(){return this.text().then(JSON.parse)},this}A.prototype.append=function(e,t){e=E(e),t=T(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},A.prototype.delete=function(e){delete this.map[E(e)]},A.prototype.get=function(e){return e=E(e),this.has(e)?this.map[e]:null},A.prototype.has=function(e){return this.map.hasOwnProperty(E(e))},A.prototype.set=function(e,t){this.map[E(e)]=T(t)},A.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},A.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),x(e)},A.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),x(e)},A.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),x(e)},g&&(A.prototype[Symbol.iterator]=A.prototype.entries);var F=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function L(e,t){if(!(this instanceof L))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,n,i=(t=t||{}).body;if(e instanceof L){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new A(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new A(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),F.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var o=/([?&])_=[^&]*/;o.test(this.url)?this.url=this.url.replace(o,"$1_="+(new Date).getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}function I(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function C(e,t){if(!(this instanceof C))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new A(t.headers),this.url=t.url||"",this._initBody(e)}L.prototype.clone=function(){return new L(this,{body:this._bodyInit})},P.call(L.prototype),P.call(C.prototype),C.prototype.clone=function(){return new C(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new A(this.headers),url:this.url})},C.error=function(){var e=new C(null,{status:0,statusText:""});return e.type="error",e};var B=[301,302,303,307,308];C.redirect=function(e,t){if(-1===B.indexOf(t))throw new RangeError("Invalid status code");return new C(null,{status:t,headers:{location:e}})};var U=p.DOMException;try{new U}catch(e){(U=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),U.prototype.constructor=U}function M(e,t){return new Promise((function(r,n){var i=new L(e,t);if(i.signal&&i.signal.aborted)return n(new U("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}o.onload=function(){var e,t,n={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new A,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};n.url="responseURL"in o?o.responseURL:n.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;setTimeout((function(){r(new C(i,n))}),0)},o.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){n(new U("Aborted","AbortError"))}),0)},o.open(i.method,function(e){try{return""===e&&p.location.href?p.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&(v?o.responseType="blob":w&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof A?i.headers.forEach((function(e,t){o.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){o.setRequestHeader(e,T(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&i.signal.removeEventListener("abort",a)}),o.send(void 0===i._bodyInit?null:i._bodyInit)}))}M.polyfill=!0,p.fetch||(p.fetch=M,p.Headers=A,p.Request=L,p.Response=C);const D=i();let z=async(e,t={})=>{let n,i=((t=t||{}).path||r.p)+`models/${e}.js`;var o;return t.token&&(i=i+"?"+t.token),D.vectorlyBasePath=t.path||r.p,"background_selfie"===e&&(n=(async()=>{let e;if(D.tflite)e=D.tflite;else{let t=D.vectorlyBasePath||"";try{if(!0!==c.feature.simd)throw new Error("SIMD feature check is false");e=await l()({basePath:t})}catch(r){e=await d()({basePath:t})}}return e})()),D.isWorker?importScripts(i):await(o=i,new Promise(((e,t)=>{const r="$importModule$"+Math.random().toString(32).slice(2),n=document.createElement("script"),i=()=>{delete window[r],n.onerror=null,n.onload=null,n.remove(),URL.revokeObjectURL(n.src),n.src=""};n.defer="defer",n.type="module",n.onerror=()=>{t(new Error(`Failed to import: ${o}`)),i()},n.onload=()=>{e(window[r]),i()};const a=function(e){const t=document.createElement("a");return t.setAttribute("href",e),t.cloneNode(!1).href}(o),s=new Blob([`import * as m from "${a}"; window.${r} = m;`],{type:"text/javascript"});n.src=URL.createObjectURL(s),document.head.appendChild(n)}))),"background_selfie"===e&&(D.tflite=await n),D.vectorly.models[e]},N=async(e,t,n,i)=>{if(i=i||{},"background_selfie"===e){let o=(i.path||r.p)+`./data/${e}/${t}_v${n}.tflite`;i.token&&(o=o+"?"+i.token);const a=await fetch(o);if(!a.ok)throw Error(`Response fetching "${o}": ${a.statusText}`);return{model:await a.arrayBuffer()}}if("background_webgl2"===e||"background_webgl"===e||"background_webgl_unet"===e){let o=(i.path||r.p)+`./data/${e}/${t}_v${n}.json`,a=(i.path||r.p)+`./data/${e}/${t}_v${n}.weights`;i.token&&(o+="?"+i.token,a+="?"+i.token);const[s,u]=await Promise.all([fetch(o),fetch(a)]),[c,f]=await Promise.all([s.json(),u.arrayBuffer()]),l=JSON.parse(JSON.stringify(c)),h=new Float32Array(f),d=Object.keys(c),p=["weights","biases"];c[d[0]].debugImage&&p.push("debugImage");for(let e of d)for(let t of p){let[r,n]=c[e][t];l[e][t]=h.slice(n,n+r)}return l}{let o=(i.path||r.p)+`./data/${e}/${t}_v${n}.json`;i.token&&(o=o+"?"+i.token);const a=await fetch(o);return await a.json()}}},435:function(e){e.exports=["cnn_demo","residual_3k_3x","residual_4k_2x","residual_5k_2x","residual_5k_3x","denoise_10k_1x","background_selfie","background_webgl_unet","background_webgl","background_webgl2","upscaler_4krgb_2x"]},443:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,t){r=e,n=t}));var o,a={};for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var d,p,m="";(s||u)&&(u?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),t&&(m=t),m=0!==m.indexOf("blob:")?m.substr(0,m.lastIndexOf("/")+1):"",u&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var g,v=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);a=null,i.arguments&&(f=i.arguments),i.thisProgram&&(l=i.thisProgram),i.quit&&(h=i.quit),i.wasmBinary&&(g=i.wasmBinary);var w,b=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&M("no native wasm support detected");var _,E,T,x,A=!1,k="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&k)return k.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function S(e){_=e,i.HEAP8=E=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=x=new Int32Array(e),i.HEAPU8=T=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var O,P=[],F=[],L=[],I=[];F.push({func:function(){Q()}});var C=0,B=null,U=null;function M(e){i.onAbort&&i.onAbort(e),y(e+=""),A=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function D(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function z(e){return D(e,"data:application/octet-stream;base64,")}function N(e){return D(e,"file://")}i.preloadedImages={},i.preloadedAudios={};var j,H,X="./tflite/tflite-simd.wasm";function W(e){try{if(e==X&&g)return new Uint8Array(g);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){M(e)}}function G(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?O.get(r)():O.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(i)}}function q(e){return x[ee()>>2]=e,e}function V(e){try{return w.grow(e-_.byteLength+65535>>>16),S(w.buffer),1}catch(e){}}z(X)||(j=X,X=i.locateFile?i.locateFile(j,m):(m=i.basePath||m)+j),H=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var $={};function Z(){if(!Z.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in $)e[t]=$[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Z.strings=r}return Z.strings}var Y,J={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=J.buffers[e];0===t||10===t?((1===e?v:y)(R(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return J.varargs+=4,x[J.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?R(T,e,void 0):""}(e);return t},get64:function(e,t){return e}},K={a:function(){M()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return q(28),-1;r=H()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){M("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){M("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){T.copyWithin(e,t,t+r)},m:function(e){var t,r=T.length,n=2147483648;if(e>n)return!1;for(var i=1;i<=4;i*=2){var o=r*(1+.2/i);if(o=Math.min(o,e+100663296),V(Math.min(n,((t=Math.max(e,o))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=H();H()-t<e;);},p:function(e,t){var r=0;return Z().forEach((function(n,i){var o=t+r;x[e+4*i>>2]=o,function(e,t,r){for(var n=0;n<e.length;++n)E[t++>>0]=e.charCodeAt(n);E[t>>0]=0}(n,o),r+=n.length+1})),0},g:function(e,t){var r=Z();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){b||(i.onExit&&i.onExit(e),A=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,i){},c:function(e,t,r,n){for(var i=0,o=0;o<r;o++){for(var a=x[t+8*o>>2],s=x[t+(8*o+4)>>2],u=0;u<s;u++)J.printChar(e,T[a+u]);i+=s}return x[n>>2]=i,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return q(28),-1}},Q=(function(){var e={a:K};function t(e,t){var r=e.exports;i.asm=r,S((w=i.asm.q).buffer),O=i.asm.D,function(e){if(C--,i.monitorRunDependencies&&i.monitorRunDependencies(C),0==C&&(null!==B&&(clearInterval(B),B=null),U)){var t=U;U=null,t()}}()}function r(e){t(e.instance)}function o(t){return function(){if(!g&&(s||u)){if("function"==typeof fetch&&!N(X))return fetch(X,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+X+"'";return e.arrayBuffer()})).catch((function(){return W(X)}));if(d)return new Promise((function(e,t){d(X,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return W(X)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),M(e)}))}if(C++,i.monitorRunDependencies&&i.monitorRunDependencies(C),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||z(X)||N(X)||"function"!=typeof fetch?o(r):fetch(X,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(Q=i.___wasm_call_ctors=i.asm.r).apply(null,arguments)}),ee=(i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getInputHeight=function(){return(i._getInputHeight=i.asm.u).apply(null,arguments)},i._getInputWidth=function(){return(i._getInputWidth=i.asm.v).apply(null,arguments)},i._getInputChannelCount=function(){return(i._getInputChannelCount=i.asm.w).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.x).apply(null,arguments)},i._getOutputHeight=function(){return(i._getOutputHeight=i.asm.y).apply(null,arguments)},i._getOutputWidth=function(){return(i._getOutputWidth=i.asm.z).apply(null,arguments)},i._getOutputChannelCount=function(){return(i._getOutputChannelCount=i.asm.A).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.B).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.C).apply(null,arguments)},i.___errno_location=function(){return(ee=i.___errno_location=i.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,i.calledRun=!0,A||(G(F),G(L),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),I.unshift(e);var e;G(I)}()))}e=e||f,C>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),P.unshift(e);var e;G(P)}(),C>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(U=function e(){Y||re(),Y||(U=e)},i.run=re,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return re(),e.ready});e.exports=r},595:function(e){var t,r=(t=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/index.js",function(e){var r,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,t){r=e,n=t}));var o,a={};for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);var s,u,c,f=[],l="./this.program",h=function(e,t){throw t};s="object"==typeof window,u="function"==typeof importScripts,c="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node;var d,p,m="";(s||u)&&(u?m=self.location.href:"undefined"!=typeof document&&document.currentScript&&(m=document.currentScript.src),t&&(m=t),m=0!==m.indexOf("blob:")?m.substr(0,m.lastIndexOf("/")+1):"",u&&(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var g,v=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);for(o in a)a.hasOwnProperty(o)&&(i[o]=a[o]);a=null,i.arguments&&(f=i.arguments),i.thisProgram&&(l=i.thisProgram),i.quit&&(h=i.quit),i.wasmBinary&&(g=i.wasmBinary);var w,b=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&M("no native wasm support detected");var _,E,T,x,A=!1,k="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function R(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.subarray&&k)return k.decode(e.subarray(t,i));for(var o="";t<i;){var a=e[t++];if(128&a){var s=63&e[t++];if(192!=(224&a)){var u=63&e[t++];if((a=224==(240&a)?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var c=a-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}function S(e){_=e,i.HEAP8=E=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=x=new Int32Array(e),i.HEAPU8=T=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var O,P=[],F=[],L=[],I=[];F.push({func:function(){Q()}});var C=0,B=null,U=null;function M(e){i.onAbort&&i.onAbort(e),y(e+=""),A=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw n(t),t}function D(e,t){return String.prototype.startsWith?e.startsWith(t):0===e.indexOf(t)}function z(e){return D(e,"data:application/octet-stream;base64,")}function N(e){return D(e,"file://")}i.preloadedImages={},i.preloadedAudios={};var j,H,X="./tflite/tflite.wasm";function W(e){try{if(e==X&&g)return new Uint8Array(g);if(p)return p(e);throw"both async and sync fetching of the wasm failed"}catch(e){M(e)}}function G(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?O.get(r)():O.get(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(i)}}function q(e){return x[ee()>>2]=e,e}function V(e){try{return w.grow(e-_.byteLength+65535>>>16),S(w.buffer),1}catch(e){}}z(X)||(j=X,X=i.locateFile?i.locateFile(j,m):(m=i.basePath||m)+j),H=c?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var $={};function Z(){if(!Z.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:l||"./this.program"};for(var t in $)e[t]=$[t];var r=[];for(var t in e)r.push(t+"="+e[t]);Z.strings=r}return Z.strings}var Y,J={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var r=J.buffers[e];0===t||10===t?((1===e?v:y)(R(r,0)),r.length=0):r.push(t)},varargs:void 0,get:function(){return J.varargs+=4,x[J.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?R(T,e,void 0):""}(e);return t},get64:function(e,t){return e}},K={a:function(){M()},n:function(e,t){var r;if(0===e)r=Date.now();else{if(1!==e&&4!==e)return q(28),-1;r=H()}return x[t>>2]=r/1e3|0,x[t+4>>2]=r%1e3*1e3*1e3|0,0},i:function(e,t){M("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},e:function(e,t){M("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,r){T.copyWithin(e,t,t+r)},m:function(e){var t,r=T.length,n=2147483648;if(e>n)return!1;for(var i=1;i<=4;i*=2){var o=r*(1+.2/i);if(o=Math.min(o,e+100663296),V(Math.min(n,((t=Math.max(e,o))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},o:function(e){for(var t=H();H()-t<e;);},p:function(e,t){var r=0;return Z().forEach((function(n,i){var o=t+r;x[e+4*i>>2]=o,function(e,t,r){for(var n=0;n<e.length;++n)E[t++>>0]=e.charCodeAt(n);E[t>>0]=0}(n,o),r+=n.length+1})),0},g:function(e,t){var r=Z();x[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),x[t>>2]=n,0},j:function(e){!function(e,t){b||(i.onExit&&i.onExit(e),A=!0),h(e,new te(e))}(e)},h:function(e){return 0},k:function(e,t,r,n,i){},c:function(e,t,r,n){for(var i=0,o=0;o<r;o++){for(var a=x[t+8*o>>2],s=x[t+(8*o+4)>>2],u=0;u<s;u++)J.printChar(e,T[a+u]);i+=s}return x[n>>2]=i,0},d:function(){return 6},f:function(){return 28},b:function(e){switch(e){case 30:case 75:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return q(28),-1}},Q=(function(){var e={a:K};function t(e,t){var r=e.exports;i.asm=r,S((w=i.asm.q).buffer),O=i.asm.D,function(e){if(C--,i.monitorRunDependencies&&i.monitorRunDependencies(C),0==C&&(null!==B&&(clearInterval(B),B=null),U)){var t=U;U=null,t()}}()}function r(e){t(e.instance)}function o(t){return function(){if(!g&&(s||u)){if("function"==typeof fetch&&!N(X))return fetch(X,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+X+"'";return e.arrayBuffer()})).catch((function(){return W(X)}));if(d)return new Promise((function(e,t){d(X,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return W(X)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),M(e)}))}if(C++,i.monitorRunDependencies&&i.monitorRunDependencies(C),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(e){return y("Module.instantiateWasm callback failed with error: "+e),!1}(g||"function"!=typeof WebAssembly.instantiateStreaming||z(X)||N(X)||"function"!=typeof fetch?o(r):fetch(X,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(Q=i.___wasm_call_ctors=i.asm.r).apply(null,arguments)}),ee=(i._getModelBufferMemoryOffset=function(){return(i._getModelBufferMemoryOffset=i.asm.s).apply(null,arguments)},i._getInputMemoryOffset=function(){return(i._getInputMemoryOffset=i.asm.t).apply(null,arguments)},i._getInputHeight=function(){return(i._getInputHeight=i.asm.u).apply(null,arguments)},i._getInputWidth=function(){return(i._getInputWidth=i.asm.v).apply(null,arguments)},i._getInputChannelCount=function(){return(i._getInputChannelCount=i.asm.w).apply(null,arguments)},i._getOutputMemoryOffset=function(){return(i._getOutputMemoryOffset=i.asm.x).apply(null,arguments)},i._getOutputHeight=function(){return(i._getOutputHeight=i.asm.y).apply(null,arguments)},i._getOutputWidth=function(){return(i._getOutputWidth=i.asm.z).apply(null,arguments)},i._getOutputChannelCount=function(){return(i._getOutputChannelCount=i.asm.A).apply(null,arguments)},i._loadModel=function(){return(i._loadModel=i.asm.B).apply(null,arguments)},i._runInference=function(){return(i._runInference=i.asm.C).apply(null,arguments)},i.___errno_location=function(){return(ee=i.___errno_location=i.asm.E).apply(null,arguments)});function te(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function re(e){function t(){Y||(Y=!0,i.calledRun=!0,A||(G(F),G(L),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),I.unshift(e);var e;G(I)}()))}e=e||f,C>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),P.unshift(e);var e;G(P)}(),C>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t()))}if(U=function e(){Y||re(),Y||(U=e)},i.run=re,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return re(),e.ready});e.exports=r},55:function(e,t,r){"use strict";r.d(t,{br:function(){return a},uF:function(){return s},yA:function(){return u},re:function(){return h},ok:function(){return d}});var n=r(861),i=r(757),o=r.n(i);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e5;return new Promise((function(r,n){var i=document.querySelector(e),o=setTimeout((function(){n("waitForElement failed for"+e)}),t);if(i)r(i);else{var a=new MutationObserver((function(t){t.forEach((function(t){for(var n=0,i=Array.from(t.addedNodes);n<i.length;n++){var s=i[n];if(s.matches&&s.matches(e))return a.disconnect(),r(s),void clearTimeout(o)}}))}));a.observe(document.documentElement,{childList:!0,subtree:!0})}}))}function s(e){return new Promise((function(t,r){if(e instanceof HTMLVideoElement){if(e.videoWidth*e.videoHeight>0)return void t({width:e.videoWidth,height:e.videoHeight});e.onloadedmetadata=function(){t({width:e.videoWidth,height:e.videoHeight})},e.onerror=function(){r()}}else e instanceof HTMLImageElement&&t({width:e.naturalWidth,height:e.naturalHeight})}))}var u=function(e){return e instanceof HTMLMediaElement?!(e.paused||e.ended):e instanceof HTMLImageElement||void 0},c=function(e){var t,r=e||"production";switch(r){case"local":t="http://localhost:4000";break;case"staging":t="https://stream-staging.vectorly.io";break;default:t="https://stream.vectorly.io"}return t},f=function(){var e="1.6.10";return"https://cdn.vectorly.io/ai-filters/v1/".concat(e,"/")},l=function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var i,a,s,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f(),a="".concat(c(n),"/upscaler/models/").concat(t.name,"?token=").concat(r,"&path=").concat(encodeURI(i),"&version=").concat(t.version,"&tag=").concat(t.tag),e.next=4,fetch(a);case 4:if(!(s=e.sent).ok){e.next=14;break}return e.next=8,s.json();case 8:return u=e.sent,l=u.token,e.abrupt("return",l);case 14:case 15:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),h=function(){var e=(0,n.Z)(o().mark((function e(t,r,n){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={path:f()},!n||"staging"!==n&&"local"!==n){e.next=13;break}return e.prev=2,e.next=5,l(t,r,n);case 5:i.token=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Error while fetching token in staging, defaulting to local files",e.t0);case 11:e.next=16;break;case 13:return e.next=15,l(t,r,n);case 15:i.token=e.sent;case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,r,n){return e.apply(this,arguments)}}();function d(){return!1}},820:function(e,t,r){"use strict";r.d(t,{Wx:function(){return h},U7:function(){return l}}),e=r.hmd(e);let n=1;const i="object"==typeof self&&self.self==self?self:"object"==typeof r.g&&r.g.global==r.g?r.g:{},o=Date.now();let a={},s=Date.now();const u=e=>{if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=Date.now(),r=t-s,u=r>16?0:16-r,c=n++;return a[c]=e,Object.keys(a).length>1||setTimeout((()=>{s=t;const e=a;a={},Object.keys(e).forEach((t=>e[t](i.performance&&"function"==typeof i.performance.now?i.performance.now():Date.now()-o)))}),u),c},c=e=>"string"!=typeof e?u:""===e?i.requestAnimationFrame:i[e+"RequestAnimationFrame"],f=((e,t)=>{let r=0;for(;void 0!==e[r];){if(t(e[r]))return e[r];r+=1}})(["","webkit","moz","ms","o"],(e=>!!c(e))),l=c(f),h="string"!=typeof(d=f)?e=>{delete a[e]}:""===d?i.cancelAnimationFrame:i[d+"CancelAnimationFrame"]||i[d+"CancelRequestAnimationFrame"];var d;i.requestAnimationFrame=l,i.cancelAnimationFrame=h,e.exports&&(e.exports={requestAnimationFrame:l,cancelAnimationFrame:h})},33:function(e,t,r){"use strict";var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var r=-1;return e.some((function(e,n){return e[0]===t&&(r=n,!0)})),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var r=e(this.__entries__,t),n=this.__entries__[r];return n&&n[1]},t.prototype.set=function(t,r){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=r:this.__entries__.push([t,r])},t.prototype.delete=function(t){var r=this.__entries__,n=e(r,t);~n&&r.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var r=0,n=this.__entries__;r<n.length;r++){var i=n[r];e.call(t,i[1],i[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==r.g&&r.g.Math===Math?r.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),a="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)},s=["top","right","bottom","left","width","height","size","weight"],u="undefined"!=typeof MutationObserver,c=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var r=!1,n=!1,i=0;function o(){r&&(r=!1,e()),n&&u()}function s(){a(o)}function u(){var e=Date.now();if(r){if(e-i<2)return;n=!0}else r=!0,n=!1,setTimeout(s,20);i=e}return u}(this.refresh.bind(this))}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,r=t.indexOf(e);~r&&t.splice(r,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),u?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,r=void 0===t?"":t;s.some((function(e){return!!~r.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),f=function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||o},h=v(0,0,0,0);function d(e){return parseFloat(e)||0}function p(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.reduce((function(t,r){return t+d(e["border-"+r+"-width"])}),0)}var m="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function g(e){return i?m(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):function(e){var t=e.clientWidth,r=e.clientHeight;if(!t&&!r)return h;var n=l(e).getComputedStyle(e),i=function(e){for(var t={},r=0,n=["top","right","bottom","left"];r<n.length;r++){var i=n[r],o=e["padding-"+i];t[i]=d(o)}return t}(n),o=i.left+i.right,a=i.top+i.bottom,s=d(n.width),u=d(n.height);if("border-box"===n.boxSizing&&(Math.round(s+o)!==t&&(s-=p(n,"left","right")+o),Math.round(u+a)!==r&&(u-=p(n,"top","bottom")+a)),!function(e){return e===l(e).document.documentElement}(e)){var c=Math.round(s+o)-t,f=Math.round(u+a)-r;1!==Math.abs(c)&&(s-=c),1!==Math.abs(f)&&(u-=f)}return v(i.left,i.top,s,u)}(e):h}function v(e,t,r,n){return{x:e,y:t,width:r,height:n}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=g(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),w=function(e,t){var r,n,i,o,a,s,u,c=(n=(r=t).x,i=r.y,o=r.width,a=r.height,s="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(s.prototype),f(u,{x:n,y:i,width:o,height:a,top:i,right:n+o,bottom:a+i,left:n}),u);f(this,{target:e,contentRect:c})},b=function(){function e(e,t,r){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=r}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new w(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),_="undefined"!=typeof WeakMap?new WeakMap:new n,E=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=c.getInstance(),n=new b(t,r,this);_.set(this,n)};["observe","unobserve","disconnect"].forEach((function(e){E.prototype[e]=function(){var t;return(t=_.get(this))[e].apply(t,arguments)}}));var T=void 0!==o.ResizeObserver?o.ResizeObserver:E;t.Z=T},877:function(e,t,r){var n=r(570),i=r(171),o=i;o.v1=n,o.v4=i,e.exports=o},327:function(e){for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);e.exports=function(e,r){var n=r||0,i=t;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},217:function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var r=new Uint8Array(16);e.exports=function(){return t(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},570:function(e,t,r){var n,i,o=r(217),a=r(327),s=0,u=0;e.exports=function(e,t,r){var c=t&&r||0,f=t||[],l=(e=e||{}).node||n,h=void 0!==e.clockseq?e.clockseq:i;if(null==l||null==h){var d=o();null==l&&(l=n=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==h&&(h=i=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:u+1,g=p-s+(m-u)/1e4;if(g<0&&void 0===e.clockseq&&(h=h+1&16383),(g<0||p>s)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,u=m,i=h;var v=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;f[c++]=v>>>24&255,f[c++]=v>>>16&255,f[c++]=v>>>8&255,f[c++]=255&v;var y=p/4294967296*1e4&268435455;f[c++]=y>>>8&255,f[c++]=255&y,f[c++]=y>>>24&15|16,f[c++]=y>>>16&255,f[c++]=h>>>8|128,f[c++]=255&h;for(var w=0;w<6;++w)f[c+w]=l[w];return t||a(f)}},171:function(e,t,r){var n=r(217),i=r(327);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},618:function(e){"use strict";function t(e,t){if(!c)return!1;const n=e.buffer;let i=l.get(n);if(null==i){if((i=r.validate(n))&&t)try{new r.Instance(new r.Module(n)).exports[0]()}catch(e){i=!1}l.set(n,i)}return i}const r=WebAssembly,n=(...e)=>Uint8Array.of(0,97,115,109,1,0,0,0,...e),i=(...e)=>Uint32Array.of(1836278016,1,...e),o=(...e)=>i(1610679297,33751040,...e,40239360,259),a=(...e)=>n(1,4,1,96,0,0,3,2,1,0,...e,11,0,10,4,110,97,109,101,2,3,1,0,0),s=(...e)=>Uint16Array.of(24832,28019,1,0,1025,24577,0,515,1,...e),u=(...e)=>s(...e,2842,4096,28164,28001,357,260,256,560,259,0),c="object"==typeof r,f=e=>c&&"function"==typeof e,l=new WeakMap,h=i(1610679553,58589440,117440770,805372165,101318656,1107297281,268438272,1835101700,17039717,36700416,259),d=s(773,1,2561,269,11,65,65,65,3068,2816,2560,28164,28001,613,259,0),p=i(1610679297,33751040,134873089,100664833,185276736),m=n(2,8,1,1,97,1,98,3,127,1,6,6,1,127,1,65,0,11,7,5,1,1,97,3,1,0,8,4,110,97,109,101,2,1,0),g=Uint16Array.of(24832,28019,1,0,1537,24577,512,32639,515,1,2058,1537,16640,16640,2816,2560,28164,28001,613,259,0),v=u(3082,2561,17152,0,0,252),y=u(2058,1537,16640,49152),w=o(101318657,301990913,268438272,1835101700,17039717),b=a(5,4,1,3,1,1,10,7,1,5,0,254,3,0),_=o(84344833,6357249,17369600,4259847,186257917,1845758464),E=a(10,7,1,5,0,208,112,26);e.exports={support:(e=1)=>c&&t(Uint32Array.of(1836278016,e)),get supportStreaming(){return f(r.instantiateStreaming)},feature:{get bigInt(){return t(h,!0)},get bulk(){return t(d)},get exceptions(){return t(p)},get mutableGlobal(){return t(m)},get multiValue(){return t(g)},get saturateConversions(){return t(v)},get signExtensions(){return t(y)},get tailCall(){return t(w)},get threads(){return t(b)},get simd(){return t(_)},get references(){return t(E)},get typeReflection(){return f(r.Memory.type)},get funcReferences(){return f(r.Function)}}}},861:function(e,t,r){"use strict";function n(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,u,"next",e)}function u(e){n(a,i,o,s,u,"throw",e)}s(void 0)}))}}r.d(t,{Z:function(){return i}})},671:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{Z:function(){return n}})},144:function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}r.d(t,{Z:function(){return i}})}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={id:n,loaded:!1,exports:{}};return e[n](o,o.exports,r),o.loaded=!0,o.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var n={};return function(){"use strict";var e=r(861),t=r(671),i=r(144),o=r(757),a=r.n(o),s=r(706),u=r(33),c=r(55),f=r(877),l=r(820);function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d=function(){function r(e,n){(0,t.Z)(this,r),(0,c.ok)()&&console.log("Initialized upscaler with",e);var i=n;switch(this.video=e,this.id=i.id||(0,f.v4)(),this.videoParent=e.parentNode,this.token=i.token,this.serverType=i.serverType,this.fixaspectratio=i.fixaspectratio||!0,this.inputChangePreHook=i.inputChangePreHook||function(){return!0},this.renderSize=i.renderSize,"disable"===i.container?this.container=null:this.container=i.container||e.parentNode,(0,c.ok)()&&console.log("Container is",this.container),this.container&&(this.container.style.background="black",this.container.style.resize="both",this.container.style.overflow="hidden",this.ro=this.getResizeObserver(this.setRenderSize.bind(this)),this.ro.observe(this.container)),this.margin={top:0,left:0},this.use_webgl1=i.use_webgl1||"false",this.float_type=i.float_type||"float16",this.scale=i.scale||3,i.networkParams=i.networkParams||{},this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"},this.networkParams=Object.assign(this.networkParams,i.networkParams),this.networkOptions=i.networkOptions||{},(i.network||i.tag||i.version)&&(this.networkParams.name=i.network||this.networkParams.name,this.networkParams.tag=i.tag||this.networkParams.tag,"residual_3k_3x"===this.networkParams.name?this.networkParams.version=i.version||i.networkParams.version||"2.1":this.networkParams.version=i.version||i.networkParams.version||"0"),"residual_3k"===i.network?this.networkParams={name:"residual_3k_3x",tag:"general",version:"2.1"}:"residual_5k"===i.network&&(this.networkParams={name:"residual_5k_3x",tag:"general",version:"0"}),this.networkParams.name){case"residual_3k_3x":case"residual_5k_3x":case"residual_4k_3x":case"residual_4k_2x":case"residual_10k_1x":case"cnn_demo":this.networkType="upscaler";break;case"background_selfie":case"background_webgl":case"background_webgl2":case"background_webgl_unet":this.networkType="background";break;default:console.warning("INVALID networkType for network with params",this.networkParams),this.networkType="INVALID"}this.canvas=this.initCanvas(),this.instantiateP=this.instantiateNetwork(),this.setupMetrics(),this.initEvents(),this.reqHandle={useRAF:!("requestVideoFrameCallback"in HTMLVideoElement.prototype)},this.enable(),this.isPlaying=!1,this.playerInitTime=Date.now(),this.initialized=this.initializeNetwork(e),this.error=null,this.analyticsEnabled=!1,this.debug=!0===i.debug,this.debugRender=!0===i.debugRender,this.initAnalytics()}var n,o,d,p,m,g,v;return(0,i.Z)(r,[{key:"initAnalytics",value:(v=(0,e.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return v.apply(this,arguments)})},{key:"trackEventListener",value:function(e){var t=this;return function(){t.debug&&console.log("TrackEventListener",e),t.trackAnalytics(e+" Event",{upscale:t.enabled,type:t.events[e].type,currentTime:t.video.currentTime})}}},{key:"trackAnalytics",value:function(e,t){this.debug&&console.log("Tracking",e,t)}},{key:"setupMetrics",value:function(){this.prv=performance.now(),this.frames={rendered:{sinceTimestamp:0,total:0},video:{total:0}},this.metrics={renderSize:{w:1278,h:720},originalSize:{w:this.video.videoWidth,h:this.video.videoHeight},upscaleFactor:this.scale,droppedFrames:0,fps:0,upscaledFrames:0,videoFrames:0}}},{key:"changeNetwork",value:(g=(0,e.Z)(a().mark((function e(t){var r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("Changing network from",this.networkParams,"to",t),this.networkParams.name=t.name||this.networkParams.name,this.networkParams.tag=t.tag||this.networkParams.tag,this.networkParams.version=t.version||this.networkParams.version,e.next=6,(0,c.re)(this.networkParams,this.token,this.serverType);case 6:return r=e.sent,e.prev=7,n=(0,s.ZS)(this.networkParams.name,this.networkParams.tag,this.networkParams.version,r),e.next=11,(0,s.Hy)(this.networkParams.name,r);case 11:return this.NetworkClass=e.sent,e.next=14,n;case 14:this.networkParameters=e.sent,this.frameBuffer.clearall(),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.renderer.changeNetwork(this.networkInstance),this.renderSize&&this.setRenderSize(this.renderSize),this.render(),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(7),console.error("Error fetching network parameters and model or changing model",e.t0),document.dispatchEvent(this.events.error),this.disable();case 28:case"end":return e.stop()}}),e,this,[[7,23]])}))),function(e){return g.apply(this,arguments)})},{key:"instantiateNetwork",value:(m=(0,e.Z)(a().mark((function e(){var t,r,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,c.re)(this.networkParams,this.token,this.serverType);case 2:return t=e.sent,e.prev=3,"background"===this.networkType&&this.networkOptions.background&&(r=this.preloadBackground(this.networkOptions.background.image)),n=(0,s.ZS)(this.networkParams.name,this.networkParams.tag,this.networkParams.version,t),e.next=8,(0,s.Hy)(this.networkParams.name,t);case 8:return this.NetworkClass=e.sent,e.next=11,n;case 11:if(this.networkParameters=e.sent,!r){e.next=15;break}return e.next=15,r;case 15:this.container?this.container.insertBefore(this.canvas,this.video.nextSibling):document.body.appendChild(this.canvas),e.next=26;break;case 18:throw e.prev=18,e.t0=e.catch(3),console.error("Error in instantiateNetwork",e.t0),document.dispatchEvent(this.events.error),this.initialized=!1,this.error=e.t0,this.disable(),e.t0;case 26:case"end":return e.stop()}}),e,this,[[3,18]])}))),function(){return m.apply(this,arguments)})},{key:"disable",value:function(){var e=this.video;e.style.height="100%",e.style.width="100%",this.canvas.style.visibility="hidden",e.style.visibility="visible",this.enabled=!1,this.trackAnalytics("Disabled",{upscale:this.enabled})}},{key:"enable",value:function(){this.video.style.visibility="hidden",this.canvas.style.visibility="visible",this.enabled=!0,(0,c.yA)(this.video)&&this.render(),this.trackAnalytics("Enabled",{upscale:this.enabled})}},{key:"initEvents",value:function(){var e={};this.eventList=["load","error","stop","start"],this.eventList.forEach((function(t){e[t]=new Event("vectorly-upscaler-"+t)})),this.events=e}},{key:"on",value:function(e,t){return document.addEventListener("vectorly-upscaler-"+e,t),this}},{key:"getResizeObserver",value:function(e){return new u.Z((function(t){var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}(t);try{for(n.s();!(r=n.n()).done;){var i=r.value.contentRect,o=i.width,a=i.height;e({w:o,h:a})}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"setRenderSize",value:function(e){var t=this.renderSize;this.debug&&console.log("Setting renderSize","w",e.w,"h",e.h),this.renderSize=e;var r=this.canvas;if(this.videoSize&&this.fixaspectratio){this.debug&&console.log("video",this.videoSize,"size",e);var n=this.videoSize.width/this.videoSize.height,i={},o={top:0,left:0,w:e.w,h:e.h};i.w=Math.round(e.h*n),i.h=Math.round(e.w/n),this.debug&&console.log("Expected w h",{w:i.w,h:e.h},{w:e.w,h:i.h}),i.w>e.w?(o.w=e.w,o.h=i.h,o.top=(e.h-o.h)/2):i.h>e.h&&(o.w=i.w,o.h=e.h,o.left=(e.w-o.w)/2),this.margin={left:Math.round(o.left),top:Math.round(o.top)},this.renderInputSize={w:o.w,h:o.h},this.metrics.renderSize=this.renderInputSize,this.debug&&console.log("this.margin",this.margin)}else this.renderInputSize=this.renderSize;this.debug&&console.log("===== IN setRenderSize",this.renderInputSize,this.renderSize,this.renderer),this.renderer&&(this.renderer.setProperties(this.renderInputSize),r.style.left="".concat(this.margin.left,"px"),r.style.top="".concat(this.margin.top,"px"),this.initialRender(),this.initRenderLoop(),this.trackAnalytics("Render Resize",{renderSize:this.metrics.renderSize,previousRenderSize:t}))}},{key:"setVideoSize",value:function(e){this.debug&&console.log("Setting videoSize to",e,"from",this.videoSize);var t=!1;if(this.videoSize){var r={currentSrc:this.video.currentSrc!==this.videoSrc.currentSrc,srcObject:this.video.srcObject!==this.videoSrc.srcObject};r.currentSrc||r.srcObject?(this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF=!0,t=!0):t=e.width!==this.videoSize.width||e.height!==this.videoSize.height}else this.videoSrc={currentSrc:this.video.currentSrc,srcObject:this.video.srcObject},t=!0;if(t){var n=this.inputChangePreHook({before:this.videoSize,after:e},this);this.videoSize=e,this.trackAnalytics("Video Resize",{videoSize:e,previousVideoSize:this.videoSize,resizedProcessed:n}),n?(this.inputSize={w:e.width,h:e.height},this.renderer&&this.renderer.setInputSize(this.inputSize),this.renderSize&&this.setRenderSize(this.renderSize)):(this.debug&&console.log("not changing as Prehook for inputChange returned",n),this.disable())}}},{key:"initializeNetwork",value:(p=(0,e.Z)(a().mark((function e(t){var r,n,i,o=this;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.debug&&console.log("Waiting for",this.canvas.id),r=(0,c.br)("canvas#"+this.canvas.id),n=(0,c.uF)(t),e.next=6,Promise.all([r,n,this.instantiateP]);case 6:return this.debug&&console.log("Found canvas ",this.canvas.id),e.next=9,n;case 9:return i=e.sent,this.setVideoSize(i),t.addEventListener("resize",(function(){o.setVideoSize({width:t.videoWidth,height:t.videoHeight}),o.metrics.originalSize={w:t.videoWidth,h:t.videoHeight},t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){this.renderAFrame()}.bind(o))})),this.renderSize=this.renderSize||{w:1278,h:720},this.setRenderSize(this.renderSize),this.initializeWebGL(),e.abrupt("return",!0);case 18:return e.prev=18,e.t0=e.catch(0),this.error=e.t0,e.abrupt("return",!1);case 22:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return p.apply(this,arguments)})},{key:"renderAFrame",value:function(){this.frameBuffer&&this.frameBuffer.setInputImage(this.video),this.renderer&&this.renderer.render()}},{key:"initializeWebGL",value:(d=(0,e.Z)(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.debug&&console.log("Initializing WebGL context and network",this.inputSize,this.renderInputSize);try{this.gl=new s.yb(this.canvas.id,{h:this.inputSize.h,w:this.inputSize.w,use_webgl1:this.use_webgl1,float_type:this.float_type}),this.debug&&console.log("this.gl initialized",this.gl.input)}catch(e){console.warn("Error in intializing WebGLContext",e),this.gl=null}if(!this.gl){e.next=17;break}return this.frameBuffer=new s.uL(this.gl),this.networkOptions.networkParams=this.networkParams,this.networkInstance=new this.NetworkClass(this.gl,this.frameBuffer,this.networkParameters,this.networkOptions),this.initialized=this.networkInstance.initialized,e.next=9,this.initialized;case 9:this.renderer=new s.Th(this.gl,this.networkInstance,this.frameBuffer,this.renderInputSize),this.canvas.style.left="".concat(this.margin.left,"px"),this.canvas.style.top="".concat(this.margin.top,"px"),this.initialRender(),this.initVideoEventRender(),this.initRenderLoop(),e.next=19;break;case 17:document.dispatchEvent(this.events.error),this.disable();case 19:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"initRenderLoop",value:function(){var e=this.video;(0,c.yA)(this.video)&&this.render(),e.addEventListener("play",function(){this.render()}.bind(this)),document.dispatchEvent(this.events.load)}},{key:"initialRender",value:function(){var e=this,t=this.video;this.debug&&console.log("Calling Initial Render"),4===t.readyState&&setTimeout((function(){e.renderAFrame()}),100),t.requestVideoFrameCallback&&t.requestVideoFrameCallback(function(){if((0,c.yA)(t))return null;this.renderAFrame()}.bind(this))}},{key:"initVideoEventRender",value:function(){var e=this.video;e.oncanplaythrough=function(){this.renderAFrame()}.bind(this),e.onloadeddata=function(){this.renderAFrame()}.bind(this)}},{key:"updateFrameMetrics",value:function(){if(this.frames.rendered.total++,this.frames.rendered.sinceTimestamp++,this.metrics.upscaledFrames++,performance.now()-this.prv>1e4){this.metrics.fps=JSON.parse(JSON.stringify(this.frames.rendered.sinceTimestamp)),this.prv=performance.now(),this.frames.rendered.sinceTimestamp=0;var e=this.video,t=e.webkitDecodedFrameCount||e.mozPresentedFrames||e.decodedFrames||e.presentedFrames;t&&(this.frames.video.total=t,this.metrics.videoFrames=t,this.metrics.droppedFrames=this.metrics.videoFrames-this.metrics.upscaledFrames,this.debug&&console.log("currentTime: ".concat(this.video.currentTime,", FPS: ").concat(this.metrics.fps,", Dropped frames: ").concat(this.metrics.droppedFrames,", Video Frame: ").concat(this.metrics.videoFrames,", Rendered frames: ").concat(this.metrics.upscaledFrames)),this.trackAnalytics("Playback Metrics",{FPS:this.metrics.fps,droppedFrames:this.metrics.droppedFrames,videoFrames:this.metrics.videoFrames,upscaledFrames:this.metrics.upscaledFrames,currentTime:this.video.currentTime}))}}},{key:"renderVideoFrame",value:function(e){try{this.debugRender&&console.log("Calling renderVideoFrame in a loop",e),this.video&&this.frameBuffer&&this.renderer&&(this.renderAFrame(),this.updateFrameMetrics()),(0,c.yA)(this.video)&&this.enabled?(this.debugRender&&console.log("calling requestFrame"),this.requestFrame(this.video,this.renderVideoFrame.bind(this)),this.isPlaying=!0):(this.debugRender&&console.log("STOPPED playing"),document.dispatchEvent(this.events.stop),this.isPlaying=!1)}catch(e){console.error("Error in renderVideoFrame",e)}}},{key:"requestFrame",value:function(e,t){if(this.reqHandle=this.reqHandle||{},this.reqHandle.useRAF){var r=(0,l.U7)(t);this.reqHandle.raf=r}else{var n=e.requestVideoFrameCallback(t);this.reqHandle.video=e,this.reqHandle.rfvc=n}}},{key:"updateNetworkOptions",value:(o=(0,e.Z)(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.networkInstance.updateOptions(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"cancelLastRender",value:function(){if(this.debugRender&&console.log("Canceling last render"),this.reqHandle=this.reqHandle||{},this.reqHandle.rfvc){var e=this.reqHandle,t=e.video,r=e.rfvc;t.cancelVideoFrameCallback(r),this.reqHandle.rfvc=null}if(this.reqHandle.raf){var n=this.reqHandle.raf;(0,l.Wx)(n),this.reqHandle.raf=null}}},{key:"preloadBackground",value:(n=(0,e.Z)(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"string"!=typeof t){e.next=9;break}return e.next=4,fetch(t);case 4:return r=e.sent,e.next=7,r.blob();case 7:return self.preloadedBackground=e.sent,e.abrupt("return",!0);case 9:e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(0),console.warn("Vectorly: unable to load ".concat(t," as a background image")),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e){return n.apply(this,arguments)})},{key:"render",value:function(){this.renderCaller=(this.renderCaller||0)+1,this.debugRender&&console.log("Starting render call with isPlaying",this.isPlaying),this.prv=performance.now(),this.cancelLastRender(),this.renderVideoFrame("my-render-".concat(this.renderCaller)),document.dispatchEvent(this.events.start)}},{key:"initCanvas",value:function(){var e=document.createElement("canvas");return e.id="canv-"+this.id,e.style.position="absolute",e.style.left=this.margin.left,e.style.top=this.margin.top,window.upscalers=window.upscalers||{},window.upscalers[e.id]=this,e}}]),r}();n.default=d}(),n.default}()}));